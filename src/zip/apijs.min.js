/*!
 * Copyright 2008-2014 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/apijs - 5.1.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
Function.prototype.hasOwnProperty("bind")||(Function.prototype.bind=function(e){var t=this,i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,0===i.length?arguments:0===arguments.length?i:i.concat(Array.prototype.slice.call(arguments,0)))}}),String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var apijs={core:{},version:510,config:{lang:"auto",debug:!1,dialog:{closeOnClick:!1,restrictNavigation:!0,emotes:!0,imagePrev:null,imageNext:null,imageClose:null},slideshow:{ids:"slideshow"},upload:{tokenName:"authenticity_token",tokenValue:null}},start:function(){var e,t=navigator.userAgent,i=[];i.push(/Presto|Opera/.test(t)),i.push(0),e=t.slice(t.indexOf("rv:")+3),e=parseFloat(e.slice(0,e.indexOf(")"))),i.push(0<"Gecko/".indexOf(t)&&e<2),i.push(e),e=t.slice(t.indexOf("WebKit/")+7),e=parseFloat(e.slice(0,e.indexOf(" "))),i.push(0<"WebKit/".indexOf(t)&&e<536.25),i.push(e);try{console.info("APIJS Hello! Starting "+this.version.toString().replace(/([0-9]+)([0-9])([0-9])$/g,"$1.$2.$3")+"/"+this.config.lang),console.info("APIJS oldPresto="+i[0]+" oldGecko="+i[2]+"/"+i[3]+" oldWebKit="+i[4]+"/"+i[5])}catch(e){window.console={info:function(){},warn:function(){},log:function(){}}}this.inArray(!0,i)?console.warn("APIJS canceled for old browser"):(this.i18n=new this.core.i18n,this.dialog=new this.core.dialog,this.upload=new this.core.upload,this.slideshow=new this.core.slideshow,"function"==typeof setApijsRewrites&&setApijsRewrites(),"function"==typeof setApijsLang&&setApijsLang(),"function"==typeof setApijsConfig&&setApijsConfig(),this.config.debug&&(this.logger(this.i18n,"apijs.i18n."),this.logger(this.dialog,"apijs.dialog."),this.logger(this.upload,"apijs.upload."),this.logger(this.slideshow,"apijs.slideshow."),console.info("APIJS debug mode enabled"),console.info("APIJS available languages: "+Object.keys(this.i18n.data).join(",")),console.info("APIJS setApijsLang:"+("function"==typeof setApijsLang?"yes":"no")+" setApijsConfig:"+("function"==typeof setApijsConfig?"yes":"no")+" setApijsRewrites:"+("function"==typeof setApijsRewrites?"yes":"no"))),this.i18n.init(),this.slideshow.init(),this.config.debug&&(console.info("APIJS language loaded: "+this.config.lang),console.info("APIJS slideshows loaded: "+this.slideshow.started),console.info("APIJS Okay! Successfully started")))},openTab:function(e){e.preventDefault(),window.open(this.href)},inArray:function(e,t){if(e instanceof Array){for(var i in e)if(e.hasOwnProperty(i)&&apijs.inArray(e[i],t))return!0}else for(i in t)if(t.hasOwnProperty(i)&&!isNaN(i)&&t[i]===e)return!0;return!1},serialize:function(e){for(var t,i,s,n=[],o=e.elements.length-1;0<=o;o-=1)if(t=e.elements[o].nodeName,i=e.elements[o].type,"INPUT"===t)this.inArray(i,["checkbox","radio"])?e.elements[o].checked&&n.push(e.elements[o].getAttribute("name")+"="+encodeURIComponent(e.elements[o].value)):this.inArray(i,["file","button","reset","submit"])||n.push(e.elements[o].getAttribute("name")+"="+encodeURIComponent(e.elements[o].value));else if("TEXTAREA"===t)n.push(e.elements[o].getAttribute("name")+"="+encodeURIComponent(e.elements[o].value));else if("SELECT"===t)if("select-multiple"===i)for(s=e.elements[o].options.length-1;0<=s;s-=1)e.elements[o].options[s].selected&&n.push(e.elements[o].getAttribute("name")+"="+encodeURIComponent(e.elements[o].options[s].value));else n.push(e.elements[o].getAttribute("name")+"="+encodeURIComponent(e.elements[o].value));return n.join("&")},error:function(e,t){var i,s=[];if("string"==typeof t)s.push(t);else for(i in t)t.hasOwnProperty(i)&&s.push(i+": "+t[i]);this.config.debug&&this.dialog.dialogInformation("(debug) Invalid call","[pre]"+e+"[br]➩ "+s.join("[br]➩ "),"debug"),console.warn(e+" => "+s.join(" / "))},methods:{},logger:function(s,n){for(var e in s)"function"==typeof s[e]&&(apijs.methods[n+e]=s[e],function(){var t,i=e;s[i]=function(){var e=[].splice.call(arguments,0);return i.indexOf("nodeTranslate")<0&&(t=(t=new Date).getMinutes()+"m"+t.getSeconds()+"s"+t.getMilliseconds()+"ms ",-1<i.indexOf("dialog")||-1<i.indexOf("sendFile")?console.info("displaying "+n+i+"()"):!(-1<i.indexOf("translate"))&&-1<i.indexOf("actionKey")?console.log(t+n+i+"("+e[0].keyCode+")"):console.log(t+n+i+"("+e.join(",")+")")),apijs.methods[n+i].apply(s,e)}}())}};"function"==typeof window.addEventListener&&window.addEventListener("load",apijs.start.bind(apijs),!1),apijs.core.i18n=function(){this.data=[],this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",buttonBrowse:"Choose a file",userLeavePage:"You are about to leave...",operationTooLong:"This operation is too long? ",warningLostChange:"Warning: all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",imageError404:"Error 404\nThe file does not exist.",ctrlSlideshowFirstLast:"start/end",ctrlSlideshowNextPrev:"previous/next",ctrlVideoPause:"play/pause",ctrlVideoTime:"backward/forward",ctrlVideoSound:"decrease/increase the volume",ctrlVideoMute:"mute",ctrlDialogFullscreen:"full screen",ctrlDialogQuit:"quit",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"All files are accepted.[br]Maximum size: § MB.",uploadOneType:"Accepted file format: §.[br]Maximum size: § MB.",uploadMultiType:"Accepted file formats: § and §.[br]Maximum size: § MB.",uploadDecimal:".",upload11:"§% (§ KB/s - § minutes left)",upload12:"§% (§ KB/s - § minute left)",upload13:"§% (§ KB/s - § seconds left)",upload14:"§% (§ KB/s)",upload21:"§% (at § KB/s in § minutes)",upload22:"§% (at § KB/s in § minute)",upload23:"§% (at § KB/s in § seconds)",upload24:"§% (at § KB/s)",uploadBadType:"It's impossible to send the file because the proposed file format isn't allowed. Proposed file format: §.",uploadBadSize:"It's impossible to send the file because the file size is too large. Proposed file size: § MB.",uploadEmpty:"It's impossible to send the file because the file is empty.",uploadError0:"It seems that a unlikely mistake just happened... Please try again.",uploadError1:"An error occurred while sending the file.[br][em]➩ Error §.[/em]",uploadError2:"An error occurred while processing the file.[br][em]➩ §[/em]"},this.data.es={buttonOk:"Aceptar",buttonCancel:"Cancelar",buttonConfirm:"Confirmar",buttonClose:"Cerrar",buttonPrev:"Anterior",buttonNext:"Siguiente",buttonBrowse:"Elige un fichero",userLeavePage:"Está a punto de abandonar...",operationTooLong:"Esta operación tomará mucho tiempo? ",warningLostChange:"Atención: todos los cambios en curso se perderán.",reloadLink:"Recarga esta página",operationInProgress:"Operación en ejecución...",uploadInProgress:"Subida de datos en ejecución...",imageError404:"Error 404\nEl archivo no existe.",ctrlSlideshowFirstLast:"inicio/fin",ctrlSlideshowNextPrev:"anterior/siguiente",ctrlVideoPause:"reproducir/pausa",ctrlVideoTime:"atrás/adelante",ctrlVideoSound:"bajar/subir el volumen",ctrlVideoMute:"silenciar",ctrlDialogFullscreen:"pantalla completa",ctrlDialogQuit:"salir",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Esc",uploadAllType:"Se aceptan todos los archivos.[br]Tamaño máximo: § MB.",uploadOneType:"Formato de archivo aceptado: §.[br]Tamaño máximo: § MB.",uploadMultiType:"Formatos de archivos aceptados: § y §.[br]Tamaño máximo: § MB.",uploadDecimal:".",upload11:"§% (§ KB/s - § minutos restantes)",upload12:"§% (§ KB/s - § minuto restantes)",upload13:"§% (§ KB/s - § segundos restantes)",upload14:"§% (§ KB/s)",upload21:"§% (a § KB/s en § minutos)",upload22:"§% (a § KB/s en § minuto)",upload23:"§% (a § KB/s en § segundos)",upload24:"§% (a § KB/s)",uploadBadType:"Ha sido imposible enviar el archivo porque el formato no está permitido. El formato del archivo es: §.",uploadBadSize:"Ha sido imposible enviar el archivo porque el tamaño es muy elevado. El tamaño del archivo es: § MB.",uploadEmpty:"Ha sido imposible enviar el archivo porque el archivo está vacío.",uploadError1:"Se ha producido un error durante el envío del archivo.[br][em]➩ Error §.[/em]",uploadError2:"Se ha producido un error durante el procesamiento del archivo.[br][em]➩ §[/em]"},this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",buttonBrowse:"Choisir un fichier",userLeavePage:"Vous vous apprêtez à partir...",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",imageError404:"Erreur 404\nLe fichier n'existe pas.",ctrlSlideshowFirstLast:"début/fin",ctrlSlideshowNextPrev:"précédent/suivant",ctrlVideoPause:"lecture/pause",ctrlVideoTime:"reculer/avancer",ctrlVideoSound:"baisser/augmenter le volume",ctrlVideoMute:"couper le son",ctrlDialogFullscreen:"plein écran",ctrlDialogQuit:"quitter",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Échap",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § Mo.",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § Mo.",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § Mo.",uploadDecimal:",",upload11:"§% (§ Ko/s - § minutes restantes)",upload12:"§% (§ Ko/s - § minute restante)",upload13:"§% (§ Ko/s - § secondes restantes)",upload14:"§% (§ Ko/s)",upload21:"§% (à § Ko/s en § minutes)",upload22:"§% (à § Ko/s en § minute)",upload23:"§% (à § Ko/s en § secondes)",upload24:"§% (à § Ko/s)",uploadBadType:"Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé. Format du fichier proposé : §.",uploadBadSize:"Il est impossible d'envoyer le fichier car la taille du fichier proposé est trop importante. Taille du fichier proposé : § Mo.",uploadEmpty:"Il est impossible d'envoyer le fichier car le fichier est vide.",uploadError0:"Il semblerait qu'une erreur improbable vient de se produire... Veuillez réessayer.",uploadError1:"Une erreur est survenue lors de l'envoi du fichier.[br][em]➩ Erreur §.[/em]",uploadError2:"Une erreur est survenue lors du traitement du fichier.[br][em]➩ §[/em]"},this.init=function(){var e,t=document.querySelector("html");-1<apijs.config.lang.indexOf("auto")&&(t.getAttribute("xml:lang")?e=t.getAttribute("xml:lang").slice(0,2):t.getAttribute("lang")&&(e=t.getAttribute("lang").slice(0,2)),"string"==typeof e&&this.data.hasOwnProperty(e)?apijs.config.lang=e:-1<apijs.config.lang.indexOf("auto-")&&(apijs.config.lang=apijs.config.lang.slice(5))),this.data.hasOwnProperty(apijs.config.lang)||(apijs.config.lang="en")},this.translate=function(e){var t,i=apijs.config.lang,s=0,n=1,o="";if("string"!=typeof this.data[i][e]){if("en"===i||"string"!=typeof this.data.en[e])return e;i="en"}if(1<arguments.length){for(t=this.data[i][e].split("§");s<t.length;s++)o+=n<arguments.length?t[s]+arguments[n++]:t[s];return o}return this.data[i][e]},this.nodeTranslate=function(e){return document.createTextNode(this.translate(e))},this.changeLang=function(e){if("string"==typeof e){if(this.data.hasOwnProperty(e))return apijs.config.lang=e,!0;if(-1<e.indexOf("auto"))return apijs.config.lang=e,this.init(),!0}return!1}},apijs.core.dialog=function(){this.styles=null,this.paused=null,this.image=null,this.timer=null,this.callback=null,this.args=null,this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.tagDialog=null,this.tagMedia=null,this.tagTitle=null,this.tagBox=null,this.dialogInformation=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.initDialog("information",i),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonOk(),this.showDialog(),this.tagBox.querySelector("button.confirm").focus()):apijs.error("TheDialog.dialogInformation",{"(string) *title":e,"(string) *text":t,"(string) icon":i})},this.dialogConfirmation=function(e,t,i,s,n){"string"==typeof e&&"string"==typeof t&&"function"==typeof i?(this.initDialog("confirmation",n),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonConfirm("button"),this.callback=i,this.args=s,this.showDialog(),this.tagBox.querySelector("button.confirm").focus()):("function"==typeof i&&"string"==typeof i.name&&0<i.name.length&&(i=i.name),apijs.error("TheDialog.dialogConfirmation",{"(string) *title":e,"(string) *text":t,"(function) *callback":i,"(mixed) args":s,"(string) icon":n}))},this.dialogFormOptions=function(e,t,i,s,n,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"function"==typeof s?(this.initDialog("options",o),this.htmlParent(null,i),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonConfirm("submit"),this.callback=s,this.args=n,this.showDialog(),window.setTimeout(function(){apijs.dialog.tagBox.querySelector("input:not([readonly]),textarea:not([readonly]),select:not([disabled])").focus()},12)):("function"==typeof s&&"string"==typeof s.name&&0<s.name.length&&(s=s.name),apijs.error("TheDialog.dialogFormOptions",{"(string) *title":e,"(string) *text":t,"(string) *action":i,"(function) *callback":s,"(mixed) args":n,"(string) icon":o}))},this.dialogFormUpload=function(e,t,i,s,n){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"string"==typeof s?(this.initDialog("upload",n),this.htmlParent(null,i),this.htmlTitle(e),this.htmlContent(t,!1),this.htmlFormUpload(s),this.htmlButtonConfirm("submit"),this.showDialog(),window.setTimeout(function(){apijs.dialog.tagBox.querySelector(".browse").focus()},12)):apijs.error("TheDialog.dialogFormUpload",{"(string) *title":e,"(string) *text":t,"(string) *action":i,"(string) *inputname":s,"(string) icon":n})},this.dialogProgress=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.initDialog("progress",i),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t,!1),this.htmlProgressBar(),this.showDialog()):apijs.error("TheDialog.dialogProgress",{"(string) *title":e,"(string) *text":t,"(string) icon":i})},this.dialogWaiting=function(e,t,i,s){"string"==typeof e&&"string"==typeof t?(this.initDialog("waiting",s),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t,!1),this.showDialog(),"number"==typeof i&&5<i&&(this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,1e3*i))):apijs.error("TheDialog.dialogWaiting",{"(string) *title":e,"(string) *text":t,"(number) time":i,"(string) icon":s})},this.dialogPhoto=function(e,t,i,s,n){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"string"==typeof s?("string"==typeof n?(this.initDialog("photo","notransition slideshow"),this.htmlParent(n)):(this.initDialog("photo","notransition"),this.htmlParent()),this.htmlMedia(e,t,i,s),this.htmlHelp("string"==typeof n,!1),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialog(),this.loadImage(e)):apijs.error("TheDialog.dialogPhoto",{"(string) *url":e,"(string) *name":t,"(string) *date":i,"(string) *legend":s})},this.dialogVideo=function(e,t,i,s,n){"string"==typeof e&&"string"==typeof t&&"string"==typeof s&&"string"==typeof s?("string"==typeof n?(this.initDialog("video","notransition slideshow"),this.htmlParent(n)):(this.initDialog("video","notransition"),this.htmlParent()),this.htmlMedia(e,t,i,s),this.htmlHelp("string"==typeof n,!0),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialog(),this.actionResizeMedia()):apijs.error("TheDialog.dialogVideo",{"(string) *url":e,"(string) *name":t,"(string) *date":i,"(string) *legend":s})},this.dialogEmpty=function(e,t,i,s){"string"==typeof e?(this.initDialog("empty",s),this.htmlParent(),this.htmlContent(e),("boolean"==typeof t&&t||!0!==i)&&this.htmlButtonClose(),"boolean"==typeof i&&i&&this.htmlButtonOk(),this.showDialog(),"boolean"==typeof i&&i&&this.tagBox.querySelector("button.confirm").focus()):apijs.error("TheDialog.dialogEmpty",{"(string) *text":e,"(boolean) closeButton":t,"(boolean) okButton":i,"(string) icon":s})},this.actionClose=function(e){"object"==typeof e?"apijsDialog"!==e.target.getAttribute("id")||apijs.dialog.styles.has("photo","video","waiting","progress","lock")||apijs.dialog.deleteDialog(!0):document.getElementById("apijsDialog")&&this.deleteDialog("boolean"!=typeof e||e)},this.actionKey=function(e){var t,i=apijs.dialog.styles,s=apijs.dialog.tagMedia;i.has("waiting","progress","lock")?(e.ctrlKey&&(81===e.keyCode||87===e.keyCode||82===e.keyCode||115===e.keyCode||116===e.keyCode)||e.altKey&&115===e.keyCode||27===e.keyCode||116===e.keyCode)&&e.preventDefault():i.has("slideshow")?27===e.keyCode?(e.preventDefault(),apijs.dialog.actionClose()):35===e.keyCode?(e.preventDefault(),apijs.slideshow.actionLast()):36===e.keyCode?(e.preventDefault(),apijs.slideshow.actionFirst()):37===e.keyCode?(e.preventDefault(),apijs.slideshow.actionPrev()):39===e.keyCode&&(e.preventDefault(),apijs.slideshow.actionNext()):27===e.keyCode&&(e.preventDefault(),apijs.dialog.actionClose()),i.has("video")&&!isNaN(s.duration)&&(32===e.keyCode||80===e.keyCode?(e.preventDefault(),s.paused?s.play():s.pause()):38===e.keyCode||33===e.keyCode?(e.preventDefault(),s.currentTime<s.duration-15&&(s.currentTime+=10)):40===e.keyCode||34===e.keyCode?(e.preventDefault(),s.currentTime-=10):107===e.keyCode?(e.preventDefault(),s.volume<1&&(s.volume+=.2)):109===e.keyCode?(e.preventDefault(),.2<s.volume&&(s.volume-=.2)):77===e.keyCode&&(e.preventDefault(),s.muted=!s.muted)),32!==e.keyCode&&33!==e.keyCode&&34!==e.keyCode&&35!==e.keyCode&&36!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(t="INPUT"===e.target.nodeName,i="TEXTAREA"===e.target.nodeName,s="SELECT"===e.target.nodeName,(t||i||s)&&33!==e.keyCode&&34!==e.keyCode||apijs.dialog.actionScrollBrowser(e))},this.actionCloseBrowser=function(e){if(apijs.dialog.styles.has("waiting","progress","lock"))return e.preventDefault(),e.stopPropagation(),apijs.i18n.translate("userLeavePage")+"\n"+apijs.i18n.translate("warningLostChange")},this.actionScrollBrowser=function(e){e.preventDefault(),e.stopPropagation()},this.actionConfirm=function(){if(this.styles.has("options","confirmation")){if(this.styles.has("options")&&!0!==this.callback(!1,this.args))return!1;this.styles.add("lock"),this.tagBox.querySelector("div.control").style.visibility="hidden",this.tagBox.querySelector("div.bbcode").style.visibility="hidden",this.elemA=document.createElement("p"),this.elemA.setAttribute("class","saving"),this.elemA.appendChild(apijs.i18n.nodeTranslate("operationInProgress")),this.tagBox.appendChild(this.elemA),this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,7e3),window.setTimeout(function(){this.tagBox&&"FORM"===this.tagBox.nodeName?this.callback(this.tagBox.getAttribute("action"),this.args):this.tagBox&&this.callback(this.args)}.bind(this),1e3)}else this.styles.has("upload")&&apijs.upload.actionConfirm(this.tagBox.getAttribute("action"));return!1},this.actionResizeMedia=function(){var e=apijs.dialog,t=!1;null!==e.image?(e.image.width>Math.round(e.tagMedia.offsetWidth)||e.image.height>Math.round(e.tagMedia.offsetHeight))&&(t=!0):(e.tagMedia.setAttribute("class",e.tagMedia.getAttribute("class").replace("bis","default")),Math.round(e.tagMedia.offsetWidth)>window.innerWidth-12*window.innerWidth/100&&(t=!0),e.tagMedia.setAttribute("class",e.tagMedia.getAttribute("class").replace("default","bis"))),e.tagMedia.setAttribute("class",e.tagMedia.getAttribute("class").replace(t?"default":"bis",t?"bis":"default"))},this.actionPauseVideo=function(){var e,t=apijs.dialog;"boolean"==typeof document.hidden?e=document.hidden:"boolean"==typeof document.mozHidden?e=document.mozHidden:"boolean"==typeof document.msHidden?e=document.msHidden:"boolean"==typeof document.webkitHidden&&(e=document.webkitHidden),e?(t.paused=t.tagMedia.paused,t.tagMedia.pause()):t.paused||t.tagMedia.play()},this.loadImage=function(e){this.image=new Image,this.image.src=e,this.image.addEventListener("load",function(){this.tagMedia&&(this.tagMedia.setAttribute("class",this.tagMedia.getAttribute("class").replace("loading","default")),this.tagMedia.setAttribute("style",'background-image:url("'+this.image.src+'");'),this.actionResizeMedia())}.bind(this),!1),this.image.addEventListener("error",function(){this.tagMedia&&(this.tagMedia.setAttribute("class",this.tagMedia.getAttribute("class").replace(/loading|default/,"error")),this.tagMedia.firstChild.appendChild(apijs.i18n.nodeTranslate("imageError404")))}.bind(this),!1)},this.initDialog=function(e,t){if(null!==this.styles&&this.deleteDialog(!1),this.styles=new apijs.core.styles,this.styles.init(e,t),this.fragment=document.createDocumentFragment(),document.addEventListener("keydown",apijs.dialog.actionKey,!1),window.addEventListener("beforeunload",apijs.dialog.actionCloseBrowser,!1),window.addEventListener("DOMMouseScroll",apijs.dialog.actionScrollBrowser,!1),window.addEventListener("mousewheel",apijs.dialog.actionScrollBrowser,!1),window.addEventListener("touchmove",apijs.dialog.actionScrollBrowser,!1),apijs.config.dialog.restrictNavigation)for(var i=document.querySelectorAll("a,area,button,input,object,select,textarea,iframe"),s=0;s<i.length;s++)"object"==typeof i[s]&&i[s].setAttribute("tabindex","-1")},this.showDialog=function(){document.getElementById("apijsDialog")||this.styles.has("notransition")?(this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("start","ready")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("start","ready")),document.getElementById("apijsDialog")?(document.getElementById("apijsDialog").appendChild(this.tagBox),this.tagDialog=document.getElementById("apijsDialog")):document.body.appendChild(this.fragment)):(document.body.appendChild(this.fragment),window.setTimeout(function(){this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("start","ready")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("start","ready"))}.bind(this),12)),apijs.config.dialog.closeOnClick&&!this.styles.has("waiting","progress","lock")&&document.addEventListener("click",apijs.dialog.actionClose,!1),this.styles.has("photo","video")&&window.addEventListener("resize",apijs.dialog.actionResizeMedia,!1),this.styles.has("video")&&("boolean"==typeof document.hidden?document.addEventListener("visibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.mozHidden?document.addEventListener("mozvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.msHidden?document.addEventListener("msvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.webkitHidden&&document.addEventListener("webkitvisibilitychange",apijs.dialog.actionPauseVideo,!1))},this.deleteDialog=function(e){if(this.timer&&clearTimeout(this.timer),document.removeEventListener("keydown",apijs.dialog.actionKey,!1),window.removeEventListener("beforeunload",apijs.dialog.actionCloseBrowser,!1),window.removeEventListener("DOMMouseScroll",apijs.dialog.actionScrollBrowser,!1),window.removeEventListener("mousewheel",apijs.dialog.actionScrollBrowser,!1),window.removeEventListener("touchmove",apijs.dialog.actionScrollBrowser,!1),apijs.config.dialog.restrictNavigation)for(var t=document.querySelectorAll("a,area,button,input,object,select,textarea,iframe"),i=0;i<t.length;i++)"object"==typeof t[i]&&t[i].removeAttribute("tabindex");var s,n;apijs.config.dialog.closeOnClick&&document.removeEventListener("click",apijs.dialog.actionClose,!1),this.styles.has("photo","video")&&window.removeEventListener("resize",apijs.dialog.actionResizeMedia,!1),this.styles.has("video")&&("function"==typeof this.tagMedia.pause&&(this.tagMedia.pause(),this.tagMedia.setAttribute("src","")),"boolean"==typeof document.hidden?document.removeEventListener("visibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.mozHidden?document.removeEventListener("mozvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.msHidden?document.removeEventListener("msvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.webkitHidden&&document.removeEventListener("webkitvisibilitychange",apijs.dialog.actionPauseVideo,!1)),this.tagDialog=document.getElementById("apijsDialog"),this.tagBox=document.getElementById("apijsBox"),e?(s=window.getComputedStyle(this.tagBox,null),n="string"==typeof this.tagBox.style.webkitTransition?"webkitTransitionEnd":"transitionend",this.styles.has("notransition")||"0s"===s.transitionDuration||void 0===s.transitionDuration?document.body.removeChild(document.getElementById("apijsDialog")):(this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("ready","end")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("ready","end")),this.tagDialog.addEventListener(n,function(){document.getElementById("apijsDialog")&&document.body.removeChild(document.getElementById("apijsDialog"))},!1))):this.tagBox&&this.tagBox.parentNode.removeChild(this.tagBox),this.styles=null,this.paused=null,this.image=null,this.timer=null,e&&(this.callback=null,this.args=null),this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.tagDialog=null,this.tagMedia=null,this.tagTitle=null,this.tagBox=null},this.htmlParent=function(e,t){this.tagDialog=document.createElement("div"),this.tagDialog.setAttribute("class","string"==typeof e?"start "+e:"start"),this.tagDialog.setAttribute("id","apijsDialog"),"string"!=typeof t?this.tagBox=document.createElement("div"):(this.tagBox=document.createElement("form"),this.tagBox.setAttribute("action",t),this.tagBox.setAttribute("method","post"),this.tagBox.setAttribute("enctype","multipart/form-data"),this.tagBox.setAttribute("onsubmit","return apijs.dialog.actionConfirm();")),this.tagBox.setAttribute("class","start "+this.styles.toString()),this.tagBox.setAttribute("id","apijsBox"),this.tagDialog.appendChild(this.tagBox),this.fragment.appendChild(this.tagDialog)},this.htmlTitle=function(e){this.tagTitle=document.createElement("h1"),this.tagTitle.appendChild(document.createTextNode(e)),this.tagBox.appendChild(this.tagTitle)},this.htmlContent=function(e,t){t="boolean"!=typeof t||t,this.elemA=document.createElement("div"),this.elemA.setAttribute("class",apijs.config.dialog.emotes?"bbcode emotes":"bbcode"),"["!==e[0]&&(e="[p]"+e+"[/p]"),apijs.config.dialog.emotes&&t&&(e=e.replace(/ (\(L\))/g,"`$1`00¤").replace(/ (\(u\))/gi,"`$1`01¤").replace(/ (\(y\))/gi,"`$1`02¤").replace(/ (\(n\))/gi,"`$1`03¤").replace(/ (:D)/gi,"`$1`04¤").replace(/ (:\))/g,"`$1`05¤").replace(/ (:p)/gi,"`$1`06¤").replace(/ (:\()/g,"`$1`07¤").replace(/ (;\))/g,"`$1`08¤").replace(/ (:lol)/gi,"`$1`09¤").replace(/ (8\))/g,"`$1`0a¤").replace(/ (:@)/g,"`$1`0b¤").replace(/ (\(6\))/g,"`$1`0c¤").replace(/ (:o)/gi,"`$1`0d¤").replace(/ (\(\!\))/g,"`$1`0e¤").replace(/ (\(\?\))/g,"`$1`0f¤").replace(/ (:s)/gi,"`$1`10¤").replace(/ (:\|)/g,"`$1`11¤").replace(/ (:\/)/g,"`$1`12¤").replace(/ (\(i\))/gi,"`$1`13¤").replace(/`(.{2,4})`([0-9a-f]{2})¤/g,' [span title="$1" class="ico"]&#xe6$2;[/span]')),this.elemA.innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\[/g,"<").replace(/\]/g,">");for(var i=this.elemA.querySelectorAll("a.popup"),s=0;s<i.length;s++)i[s].addEventListener("click",apijs.openTab,!1);this.tagBox.appendChild(this.elemA)},this.htmlButtonOk=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose();"),this.elemB.setAttribute("class","confirm"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonOk")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonConfirm=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type",e),this.elemB.setAttribute("class","confirm"),"submit"!==e&&this.elemB.setAttribute("onclick","apijs.dialog.actionConfirm();"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonConfirm")),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","cancel"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose();"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonCancel")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonNavigation=function(){var e=null===apijs.config.dialog.imagePrev||null===apijs.config.dialog.imageNext;this.elemA=document.createElement("div"),this.elemA.setAttribute("class",e?"navigation txt":"navigation img"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionPrev();"),this.elemB.setAttribute("class","prev"),this.elemB.setAttribute("id","apijsPrev"),e?(this.elemC=document.createElement("span"),this.elemC.appendChild(apijs.i18n.nodeTranslate("buttonPrev"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imagePrev.src),this.elemC.setAttribute("width",apijs.config.dialog.imagePrev.width),this.elemC.setAttribute("height",apijs.config.dialog.imagePrev.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonPrev"))),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionNext();"),this.elemB.setAttribute("class","next"),this.elemB.setAttribute("id","apijsNext"),e?(this.elemC=document.createElement("span"),this.elemC.appendChild(apijs.i18n.nodeTranslate("buttonNext"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imageNext.src),this.elemC.setAttribute("width",apijs.config.dialog.imageNext.width),this.elemC.setAttribute("height",apijs.config.dialog.imageNext.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonNext"))),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonClose=function(){var e=null===apijs.config.dialog.imageClose;this.elemA=document.createElement("div"),this.elemA.setAttribute("class",e?"close txt":"close img"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose();"),this.elemB.setAttribute("class","close"),e?this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonClose")):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imageClose.src),this.elemC.setAttribute("width",apijs.config.dialog.imageClose.width),this.elemC.setAttribute("height",apijs.config.dialog.imageClose.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonClose")),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlLinkReload=function(){var e=apijs.dialog;e.elemA=document.createElement("p"),e.elemA.setAttribute("class","reload"),e.elemA.appendChild(apijs.i18n.nodeTranslate("operationTooLong")),e.elemB=document.createElement("a"),e.elemB.setAttribute("href","javascript:location.reload();"),e.elemB.appendChild(apijs.i18n.nodeTranslate("reloadLink")),e.elemA.appendChild(e.elemB),e.elemA.appendChild(document.createTextNode(".")),e.elemB=document.createElement("br"),e.elemA.appendChild(e.elemB),e.elemA.appendChild(apijs.i18n.nodeTranslate("warningLostChange")),e.tagBox.appendChild(e.elemA)},this.htmlFormUpload=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control online"),"string"==typeof apijs.config.upload.tokenValue&&(this.elemB=document.createElement("input"),this.elemB.setAttribute("type","hidden"),this.elemB.setAttribute("name",apijs.config.upload.tokenName),this.elemB.setAttribute("value",apijs.config.upload.tokenValue),this.elemA.appendChild(this.elemB)),this.elemB=document.createElement("input"),this.elemB.setAttribute("type","file"),this.elemB.setAttribute("name",e),this.elemB.setAttribute("id","apijsFile"),this.elemB.setAttribute("onchange","apijs.dialog.tagBox.querySelector('button.confirm').focus(); apijs.dialog.tagBox.querySelector('span').innerHTML = (this.files) ? this.files[0].name : this.value.slice(12);"),this.elemA.appendChild(this.elemB),0<navigator.userAgent.indexOf("MSIE")?(this.elemB=document.createElement("label"),this.elemB.setAttribute("for","apijsFile"),this.elemB.setAttribute("tabindex","1")):(this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","document.getElementById('apijsFile').click();")),this.elemB.setAttribute("class","browse"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonBrowse")),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("span"),this.elemB.setAttribute("class","filename"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("div"),this.elemB.setAttribute("class","status"),this.elemB.appendChild(document.createTextNode("")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlProgressBar=function(){this.elemA=document.createElement("svg"),this.elemA.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.elemA.setAttribute("version","1.1"),this.elemA.setAttribute("id","apijsProgress"),this.elemB=document.createElement("rect"),this.elemB.setAttribute("class","auto"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("text"),this.elemB.appendChild(document.createTextNode(" ")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlMedia=function(e,t,i,s){var n,o,a,l,r=e.slice(e.lastIndexOf("/")+1,e.lastIndexOf(".")),d={ogv:"video/ogg",webm:"video/webm",mp4:"video/mp4",m4v:"video/mp4"};if(this.elemA=document.createElement("dl"),this.elemA.setAttribute("class","media"),this.elemB=document.createElement("dt"),this.tagMedia=null,this.styles.has("photo"))this.tagMedia=document.createElement("div"),this.tagMedia.setAttribute("class","img loading"),this.tagMedia.setAttribute("id","apijsMedia"),this.elemD=document.createElement("span"),this.tagMedia.appendChild(this.elemD);else if(this.styles.has("video"))for(this.tagMedia=document.createElement("video"),this.tagMedia.setAttribute("controls","controls"),this.tagMedia.setAttribute("class","default"),this.tagMedia.setAttribute("id","apijsMedia"),o=(o=0<(o=0<(o=e.slice(e.lastIndexOf(".")+1)).indexOf("?")&&0<o.indexOf("#")?o.slice(0,o.indexOf("?"))+o.slice(o.indexOf("#")):o).indexOf("?")&&o.indexOf("#")<0?o.slice(0,o.indexOf("?")):o).replace("#",".").replace(",",".").split("."),n=0;n<o.length;n++)a=o[n],l=e.slice(0,e.lastIndexOf(".")+1)+a,l=0<e.indexOf("?")&&0<e.indexOf("#")?l+e.slice(e.indexOf("?"),e.indexOf("#")):l,l=0<e.indexOf("?")&&e.indexOf("#")<0?l+e.slice(e.indexOf("?")):l,this.elemD=document.createElement("source"),this.elemD.setAttribute("src",l),d.hasOwnProperty(a)&&this.elemD.setAttribute("type",d[a]),this.tagMedia.appendChild(this.elemD);null!==this.tagMedia&&this.elemB.appendChild(this.tagMedia),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===t&&"false"===i||(this.elemC=document.createElement("span"),"false"!==t&&"auto"!==t&&"false"!==i?this.elemC.appendChild(document.createTextNode(t+" ("+i+")")):"false"!==t&&"auto"!==t?this.elemC.appendChild(document.createTextNode(t)):"auto"===t&&"false"!==i?this.elemC.appendChild(document.createTextNode(r+" ("+i+")")):"auto"===t?this.elemC.appendChild(document.createTextNode(r)):"false"!==i&&this.elemC.appendChild(document.createTextNode("("+i+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+s+" ")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlHelp=function(e,t){var i,s,n,o,a=[];for(e&&(a.push(["start;↖","ctrlKeyEnd","ctrlSlideshowFirstLast"]),a.push(["left;←","right;→","ctrlSlideshowNextPrev"])),t&&(a.push(["p","ctrlVideoPause"]),a.push(["top;↑","bot;↓","ctrlVideoTime"]),a.push(["more;+","less;-","ctrlVideoSound"]),a.push(["m","ctrlVideoMute"])),a.push(["F11","ctrlDialogFullscreen"]),a.push(["ctrlKeyEsc","ctrlDialogQuit"]),this.elemA=document.createElement("div"),this.elemA.setAttribute("class","kbd"),this.elemB=document.createElement("ul"),i=0;i<a.length;i++){for(o=a[i].length-1,this.elemC=document.createElement("li"),s=0;s<o;s++)this.elemD=document.createElement("kbd"),0<a[i][s].indexOf(";")?(n=a[i][s].split(";"),this.elemD.setAttribute("class",n[0]),this.elemD.setAttribute("title",n[1])):this.elemD.appendChild(apijs.i18n.nodeTranslate(a[i][s])),this.elemC.appendChild(this.elemD);this.elemC.appendChild(apijs.i18n.nodeTranslate(a[i][o])),this.elemB.appendChild(this.elemC)}this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)}},apijs.core.styles=function(){this.data=[],this.init=function(e,t){this.data.push(e),"string"==typeof t&&(this.data=this.data.concat(t.split(" ")))},this.add=function(e){return this.data.hasOwnProperty(e)||this.data.push(e),this.data},this.toggle=function(e,t){this.has(e)&&this.remove(e),this.has(t)||this.add(t)},this.has=function(){return null!==this.data&&apijs.inArray(this.data,Array.prototype.slice.call(arguments,0))},this.remove=function(){var e,t=Array.prototype.slice.call(arguments,0);for(e in t)t.hasOwnProperty(e)&&this.data.splice(this.data.indexOf(t[e]),1);return this.data},this.toString=function(){return this.data.join(" ")}},apijs.core.slideshow=function(){this.started=0,this.current=null,this.init=function(){for(var e,t,i,s=apijs.config.slideshow.ids,n=0;null!==document.getElementById(s+"."+n);n++){for(i=-1<document.getElementById(s+"."+n).getAttribute("class").indexOf("hoverload"),e=0;null!==document.getElementById(s+"."+n+"."+e);e++)document.getElementById(s+"."+n+"."+e).addEventListener("click",apijs.slideshow.showMedia.bind(this),!1),i&&document.getElementById(s+"."+n+"."+e).addEventListener("mouseover",apijs.slideshow.showMedia.bind(this),!1);document.getElementById(s+"."+n+".999")&&document.getElementById(s+"."+n+".999").addEventListener("click",apijs.slideshow.showMedia.bind(this),!1),this.started+=1}new RegExp("#("+s+"(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)").test(location.href)&&(t=RegExp.$1.replace(/-/g,"."),document.getElementById(t)&&this.showMedia(t))},this.showMedia=function(e){var t,i={};if("string"==typeof e)t=document.getElementById(e),i.id=e;else if(e.preventDefault(),t="A"===e.target.nodeName?e.target:e.target.parentNode,i.id=t.getAttribute("id"),"mouseover"===e.type&&t.hasAttribute("class")&&-1<t.getAttribute("class").indexOf("current"))return;if(i.prefix=apijs.config.slideshow.ids+"."+i.id.split(".")[1],i.number=i.numberSrc=parseInt(i.id.split(".")[2],10),i.presentation=document.getElementById(i.prefix+".999"),999!==i.number){var s,n=document.getElementById(i.prefix).querySelectorAll("a[id][type]"),o=document.getElementById(i.prefix).querySelectorAll("dl");if(null!==i.presentation||n.length!==o.length){for(s=0;s<n.length;s++)n[s].hasAttribute("class")&&n[s].removeAttribute("class");t.setAttribute("class","current")}else{for(s=0;s<o.length;s++)o[s].hasAttribute("class")&&o[s].removeAttribute("class");t.parentNode.parentNode.setAttribute("class","current")}}null!==i.presentation?(999===i.number&&(t=i.presentation.hasAttribute("class")?i.presentation.getAttribute("class"):i.prefix+".0",t=document.getElementById(t),i.number=parseInt(t.getAttribute("id").split(".")[2],10)),i.config=t.querySelector("input").getAttribute("value").split("|"),i.mainImg=i.config.shift(),999!==i.numberSrc&&(i.presentation.setAttribute("href",t.getAttribute("href")),i.presentation.querySelector("img").setAttribute("src",i.mainImg),i.presentation.querySelector("img").setAttribute("alt",t.querySelector("img").getAttribute("alt")),i.presentation.setAttribute("class",i.id)),i.mainImg=null):i.config=t.querySelector("input").getAttribute("value").split("|"),i.url=t.getAttribute("href"),i.type=t.getAttribute("type").substr(0,5).replace("image","dialogPhoto").replace("video","dialogVideo"),i.styles=document.getElementById(i.prefix).getAttribute("class").replace(/gallery|album/g,"slideshow"),(i.presentation&&999===i.numberSrc||!i.presentation||"string"==typeof e)&&this.showDialog(i)},this.showDialog=function(e){apijs.dialog[e.type](e.url,e.config[0],e.config[1],e.config[2],e.styles),null!==apijs.dialog.styles&&apijs.dialog.styles.has("slideshow")?(this.current={number:e.number,first:null,prev:null,next:null,last:null,total:null},this.current.total=document.getElementById(e.prefix).querySelectorAll("a[id][type]").length-1,this.current.total=e.presentation?this.current.total-1:this.current.total,this.current.first=e.prefix+".0",this.current.prev=0<e.number?e.prefix+"."+(this.current.number-1):null,this.current.next=e.number<this.current.total?e.prefix+"."+(this.current.number+1):null,this.current.last=e.prefix+"."+this.current.total,null!==this.current.prev&&document.getElementById("apijsPrev").removeAttribute("disabled"),null!==this.current.next&&document.getElementById("apijsNext").removeAttribute("disabled")):this.current=null},this.actionFirst=function(){null!==this.current&&0<this.current.number&&this.current.number<=this.current.total&&this.showMedia(this.current.first)},this.actionPrev=function(){null!==this.current&&null!==this.current.prev&&0<this.current.number&&this.showMedia(this.current.prev)},this.actionNext=function(){null!==this.current&&null!==this.current.next&&this.current.number<this.current.total&&this.showMedia(this.current.next)},this.actionLast=function(){null!==this.current&&0<=this.current.number&&this.current.number<this.current.total&&this.showMedia(this.current.last)}},apijs.core.upload=function(){this.title=null,this.maxsize=0,this.extensions=null,this.callback=null,this.args=null,this.icon=null,this.startTime=0,this.lastTime=0,this.sendFile=function(e,t,i,s,n,o,a,l){var r;"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"number"==typeof s&&"string"==typeof n&&"function"==typeof o?(this.title=e,this.maxsize=s,this.extensions=n.split(","),this.callback=o,this.args=a,this.icon=l,s=s.toFixed(2).replace(".00","").replace(".",apijs.i18n.translate("uploadDecimal")),r="*"===this.extensions[0]?apijs.i18n.translate("uploadAllType",s):1===this.extensions.length?apijs.i18n.translate("uploadOneType",n,s):apijs.i18n.translate("uploadMultiType",this.extensions.slice(0,-1).join(", "),this.extensions.slice(-1),s),apijs.dialog.dialogFormUpload(e,r,t,i,l)):("function"==typeof o&&"string"==typeof o.name&&0<o.name.length&&(o=o.name),apijs.error("TheUpload.sendFile",{"(string) *title":e,"(string) *action":t,"(string) *inputname":i,"(number) *maxsize":s,"(string) *extensions":n,"(function) *callback":o,"(mixed) args":a,"(string) icon":l}))},this.actionConfirm=function(e){var t=document.getElementById("apijsFile"),i=apijs.dialog.tagBox.querySelector("div.status").firstChild,s={filePresent:!1,fileType:!0,fileSize:!1,type:"",size:this.maxsize};if(null!==this.extensions&&0<t.value.length&&(s.filePresent=!0,"*"!==this.extensions[0]&&(s.type=t.value.slice(t.value.lastIndexOf(".")+1).toLowerCase(),apijs.inArray(s.type,this.extensions)||(s.fileType=!1)),"object"==typeof t.files&&(s.size=t.files[0].size),0<s.size&&s.size<=1048576*this.maxsize&&(s.fileSize=!0)),s.filePresent&&s.fileType&&s.fileSize)try{0<e.indexOf("noAjax")?(apijs.dialog.tagBox.submit(),window.setTimeout(apijs.upload.onStart.bind(this),12)):this.startUpload(e)}catch(e){apijs.dialog.tagBox.submit(),window.setTimeout(apijs.upload.onStart.bind(this),12),console.warn(e)}else null!==this.extensions&&(s.filePresent&&!s.fileType?i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadBadType",s.type)):s.filePresent&&!s.fileSize&&0<s.size?(s.size=(s.size/1048576).toFixed(2).replace(".00","").replace(".",apijs.i18n.translate("uploadDecimal")),i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadBadSize",s.size))):s.filePresent&&!s.fileSize&&i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadEmpty")),apijs.dialog.tagBox.querySelector(".browse").focus())},this.startUpload=function(e){var t=new FormData,i=new XMLHttpRequest;t.append(document.getElementById("apijsFile").getAttribute("name"),document.getElementById("apijsFile").files[0]),i.open("POST",e+(0<e.indexOf("?")?"&isAjax=true":"?isAjax=true"),!0),"string"==typeof apijs.config.upload.tokenValue&&i.setRequestHeader("X-CSRF-Token",apijs.config.upload.tokenValue),i.onreadystatechange=function(){var e;4===i.readyState&&200===i.status?(e=i.responseText.trim(),apijs.config.debug&&console.info("(onreadystatechange) upload ended with status 200: "+e),0===e.indexOf("success-")?apijs.upload.onSuccess(e.slice(8)):apijs.upload.onError("uploadError2",e)):4===i.readyState&&(apijs.config.debug&&console.warn("(onreadystatechange) upload ended with status "+i.status+": "+i.responseText),apijs.upload.onError("uploadError1",i.status))},i.upload.addEventListener("loadstart",apijs.upload.onStart.bind(this),!1),i.upload.addEventListener("progress",apijs.upload.onProgress.bind(this),!1),i.upload.addEventListener("load",apijs.upload.onProgress.bind(this),!1),i.upload.addEventListener("error",apijs.upload.onError.bind(this),!1),i.send(t)},this.onError=function(e,t){t="string"==typeof e?"uploadError2"===e&&0<t.indexOf("[/")?t:apijs.i18n.translate(e,t):apijs.i18n.translate("uploadError0"),this.updateTitle(),this.icon=null!==this.icon?"upload error "+this.icon:"upload error",apijs.dialog.dialogInformation(this.title,t,this.icon),this.title=null,this.maxsize=0,this.extensions=null,this.callback=null,this.args=null,this.icon=null,this.startTime=0,this.lastTime=0},this.onSuccess=function(e){this.updateTitle(),this.callback(e,this.args),this.title=null,this.maxsize=0,this.extensions=null,this.callback=null,this.args=null,this.icon=null,this.startTime=0,this.lastTime=0},this.onStart=function(){this.startTime=this.lastTime=Math.round((new Date).getTime()/1e3),apijs.dialog.dialogProgress(this.title,apijs.i18n.translate("uploadInProgress"),this.icon)},this.onProgress=function(e){var t,i,s,n,o,a,l=Math.round((new Date).getTime()/1e3);e.lengthComputable&&"progress"===e.type&&l>=this.lastTime+2?(this.lastTime=l,0<(t=Math.floor(100*e.loaded/e.total))&&t<100&&(this.updateTitle(t),l=100*(o=l-this.startTime)/t+10,25<=o&&(n=Math.round(l-o),n=10*Math.ceil(n/10),a=Math.ceil(n/60),s=Math.round(e.loaded/o/1024),o<40||l<90?(i=14,n=null):1<a?(i=11,n=a):50<n?(i=12,n=1):i=13),this.updateProgress(t,i,s,n))):"load"===e.type&&(n=Math.round((new Date).getTime()/1e3)-this.startTime,a=Math.ceil(n/60),0<(s=Math.round(e.loaded/n/1024))&&s!==1/0?1<a?(i=21,n=a):50<n?(i=22,n=1):20<n?i=23:(i=24,n=null):n=s=null,this.updateTitle(100),this.updateProgress(100,i,s,n))},this.updateProgress=function(e,t,i,s){var n,o=document.getElementById("apijsProgress").querySelector("rect"),a=document.getElementById("apijsProgress").querySelector("text").firstChild;99<e?(o.setAttribute("class","end"),o.style.width="",n="100%"):(o.style.width=n=e+"%",o.hasAttribute("class")&&o.removeAttribute("class")),"number"==typeof t&&"number"==typeof i&&"number"==typeof s?n=apijs.i18n.translate("upload"+t,e,i,s):"number"==typeof t&&"number"==typeof i&&(n=apijs.i18n.translate("upload"+t,e,i)),a.replaceData(0,a.length,n)},this.updateTitle=function(e){"number"==typeof e?document.title=/^[0-9]{1,3}% - /.test(document.title)?e+"% - "+document.title.slice(document.title.indexOf(" - ")+3):e+"% - "+document.title:/^[0-9]{1,3}% - /.test(document.title)&&(document.title=document.title.slice(document.title.indexOf(" - ")+3))}};