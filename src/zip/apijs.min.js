/*!
 * Copyright 2008-2010 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/apijs - 1.2.1
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
var i18n=null,TheButton=null,TheDialogue=null,TheSlideshow=null,TheUpload=null,TheMap=null,config={version:"1.2.0",lang:"fr",debug:!0,debugkey:!1,navigator:!0,autolang:!0,dialogue:{blocks:[],hiddenPage:!1,showLoader:!0,autoplay:!0,savePhoto:!0,saveVideo:!0,videoWidth:640,videoHeight:480,imageClose:"./images/dialogue/close.png",imageUpload:"./images/dialogue/progressbar.svg",filePhoto:"./download.php",fileVideo:"./download.php",fileUpload:"./iframe.php"},slideshow:{ids:"diaporama",hiddenPage:!0,hoverload:!1},map:{width:580,height:400,initLatitude:1.9,initLongitude:46.3,imageMarker:"./images/map/marker.png",zoomInitial:5,zoomCenter:14,zoomSynchro:15}};function start(){for(var e=document.getElementsByTagName("a"),t=e.length,i=0;i<t;i++)config.navigator&&e[i].hasAttribute("class")&&-1<e[i].getAttribute("class").indexOf("popup")?e[i].addEventListener("click",openTab,!1):-1<e[i].className.indexOf("popup")&&e[i].setAttribute("onclick","window.open(this.href); return false;");"function"==typeof Internationalization&&"function"==typeof BBcode&&"function"==typeof Dialogue&&((i18n=new Internationalization).init(),TheDialogue=new Dialogue,"function"==typeof Slideshow&&(TheSlideshow=new Slideshow).init(),"function"==typeof Map&&document.getElementById("carteInteractive")&&(TheMap=new Map).init())}function openTab(e){e.preventDefault(),window.open(this.href)}function checkAll(){var e=0,t=0,i=[],o=null,n=null,l=null,o={version:"string",lang:"string",debug:"boolean",debugkey:"boolean",navigator:"boolean",autolang:"boolean",dialogue:{blocks:"object",hiddenPage:"boolean",showLoader:"boolean",autoplay:"boolean",savePhoto:"boolean",saveVideo:"boolean",videoWidth:"number",videoHeight:"number",imageClose:"string",imageUpload:"string",filePhoto:"string",fileVideo:"string",fileUpload:"string"},slideshow:{ids:"string",hiddenPage:"boolean",hoverload:"boolean"}};for(n in i.push("The apijs "+config.version),i.push("\nChecking modules"),"function"==typeof BBcode&&(i.push("➩ BBcode is here"),e++),"function"==typeof Internationalization&&i18n instanceof Internationalization?(i.push("➩ Internationalization is here and loaded"),e++):"function"==typeof Internationalization&&(i.push("➩ Internationalization is here"),e++),"function"==typeof Button&&TheButton instanceof Button?(i.push("➩ TheButton is here and loaded"),e++):"function"==typeof Button&&(i.push("➩ TheButton is here"),e++),"function"==typeof Dialogue&&TheDialogue instanceof Dialogue?(i.push("➩ TheDialogue is here and loaded"),e++):"function"==typeof Dialogue&&(i.push("➩ TheDialogue is here"),e++),"function"==typeof Upload&&TheUpload instanceof Upload?(i.push("➩ TheUpload is here and loaded"),e++):"function"==typeof Upload&&(i.push("➩ TheUpload is here"),e++),"function"==typeof Slideshow&&TheSlideshow instanceof Slideshow?(i.push("➩ TheSlideshow is here and loaded"),e++):"function"==typeof Slideshow&&(i.push("➩ TheSlideshow is here"),e++),"function"==typeof Map&&TheMap instanceof Map?(i.push("➩ TheMap is here and loaded"),e++):"function"==typeof Map&&(i.push("➩ TheMap is here"),e++),e<1&&i.push("➩ no module present"),i.push("\nChecking configuration"),o)if(o.hasOwnProperty(n)){if("dialogue"===n&&"function"!=typeof Dialogue)continue;if("slideshow"===n&&"function"!=typeof Slideshow)continue;if("map"===n&&"function"!=typeof Map)continue;if("object"==typeof o[n])for(l in o[n])void 0===config[n][l]?(i.push("☠ config."+n+"."+l+" is missing"),t++):null===config[n][l]&&"string"===o[n][l]?(i.push("⚠ config."+n+"."+l+" is null"),0):typeof config[n][l]!==o[n][l]&&(i.push("☠ config."+n+"."+l+" isn't a "+o[n][l]),t++);else void 0===config[n]?(i.push("☠ config."+n+" is missing"),t++):null===config[n]&&"string"===o[n]?(i.push("⚠ config."+n+" is null"),0):typeof config[n]!==o[n]&&(i.push("☠ config."+n+" isn't a "+o[n]),t++)}t<1&&i.push("➩ no error found"),alert(i.join("\n"))}function Internationalization(){this.data=[],this.data.de={buttonOk:"Ok",buttonCancel:"Abbrechen",buttonConfirm:"Bestätigen",buttonClose:"Ende",downloadLink:"Laden",operationTooLong:"This operation is too long ? ",warningLostChange:"Achtung : alle laufenden änderungen werden verloren.",reloadLink:"Seite nochmal laden",debugInvalidCall:"(debug) Invalid call",debugInvalidUse:"(debug) Invalid use",debugInvalidAltAttribute:"(debug) Invalid alt attribute",debugUnknownAction:"(debug) Unknown action",debugKeyDetected:"(debug) Key detected",debugKeyCode:"Code of the seizure key : §",debugNotExist:"doesn't exist (unlikely error).",debugNotRecognizedAltAttribute:"The alt attribute of the image wasn't recognized."},this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",downloadLink:"Download",operationTooLong:"This operation is too long ? ",warningLostChange:"Warning : all changes in progress will be lost.",reloadLink:"Reload this page",debugInvalidCall:"(debug) Invalid call",debugInvalidUse:"(debug) Invalid use",debugInvalidAltAttribute:"(debug) Invalid alt attribute",debugUnknownAction:"(debug) Unknown action",debugKeyDetected:"(debug) Key detected",debugKeyCode:"Code of the seizure key : §",debugNotExist:"doesn't exist (unlikely error).",debugNotRecognizedAltAttribute:"The alt attribute of the image wasn't recognized."},this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",downloadLink:"Télécharger",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",debugInvalidCall:"(debug) Appel invalide",debugInvalidUse:"(debug) Utilisation invalide",debugInvalidAltAttribute:"(debug) Attribut alt invalide",debugUnknownAction:"(debug) Action inconnue",debugKeyDetected:"(debug) Touche détectée",debugKeyCode:"Code de la touche saisie : §",debugNotExist:"n'existe pas (erreur improbable).",debugNotRecognizedAltAttribute:"L'attribut alt de l'image n'a pas été reconnu."},this.init=function(){"string"==typeof navigator.language&&config.autolang&&navigator.language.slice(0,2)in this.data?config.lang=navigator.language.slice(0,2):"string"==typeof config.lang&&config.lang in this.data||(config.lang="en")},this.translate=function(e,t,i,o,n,l){if("string"!=typeof this.data[config.lang][e])return e;if(1<arguments.length){var a=0,s=1,d="",r=this.data[config.lang][e].split("§");for(a in r)r.hasOwnProperty(a)&&(d+=s<arguments.length?r[a]+arguments[s++]:r[a]);return d}return this.data[config.lang][e]}}function BBcode(){this.id=null,this.init=function(e){this.id=e},this.parse=function(e){var t=document.createElement("p");if(0<e.search(/[br]/)){e=e.split("[br]"),t.appendChild(document.createTextNode(e[0]));for(var i=1;i<e.length;i++)t.appendChild(document.createElement("br")),t.appendChild(document.createTextNode(e[i]))}else t.appendChild(document.createTextNode(e));document.getElementById(this.id).appendChild(t)}}function Dialogue(){this.offset=0,this.page=!0,this.timer=null,this.dialogue=null,this.image=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.dialogInformation=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.setupDialogue(i="string"!=typeof i?"information":i),this.htmlParent(),this.htmlTitle(e),this.htmlParagraph(t),this.htmlButtonOk()):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogInformation[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (string) icon : "+i)},this.dialogConfirmation=function(e,t,i,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof i?(this.setupDialogue(o="string"!=typeof o?"confirmation":o),this.htmlParent(),this.htmlTitle(e),this.htmlParagraph(t),this.htmlButtonConfirm(i)):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogConfirmation[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (string) action : "+i+"[br]➩ (string) icon : "+o)},this.dialogUpload=function(e,t,i,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof o&&"string"==typeof i?(this.setupDialogue("upload"),this.htmlParent(),this.htmlTitle(e),this.htmlParagraph(t),this.htmlFormUpload(i,o),this.htmlButtonConfirm("upload")):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogUpload[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (string) data : "+i+"[br]➩ (string) key : "+o)},this.dialogProgress=function(e,t){"string"==typeof e&&"string"==typeof t?(this.setupDialogue("progress"),this.htmlParent(),this.htmlTitle(e),this.htmlParagraph(t),this.htmlProgressBar(),this.timer=window.setTimeout(TheDialogue.htmlLinkReload,1e4)):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogProgress[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t)},this.dialogWaiting=function(e,t){"string"==typeof e&&"string"==typeof t?(this.setupDialogue("waiting"),this.htmlParent(),this.htmlTitle(e),this.htmlParagraph(t),this.timer=window.setTimeout(TheDialogue.htmlLinkReload,4e3)):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogWaiting[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t)},this.dialogPhoto=function(e,t,i,o,n,l){"number"==typeof e&&"number"==typeof t&&"string"==typeof i&&"string"==typeof o&&"string"==typeof n&&"string"==typeof l?(this.setupDialogue("photo"),this.htmlParent(),this.htmlPhoto(e,t,i,o,n,l),this.htmlButtonClose(),this.htmlButtonNavigation()):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogPhoto[br]➩ (number) width : "+e+"[br]➩ (number) height : "+t+"[br]➩ (string) url : "+i+"[br]➩ (string) name : "+o+"[br]➩ (string) date : "+n+"[br]➩ (string) legend : "+l)},this.dialogVideo=function(e,t,i,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof o&&"string"==typeof o?(this.setupDialogue("video"),this.htmlParent(),this.htmlVideo(e,t,i,o),this.htmlButtonClose(),this.htmlButtonNavigation()):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogVideo[br]➩ (string) url : "+e+"[br]➩ (string) name : "+t+"[br]➩ (string) date : "+i+"[br]➩ (string) legend : "+o)},this.dialogAuto=function(e){"string"==typeof e&&document.getElementById(e)?(document.getElementById(e).setAttribute("class",document.getElementById(e).getAttribute("class").replace("nodisplay","dialogue")),document.getElementById(e+"Cancel").setAttribute("onclick","TheDialogue.actionClose(true);"),this.setupDialogue("auto "+e)):config.debug&&this.dialogInformation(i18n.translate("debugInvalidCall"),"TheDialogue » dialogAuto[br]➩ (string) id : "+e)},this.actionClose=function(e){e?(this.deleteDialogue(),this.showPage()):(this.deleteDialogue(),this.dialogue=null,this.page=!1)},this.actionConfirm=function(e){"option"===e?document.getElementBydId("formOption").submit():"cancel"===e||"delete"===e?"function"==typeof Button&&TheButton instanceof Button?TheButton.actionConfirm(e):config.debug&&this.dialogInformation(i18n.translate("debugInvalidUse"),"TheDialogue » actionConfirm[br]➩ TheButton "+i18n.translate("debugNotExist")):"upload"===e?"function"==typeof Upload&&TheUpload instanceof Upload?TheUpload.actionConfirm():config.debug&&this.dialogInformation(i18n.translate("debugInvalidUse"),"TheDialogue » actionConfirm[br]➩ TheUpload "+i18n.translate("debugNotExist")):config.debug&&this.dialogInformation(i18n.translate("debugUnknownAction"),"TheDialogue » actionConfirm[br]➩ (string) action : "+e)},this.actionKey=function(e){config.debugkey?(e.preventDefault(),TheDialogue.dialogInformation(i18n.translate("debugKeyDetected"),"TheDialogue » actionKey[br]"+i18n.translate("debugKeyCode",e.keyCode))):27!==e.keyCode||"waiting"!==TheDialogue.dialogue&&"progress"!==TheDialogue.dialogue?27===e.keyCode?(e.preventDefault(),TheDialogue.actionClose(!0)):35!==e.keyCode||"photo"!==TheDialogue.dialogue&&"video"!==TheDialogue.dialogue||null===TheSlideshow?36!==e.keyCode||"photo"!==TheDialogue.dialogue&&"video"!==TheDialogue.dialogue||null===TheSlideshow?37!==e.keyCode||"photo"!==TheDialogue.dialogue&&"video"!==TheDialogue.dialogue||null===TheSlideshow?39!==e.keyCode||"photo"!==TheDialogue.dialogue&&"video"!==TheDialogue.dialogue||null===TheSlideshow||(e.preventDefault(),TheSlideshow.actionNext()):(e.preventDefault(),TheSlideshow.actionPrev()):(e.preventDefault(),TheSlideshow.actionFirst()):(e.preventDefault(),TheSlideshow.actionLast()):e.preventDefault()},this.setupDialogue=function(e){if(null!==this.dialogue&&this.deleteDialogue(),config.dialogue.hiddenPage||null!==TheSlideshow&&config.slideshow.hiddenPage&&e.match(/(photo)|(video)/))for(var t in this.page&&(0<window.pageYOffset||0<this.offset)&&(this.offset=window.pageYOffset),config.dialogue.blocks)config.dialogue.blocks.hasOwnProperty(t)&&(config.navigator?document.getElementById(config.dialogue.blocks[t]).setAttribute("class","nodisplay"):document.getElementById(config.dialogue.blocks[t]).className="nodisplay");config.navigator&&document.addEventListener("keydown",TheDialogue.actionKey,!1),this.dialogue=e,this.page=!1},this.deleteDialogue=function(){this.timer&&clearTimeout(this.timer),config.navigator&&document.removeEventListener("keydown",TheDialogue.actionKey,!1),this.dialogue.match(/auto/)?(document.getElementById(this.dialogue.slice(5)+"Cancel").removeAttribute("onclick"),document.getElementById(this.dialogue.slice(5)).setAttribute("class",document.getElementById(this.dialogue.slice(5)).getAttribute("class").replace("dialogue","nodisplay"))):document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue")),this.timer=null,this.image=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null},this.showPage=function(){if(document.getElementById("iframeUpload")&&document.getElementById("iframeUpload").parentNode.removeChild(document.getElementById("iframeUpload")),config.dialogue.hiddenPage||null!==TheSlideshow&&config.slideshow.hiddenPage&&this.dialogue.match(/(photo)|(video)/)){for(var e in config.dialogue.blocks)config.dialogue.blocks.hasOwnProperty(e)&&(config.navigator?document.getElementById(config.dialogue.blocks[e]).removeAttribute("class"):document.getElementById(config.dialogue.blocks[e]).className="");window.scrollBy(0,this.offset)}this.dialogue=null,this.page=!0},this.changeSize=function(e,t){return e>window.innerWidth-150||t>window.innerHeight-100},this.setSize=function(e,t,i){var o={width:e,height:t,id:i.slice(i.lastIndexOf("/")+1,i.lastIndexOf(".")),mime:null},n={width:window.innerWidth,height:window.innerHeight},l={ogv:"video/ogg",webm:"video/webm",jpg:"image/jpeg",jpeg:"image/jpeg",tif:"image/tiff",tiff:"image/tiff",png:"image/png",svg:"image/svg+xml"};return o.mime=i.slice(i.lastIndexOf(".")+1),o.mime in l&&(o.mime=l[o.mime]),this.changeSize(e,t)&&(n.width-=150,n.height-=100,o.width>n.width?(o.height=Math.floor(o.height*(n.width/o.width)),o.width=n.width,o.height>n.height&&(o.width=Math.floor(o.width*(n.height/o.height)),o.height=n.height)):o.height>n.height&&(o.width=Math.floor(o.width*(n.height/o.height)),o.height=n.height,o.width>n.width&&(o.height=Math.floor(o.height*(n.width/o.width)),o.width=n.width))),document.getElementById("box").style.width=o.width+"px",document.getElementById("box").style.marginLeft=parseInt(-(o.width+20)/2,10)+"px",document.getElementById("box").style.marginTop=parseInt(-(o.height+50)/2,10)+"px",o},this.htmlParent=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("id","dialogue"),this.elemB=document.createElement("div"),this.elemB.setAttribute("id","box"),this.elemB.setAttribute("class",this.dialogue),this.elemA.appendChild(this.elemB),document.getElementsByTagName("body")[0].appendChild(this.elemA)},this.htmlTitle=function(e){this.elemA=document.createElement("h1"),this.elemA.appendChild(document.createTextNode(e)),document.getElementById("box").appendChild(this.elemA)},this.htmlParagraph=function(e){var t=new BBcode;t.init("box"),t.parse(e)},this.htmlButtonOk=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","confirm"),this.elemB.setAttribute("onclick","TheDialogue.actionClose(true);"),this.elemB.appendChild(document.createTextNode(i18n.translate("buttonOk"))),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA),document.getElementById("box").lastChild.lastChild.focus()},this.htmlButtonConfirm=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","cancel"),this.elemB.setAttribute("onclick","TheDialogue.actionClose(true);"),this.elemB.appendChild(document.createTextNode(i18n.translate("buttonCancel"))),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","confirm"),this.elemB.setAttribute("onclick","TheDialogue.actionConfirm('"+e+"');"),this.elemB.appendChild(document.createTextNode(i18n.translate("buttonConfirm"))),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA),(document.getElementById("formUpload")?document.getElementById("formUpload").firstChild.firstChild:document.getElementById("box").lastChild.lastChild).focus()},this.htmlButtonNavigation=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","navigation"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","TheSlideshow.actionPrev();"),this.elemB.setAttribute("id","prev"),this.elemB.appendChild(document.createTextNode("«")),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","TheSlideshow.actionNext();"),this.elemB.setAttribute("id","next"),this.elemB.appendChild(document.createTextNode("»")),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA)},this.htmlButtonClose=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","close"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","close"),this.elemB.setAttribute("onclick","TheDialogue.actionClose(true);"),this.elemC=document.createElement("img"),this.elemC.setAttribute("src",config.dialogue.imageClose),this.elemC.setAttribute("width","60"),this.elemC.setAttribute("height","22"),this.elemC.setAttribute("alt",i18n.translate("buttonClose")),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA)},this.htmlLinkReload=function(){this.elemA=document.createElement("p"),this.elemA.setAttribute("class","reload"),this.elemA.appendChild(document.createTextNode(i18n.translate("operationTooLong"))),this.elemB=document.createElement("a"),this.elemB.setAttribute("href",document.URL),this.elemB.appendChild(document.createTextNode(i18n.translate("reloadLink"))),this.elemA.appendChild(this.elemB),this.elemA.appendChild(document.createTextNode(".")),this.elemB=document.createElement("br"),this.elemA.appendChild(this.elemB),this.elemA.appendChild(document.createTextNode(i18n.translate("warningLostChange"))),document.getElementById("box").appendChild(this.elemA)},this.htmlFormUpload=function(e,t){this.elemA=document.createElement("iframe"),this.elemA.setAttribute("id","iframeUpload"),this.elemA.setAttribute("name","iframeUpload_"+t),config.navigator&&this.elemA.setAttribute("src",config.dialogue.imageUpload),document.getElementsByTagName("body")[0].appendChild(this.elemA),this.elemA=document.createElement("form"),this.elemA.setAttribute("id","formUpload"),this.elemA.setAttribute("action",config.dialogue.fileUpload),this.elemA.setAttribute("method","post"),this.elemA.setAttribute("enctype","multipart/form-data"),this.elemA.setAttribute("target","iframeUpload_"+t),this.elemB=document.createElement("p"),this.elemC=document.createElement("input"),this.elemC.setAttribute("type","file"),this.elemC.setAttribute("name",e),this.elemC.setAttribute("onchange","document.getElementById('box').lastChild.lastChild.focus();"),this.elemB.appendChild(this.elemC),this.elemC=document.createElement("input"),this.elemC.setAttribute("type","hidden"),this.elemC.setAttribute("name","APC_UPLOAD_PROGRESS"),this.elemC.setAttribute("value",t),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA)},this.htmlProgressBar=function(){this.elemA=document.createElement("object"),this.elemA.setAttribute("id","progressbar"),this.elemA.setAttribute("type","image/svg+xml"),this.elemA.setAttribute("data",config.dialogue.imageUpload),this.elemA.setAttribute("width","300"),this.elemA.setAttribute("height","17"),document.getElementById("box").appendChild(this.elemA)},this.htmlPhoto=function(e,t,i,o,n,l){var a=this.setSize(e,t,i);this.elemA=document.createElement("dl"),this.elemB=document.createElement("dt"),this.changeSize(e,t)?(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",i),this.elemC.setAttribute("onclick","window.open(this.href); this.blur(); return false;"),this.elemD=document.createElement("img"),this.elemD.setAttribute("width",a.width),this.elemD.setAttribute("height",a.height),this.elemD.setAttribute("class","loading resized"),this.elemD.setAttribute("id","topho"),this.elemC.appendChild(this.elemD),this.elemC.appendChild(document.createElement("span"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("width",a.width),this.elemC.setAttribute("height",a.height),this.elemC.setAttribute("class","loading"),this.elemC.setAttribute("id","topho")),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===o&&"false"===n||(this.elemC=document.createElement("span"),"false"!==o&&"auto"!==o&&"false"!==n?this.elemC.appendChild(document.createTextNode(o+" ("+n+")")):"false"!==o&&"auto"!==o?this.elemC.appendChild(document.createTextNode(o)):"auto"===o&&"false"!==n?this.elemC.appendChild(document.createTextNode(a.id+" ("+n+")")):"auto"===o?this.elemC.appendChild(document.createTextNode(a.id)):"false"!==n&&this.elemC.appendChild(document.createTextNode("("+n+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+l+" ")),config.dialogue.savePhoto&&(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",config.dialogue.filePhoto+"?id="+a.id),this.elemC.setAttribute("type",a.mime),this.elemC.setAttribute("class","download"),this.elemC.appendChild(document.createTextNode(i18n.translate("downloadLink"))),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA),config.navigator&&config.dialogue.showLoader?(this.image=new Image(e,t),this.image.src=i,this.image.addEventListener("load",function(){document.getElementById("topho")&&(document.getElementById("topho").removeAttribute("class"),document.getElementById("topho").setAttribute("src",TheDialogue.image.src))},!1),this.image.addEventListener("error",function(){var e;document.getElementById("topho")&&(document.getElementById("topho").getAttribute("class").match(/resized/)&&(e=document.getElementById("topho").cloneNode(!0),document.getElementById("topho").parentNode.parentNode.removeChild(document.getElementById("topho").parentNode),document.getElementById("box").firstChild.firstChild.appendChild(e)),config.dialogue.savePhoto&&document.getElementById("box").firstChild.lastChild.removeChild(document.getElementById("box").firstChild.lastChild.lastChild),document.getElementById("topho").setAttribute("class","error_"+config.lang))},!1)):(document.getElementById("topho").removeAttribute("class"),document.getElementById("topho").setAttribute("src",i))},this.htmlVideo=function(e,t,i,o){var n=this.setSize(config.dialogue.videoWidth,config.dialogue.videoHeight,e);this.elemA=document.createElement("dl"),this.elemB=document.createElement("dt"),this.elemC=document.createElement("video"),this.elemC.setAttribute("src",e),this.elemC.setAttribute("width",n.width),this.elemC.setAttribute("height",n.height),this.elemC.setAttribute("controls","controls"),config.dialogue.autoplay&&this.elemC.setAttribute("autoplay","autoplay"),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===t&&"false"===i||(this.elemC=document.createElement("span"),"false"!==t&&"auto"!==t&&"false"!==i?this.elemC.appendChild(document.createTextNode(t+" ("+i+")")):"false"!==t&&"auto"!==t?this.elemC.appendChild(document.createTextNode(t)):"auto"===t&&"false"!==i?this.elemC.appendChild(document.createTextNode(n.id+" ("+i+")")):"auto"===t?this.elemC.appendChild(document.createTextNode(n.id)):"false"!==i&&this.elemC.appendChild(document.createTextNode("("+i+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+o+" ")),config.dialogue.saveVideo&&(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",config.dialogue.fileVideo+"?id="+n.id),this.elemC.setAttribute("type",n.mime),this.elemC.setAttribute("class","download"),this.elemC.appendChild(document.createTextNode(i18n.translate("downloadLink"))),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),document.getElementById("box").appendChild(this.elemA)}}function Slideshow(){this.media=null,this.totals=null,this.presentation=null,this.init=function(){this.media={album:null,number:null,first:null,prev:null,next:null,last:null},this.totals=[],this.presentation=[];for(var e=null,t=0,i=0;null!==document.getElementById(config.slideshow.ids+"."+t);t++)for(e=config.slideshow.ids+"."+t+".999",this.presentation[t]=!!document.getElementById(e)&&0,document.getElementById(e)&&(config.navigator?document.getElementById(e).addEventListener("click",TheSlideshow.showMedia,!1):document.getElementById(e).setAttribute("onclick","TheSlideshow.showMedia(this.getAttribute('id')); return false;")),i=0;null!==document.getElementById(config.slideshow.ids+"."+t+"."+i);i++)e=config.slideshow.ids+"."+t+"."+i,config.navigator?config.slideshow.hoverload&&!1!==this.presentation[t]?(document.getElementById(e).addEventListener("click",TheSlideshow.showMedia,!1),document.getElementById(e).addEventListener("mouseover",TheSlideshow.showMedia,!1)):document.getElementById(e).addEventListener("click",TheSlideshow.showMedia,!1):config.slideshow.hoverload&&!1!==this.presentation[t]?(document.getElementById(e).setAttribute("onclick","TheSlideshow.showMedia(this.getAttribute('id')); return false;"),document.getElementById(e).setAttribute("onmouseover","TheSlideshow.showMedia(this.getAttribute('id')); return false;")):document.getElementById(e).setAttribute("onclick","TheSlideshow.showMedia(this.getAttribute('id')); return false;"),this.totals[t]=i},this.showMedia=function(e){var t={id:null,url:null,alt:null,num:0,name:null,date:null,legend:null,width:null,height:null},i=null,i=("string"!=typeof e?(e.preventDefault(),t.id=this.getAttribute("id"),t.url=this.getAttribute("href"),t.alt=this.firstChild.getAttribute("alt").split("|")):(t.id=e,t.url=document.getElementById(t.id).getAttribute("href"),t.alt=document.getElementById(t.id).firstChild.getAttribute("alt").split("|")),t.id.split("."));if(t.album=parseInt(i[1],10),t.number=parseInt(i[2],10),!1!==TheSlideshow.presentation[t.album]&&(1<t.alt.length||t.alt.length<7)){if("string"!=typeof e){if(config.navigator&&this.firstChild.hasAttribute("class"))return;if(!config.navigator&&""!==this.firstChild.className)return}null!==TheDialogue.dialogue||6!==t.alt.length&&4!==t.alt.length?(null!==TheDialogue.dialogue||5!==t.alt.length&&3!==t.alt.length?TheSlideshow.updatePresentation(t):t.number=TheSlideshow.presentation[t.album],TheSlideshow.showDialogue(t)):TheSlideshow.updatePresentation(t)}else 5===t.alt.length||3===t.alt.length?TheSlideshow.showDialogue(t):config.debug&&TheDialogue.dialogInformation(i18n.translate("debugInvalidUse"),"TheSlideshow » showMedia[br]"+i18n.translate("debugNotRecognizedAltAttribute"))},this.updatePresentation=function(e){var t=null,i=null,o=0;if(6===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length&&0<e.alt[3].length&&0<e.alt[4].length){for(t=config.slideshow.ids+"."+e.album,document.getElementById(t+".999").setAttribute("href",document.getElementById(e.id).getAttribute("href")),document.getElementById(t+".999").firstChild.setAttribute("src",e.alt.shift()),document.getElementById(t+".999").firstChild.setAttribute("alt",e.alt.join("|")),i=document.getElementById(t).getElementsByTagName("img"),o=0;o<i.length;o++)config.navigator&&i[o].hasAttribute("class")&&"actif"===i[o].getAttribute("class")?i[o].removeAttribute("class"):"actif"===i[o].className&&(i[o].className="");document.getElementById(e.id).firstChild.setAttribute("class","actif"),this.presentation[e.album]=e.number}else if(config.debug&&6===e.alt.length)TheDialogue.dialogInformation(i18n.translate("debugInvalidAltAttribute"),"TheSlideshow » changePhoto[br]➩ (string) url : "+e.alt[0]+"[br]➩ (number) width : "+e.alt[1]+"[br]➩ (number) height : "+e.alt[2]+"[br]➩ (string) date : "+e.alt[3]+"[br]➩ (string) legend : "+e.alt[4]);else if(4===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length){for(t=config.slideshow.ids+"."+e.album,document.getElementById(t+".999").setAttribute("href",document.getElementById(e.id).getAttribute("href")),document.getElementById(t+".999").firstChild.setAttribute("src",e.alt.shift()),document.getElementById(t+".999").firstChild.setAttribute("alt",e.alt.join("|")),i=document.getElementById(t).getElementsByTagName("img"),o=0;o<i.length;o++)config.navigator&&i[o].hasAttribute("class")&&"actif"===i[o].getAttribute("class")?i[o].removeAttribute("class"):"actif"===i[o].className&&(i[o].className="");document.getElementById(e.id).firstChild.setAttribute("class","actif"),this.presentation[e.album]=e.number}else config.debug&&4===e.alt.length&&TheDialogue.dialogInformation(i18n.translate("debugInvalidAltAttribute"),"TheSlideshow » changePhoto[br]➩ (string) url : "+e.alt[0]+"[br]➩ (string) date : "+e.alt[1]+"[br]➩ (string) legend : "+e.alt[2])},this.showDialogue=function(e){5===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length&&0<e.alt[3].length?(e.name=e.alt[2],e.date=e.alt[3],e.legend=e.alt[4],e.width=parseInt(e.alt[0],10),e.height=parseInt(e.alt[1],10),null!==TheDialogue.dialogue&&TheDialogue.actionClose(!1),TheDialogue.dialogPhoto(e.width,e.height,e.url,e.name,e.date,e.legend),this.showNavigation(e.album,e.number),(config.navigator&&config.slideshow.hiddenPage&&"photo"===TheDialogue.dialogue&&!document.getElementById("dialogue").hasAttribute("class")||config.slideshow.hiddenPage&&"photo"===TheDialogue.dialogue&&"norgba"!==document.getElementById("dialogue").className)&&document.getElementById("dialogue").setAttribute("class","norgba")):config.debug&&5===e.alt.length?TheDialogue.dialogInformation(i18n.translate("debugInvalidAltAttribute"),"TheSlideshow » showMedia[br]➩ (number) width : "+e.alt[0]+"[br]➩ (number) height : "+e.alt[1]+"[br]➩ (string) date : "+e.alt[2]+"[br]➩ (string) legend : "+e.alt[3]):3===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length?(e.name=e.alt[0],e.date=e.alt[1],e.legend=e.alt[2],null!==TheDialogue.dialogue&&TheDialogue.actionClose(!1),TheDialogue.dialogVideo(e.url,e.name,e.date,e.legend),this.showNavigation(e.album,e.number),(config.navigator&&config.slideshow.hiddenPage&&"video"===TheDialogue.dialogue&&!document.getElementById("dialogue").hasAttribute("class")||config.slideshow.hiddenPage&&"video"===TheDialogue.dialogue&&"norgba"!==document.getElementById("dialogue").className)&&document.getElementById("dialogue").setAttribute("class","norgba")):config.debug&&3===e.alt.length&&TheDialogue.dialogInformation(i18n.translate("debugInvalidAltAttribute"),"TheSlideshow » showMedia[br]➩ (string) date : "+e.alt[0]+"[br]➩ (string) legend : "+e.alt[1])},this.showNavigation=function(e,t){"photo"!==TheDialogue.dialogue&&"video"!==TheDialogue.dialogue||(this.media.album=e,this.media.number=t,this.media.first=config.slideshow.ids+"."+this.media.album+".0",this.media.prev=config.slideshow.ids+"."+this.media.album+"."+(this.media.number-1),this.media.next=config.slideshow.ids+"."+this.media.album+"."+(this.media.number+1),this.media.last=config.slideshow.ids+"."+this.media.album+"."+this.totals[this.media.album],document.getElementById(this.media.prev)?document.getElementById("prev").removeAttribute("disabled"):this.media.prev=null,document.getElementById(this.media.next)?document.getElementById("next").removeAttribute("disabled"):this.media.next=null)},this.actionFirst=function(){null!==this.media&&0<this.media.number&&this.media.number<=this.totals[this.media.album]&&this.showMedia(this.media.first)},this.actionPrev=function(){null!==this.media&&null!==this.media.prev&&0<this.media.number&&this.showMedia(this.media.prev)},this.actionNext=function(){null!==this.media&&null!==this.media.next&&this.media.number<this.totals[this.media.album]&&this.showMedia(this.media.next)},this.actionLast=function(){null!==this.media&&0<=this.media.number&&this.media.number<this.totals[this.media.album]&&this.showMedia(this.media.last)}}function Map(){this.srvActuel=null,this.srvGeoportailPret=!1,this.srvGeoportailActif=!1,this.srvGooglePret=!1,this.srvGoogleActif=!1,this.width=config.map.width,this.height=config.map.height,this.modifiable=!1,this.multipoint=!1,this.coordonnees=!1,this.latitude=0,this.longitude=0,this.geocodeur=null,this.layerGeoportail=null,this.dragGeoportail=null,this.mapGeoportail=null,this.mapGoogle=null,this.markerGeoportail=null,this.markerGoogle=null,this.init=function(){document.getElementById("carteInteractive").style.display="block",document.getElementById("carteConfModifiable")&&(this.modifiable="true"===document.getElementById("carteConfModifiable").getAttribute("value")),document.getElementById("carteConfMultipoint")&&(this.multipoint="true"===document.getElementById("carteConfMultipoint").getAttribute("value")),document.getElementById("carteConfWidth")&&document.getElementById("carteConfHeight")&&(this.width=parseInt(document.getElementById("carteConfWidth").getAttribute("value"),10),this.height=parseInt(document.getElementById("carteConfHeight").getAttribute("value"),10),document.getElementById("carteInteractive").style.width=this.width+"px",document.getElementById("carteInteractive").style.height=this.height+"px"),0!==parseFloat(document.getElementById("carteLatitude").getAttribute("value"),10)?(this.latitude=parseFloat(document.getElementById("carteLatitude").getAttribute("value"),10),this.longitude=parseFloat(document.getElementById("carteLongitude").getAttribute("value"),10),this.coordonnees=!0):document.getElementById("carteConfLatitude")&&document.getElementById("carteConfLongitude")&&(this.latitude=parseFloat(document.getElementById("carteConfLatitude").getAttribute("value"),10),this.longitude=parseFloat(document.getElementById("carteConfLongitude").getAttribute("value"),10)),"function"==typeof geoportalLoadmap||"function"==typeof GMap2?("function"==typeof geoportalLoadmap&&(document.getElementById("mapControlGeoportail").addEventListener("click",function(e){TheMap.actionGeoportail(e)},!1),document.getElementById("mapControlGeoportail").removeAttribute("disabled"),this.srvGeoportailPret=!0),"function"==typeof GMap2&&GBrowserIsCompatible()&&(document.getElementById("mapControlGoogle").addEventListener("click",function(e){TheMap.actionGoogle(e)},!1),document.getElementById("mapControlGoogle").removeAttribute("disabled"),this.srvGooglePret=!0),document.getElementById("mapControlRefresh")&&document.getElementById("mapControlRefresh").addEventListener("click",function(e){TheMap.actionRefresh(e)},!1),document.getElementById("mapControlRecenter").addEventListener("click",function(e){TheMap.actionRecenter(e)},!1),document.getElementById("mapControlClose").addEventListener("click",function(e){TheMap.actionClose(e)},!1)):(document.getElementById("carteIntro").style.display="none",document.getElementById("carteFatal").style.display="block"),config.navigator?window.addEventListener("unload",function(){TheMap.destroy()},!1):window.onunload=TheMap.destroy},this.initGeoportail=function(){this.srvGeoportailActif?(this.srvGeoportailActif=!0,this.srvActuel="geoportail"):(this.srvGeoportailActif=!0,this.srvActuel="geoportail",geoportalLoadmap("mapGeoportail","normal","FXX"),this.mapGeoportail=map,this.mapGeoportail.setSize(this.width,this.height),this.mapGeoportail.getMap().getControlsByClass("OpenLayers.Control.KeyboardDefaults")[0].deactivate(),this.mapGeoportail.getMap().setCenterAtLonLat(config.map.initLatitude,config.map.initLongitude,config.map.zoomInitial),this.mapGeoportail.addGeoportalLayer("GEOGRAPHICALGRIDSYSTEMS.MAPS:WMSC",{opacity:1}),this.mapGeoportail.addGeoportalLayer("ORTHOIMAGERY.ORTHOPHOTOS:WMSC",{visibility:!1}),this.mapGeoportail.openLayersPanel(!1),this.mapGeoportail.openToolsPanel(!0),this.mapGeoportail.setInformationPanelVisibility(!1))},this.initGoogle=function(){this.srvGoogleActif?(this.srvGoogleActif=!0,this.srvActuel="google"):(this.srvGoogleActif=!0,this.srvActuel="google",this.mapGoogle=new GMap2(document.getElementById("mapGoogle"),{size:new GSize(this.width,this.height)}),this.mapGoogle.enableScrollWheelZoom(),this.mapGoogle.setCenter(new GLatLng(config.map.initLatitude,config.map.initLongitude),config.map.zoomInitial+1),this.mapGoogle.addControl(new GSmallMapControl),this.mapGoogle.addControl(new google.maps.MenuMapTypeControl))},this.destroy=function(){"function"==typeof GUnload&&GUnload(),this.showIntro(),document.getElementById("mapControlGeoportail").hasAttribute("disabled")||document.getElementById("mapControlGeoportail").setAttribute("disabled","disabled"),document.getElementById("mapControlGoogle").hasAttribute("disabled")||document.getElementById("mapControlGoogle").setAttribute("disabled","disabled"),this.srvActuel=null,this.srvGeoportailPret=!1,this.srvGeoportailActif=!1,this.srvGooglePret=!1,this.srvGoogleActif=!1,this.modifiable=!1,this.multipoint=!1,this.coordonnees=!1,this.latitude=0,this.longitude=0,this.geocodeur=null,this.layerGeoportail=null,this.dragGeoportail=null,this.mapGeoportail=null,this.mapGoogle=null,this.markerGeoportail=null,this.markerGoogle=null},this.actionClose=function(e){e.target.blur(),this.showIntro()},this.actionRecenter=function(e){e.target.blur(),this.centerMap()},this.actionRefresh=function(e){e.target.blur(),this.checkAddress()&&this.getCoordinates()},this.actionGeoportail=function(e){e.target.blur(),this.modifiable?this.checkAddress()&&(this.showGeoportail(),this.initGeoportail(),this.coordonnees&&!this.markerGeoportail?this.setMarker(!0):this.coordonnees?this.synchroMarker(!1):this.coordonnees||this.getCoordinates()):(this.showGeoportail(),this.initGeoportail(),this.coordonnees&&!this.markerGeoportail?this.setMarker(!0):this.coordonnees&&this.synchroMarker(!1))},this.actionGoogle=function(e){e.target.blur(),this.modifiable?this.checkAddress()&&(this.showGoogle(),this.initGoogle(),this.coordonnees&&!this.markerGoogle?this.setMarker(!0):this.coordonnees?this.synchroMarker(!1):this.coordonnees||this.getCoordinates()):(this.showGoogle(),this.initGoogle(),this.coordonnees&&!this.markerGoogle?this.setMarker(!0):this.coordonnees&&this.synchroMarker(!1))},this.showIntro=function(){this.srvGeoportailPret&&document.getElementById("mapControlGeoportail").hasAttribute("class")&&document.getElementById("mapControlGeoportail").removeAttribute("class"),this.srvGeoportailPret&&document.getElementById("mapControlGeoportail").hasAttribute("disabled")&&document.getElementById("mapControlGeoportail").removeAttribute("disabled"),this.srvGooglePret&&document.getElementById("mapControlGoogle").hasAttribute("class")&&document.getElementById("mapControlGoogle").removeAttribute("class"),this.srvGooglePret&&document.getElementById("mapControlGoogle").hasAttribute("disabled")&&document.getElementById("mapControlGoogle").removeAttribute("disabled"),document.getElementById("mapControlRefresh")&&!document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").setAttribute("disabled","disabled"),document.getElementById("mapControlRecenter").hasAttribute("disabled")||document.getElementById("mapControlRecenter").setAttribute("disabled","disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")||document.getElementById("mapControlClose").setAttribute("disabled","disabled"),document.getElementById("mapGeoportail").style.display="none",document.getElementById("mapGoogle").style.display="none",document.getElementById("carteIntro").style.display="block",document.getElementById("carteFatal").style.display="none"},this.showGeoportail=function(){document.getElementById("mapControlGeoportail").setAttribute("class","actif"),document.getElementById("mapControlGeoportail").setAttribute("disabled","disabled"),document.getElementById("mapControlGoogle").hasAttribute("class")&&(document.getElementById("mapControlGoogle").removeAttribute("class"),document.getElementById("mapControlGoogle").removeAttribute("disabled")),this.coordonnees&&document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),this.modifiable&&document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").removeAttribute("disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")&&document.getElementById("mapControlClose").removeAttribute("disabled"),document.getElementById("mapGeoportail").style.display="block",document.getElementById("mapGoogle").style.display="none",document.getElementById("carteIntro").style.display="none"},this.showGoogle=function(){document.getElementById("mapControlGoogle").setAttribute("class","actif"),document.getElementById("mapControlGoogle").setAttribute("disabled","disabled"),document.getElementById("mapControlGeoportail").hasAttribute("class")&&(document.getElementById("mapControlGeoportail").removeAttribute("class"),document.getElementById("mapControlGeoportail").removeAttribute("disabled")),this.coordonnees&&document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),this.modifiable&&document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").removeAttribute("disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")&&document.getElementById("mapControlClose").removeAttribute("disabled"),document.getElementById("mapGeoportail").style.display="none",document.getElementById("mapGoogle").style.display="block",document.getElementById("carteIntro").style.display="none"},this.checkAddress=function(){return!0},this.getCoordinates=function(){this.srvGooglePret?(this.geocodeur||(this.geocodeur=new GClientGeocoder,this.geocodeur.setBaseCountryCode("fr")),this.geocodeur.getLatLng(document.getElementById("txt_voie").value+" "+document.getElementById("txt_code_postal").value+" "+document.getElementById("txt_ville").value+" France",function(e){e?(TheMap.coordonnees=!0,TheMap.latitude=e.lat(),TheMap.longitude=e.lng(),"geoportail"===TheMap.srvActuel&&!TheMap.markerGeoportail||"google"===TheMap.srvActuel&&!TheMap.markerGoogle?TheMap.setMarker(!0):TheMap.synchroMarker(!0)):(("geoportail"===TheMap.srvActuel&&!TheMap.markerGeoportail||"google"===TheMap.srvActuel&&!TheMap.markerGoogle)&&TheMap.setMarkerClick(),TheDialogue.creerDialogueInformation("Attention","Adresse introuvable.","attention"))})):this.setMarkerClick()},this.setMarkerClick=function(){"geoportail"===this.srvActuel?this.mapGeoportail.getMap().events.register("click",TheMap.mapGeoportail,function(e){TheMap.markerGeoportail||((e=TheMap.mapGeoportail.getMap().getLonLatFromViewPortPx(e.xy)).transform(TheMap.mapGeoportail.getMap().getProjection(),OpenLayers.Projection.CRS84),TheMap.coordonnees=!0,TheMap.latitude=e.lat,TheMap.longitude=e.lon,TheMap.setMarker(!0))}):"google"===this.srvActuel&&GEvent.addListener(this.mapGoogle,"click",function(e,t){TheMap.markerGoogle||(TheMap.coordonnees=!0,TheMap.latitude=t.lat(),TheMap.longitude=t.lng(),TheMap.setMarker(!0))})},this.setMarker=function(e){var t;"geoportail"===this.srvActuel?((t=new OpenLayers.Geometry.Point(this.longitude,this.latitude)).transform(OpenLayers.Projection.CRS84,this.mapGeoportail.getMap().getProjection()),this.markerGeoportail=new OpenLayers.Feature.Vector(t,null,{externalGraphic:config.map.imageMarker,graphicWidth:26,graphicHeight:32,graphicXOffset:-12,graphicYOffset:-32}),this.layerGeoportail||(this.layerGeoportail=new OpenLayers.Layer.Vector("Marqueur")),this.layerGeoportail.addFeatures([this.markerGeoportail]),this.mapGeoportail.getMap().addLayer(this.layerGeoportail),!this.dragGeoportail&&this.modifiable&&(this.dragGeoportail=new OpenLayers.Control.DragFeature(this.layerGeoportail),this.mapGeoportail.getMap().addControl(this.dragGeoportail),this.dragGeoportail.activate(),this.dragGeoportail.onComplete=function(e,t){t=TheMap.mapGeoportail.getMap().getLonLatFromViewPortPx(t);t.transform(TheMap.mapGeoportail.getMap().getProjection(),OpenLayers.Projection.CRS84),TheMap.latitude=t.lat,TheMap.longitude=t.lon,TheMap.centerMap(),document.getElementById("carteLatitude").setAttribute("value",TheMap.latitude),document.getElementById("carteLongitude").setAttribute("value",TheMap.longitude)})):"google"===this.srvActuel&&((t=new GIcon).image=config.map.imageMarker,t.iconSize=new GSize(26,32),t.iconAnchor=new GPoint(12,32),this.markerGoogle=new GMarker(new GLatLng(this.latitude,this.longitude),{icon:t,draggable:this.modifiable,clickable:!1}),this.mapGoogle.addOverlay(this.markerGoogle),this.modifiable&&GEvent.addListener(this.markerGoogle,"dragend",function(){var e=TheMap.markerGoogle.getPoint();TheMap.latitude=e.lat(),TheMap.longitude=e.lng(),TheMap.mapGoogle.panTo(e),document.getElementById("carteLatitude").setAttribute("value",TheMap.latitude),document.getElementById("carteLongitude").setAttribute("value",TheMap.longitude)})),e&&this.centerMap(config.map.zoomSynchro),document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),document.getElementById("carteLatitude").setAttribute("value",this.latitude),document.getElementById("carteLongitude").setAttribute("value",this.longitude)},this.synchroMarker=function(e){"geoportail"===this.srvActuel?(this.modifiable&&this.markerGeoportail&&(this.layerGeoportail.removeFeatures([this.markerGeoportail]),this.setMarker(!1)),this.markerGeoportail||this.setMarker(!0),e&&this.centerMap()):"google"===this.srvActuel&&(this.modifiable&&this.markerGoogle&&this.markerGoogle.setLatLng(new GLatLng(this.latitude,this.longitude)),this.markerGoogle||this.setMarker(!0),e&&this.centerMap())},this.centerMap=function(e){this.coordonnees&&"geoportail"===this.srvActuel?"number"==typeof e?this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude,e):this.mapGeoportail.getMap().getZoom()<config.map.zoomCenter?this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude,config.map.zoomCenter):this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude):this.coordonnees&&"google"===this.srvActuel&&("number"==typeof e?this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude),e+1):this.mapGoogle.getZoom()<config.map.zoomCenter?this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude),config.map.zoomCenter+1):this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude)))}}navigator.userAgent.match(/MSIE/)?(config.navigator=!1,window.innerWidth=document.documentElement.clientWidth,window.innerHeight=document.documentElement.clientHeight,window.onload=start):window.addEventListener("load",start,!1);