/*!
 * Copyright 2008-2011 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/apijs - 2.4.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
var apijs={i18n:null,dialogue:null,slideshow:null,upload:null,map:null,config:{lang:"fr",debug:!0,debugkey:!1,navigator:!0,transition:!0,autolang:!0,dialogue:{blocks:[],hiddenPage:!1,savingDialog:!1,savingTime:2250,autoPlay:!0,showLoader:!0,showFullsize:!0,savePhoto:!0,saveVideo:!0,videoWidth:640,videoHeight:480,imagePrev:null,imageNext:null,imageClose:{src:"./images/dialogue/close.png",width:60,height:22},imageUpload:{src:"./images/dialogue/progressbar.svg.php",width:300,height:17},filePhoto:"./downloadfile.php",fileVideo:"./downloadfile.php",fileUpload:"./uploadfile.php"},slideshow:{ids:"diaporama",hiddenPage:!1,hoverload:!1},map:{width:580,height:400,initLatitude:1.9,initLongitude:46.3,imageMarker:"./images/map/marker.png",zoomInitial:5,zoomCenter:14,zoomSynchro:15}}};function start(){if(apijs.config.navigator)for(var e=document.getElementsByClassName("popup"),t=0;t<e.length;t++)e[t].addEventListener("click",openTab,!1);else for(e=document.getElementsByTagName("a"),t=0;t<document.getElementsByTagName("a").length;t++)e[t].hasAttribute("class")&&-1<e[t].getAttribute("class").indexOf("popup")&&e[t].setAttribute("onclick","window.open(this.href); return false;");"string"!=typeof document.getElementsByTagName("body")[0].style.transitionDuration&&"string"!=typeof document.getElementsByTagName("body")[0].style.MozTransitionDuration&&"string"!=typeof document.getElementsByTagName("body")[0].style.webkitTransitionDuration&&(apijs.config.transition=!1),"function"==typeof Internationalization&&(apijs.i18n=new Internationalization,apijs.i18n.init(),"function"==typeof Dialogue&&"function"==typeof BBcode&&(apijs.dialogue=new Dialogue,"function"==typeof Slideshow&&(apijs.slideshow=new Slideshow,apijs.slideshow.init()),"function"==typeof Upload&&(apijs.upload=new Upload)),"function"==typeof Map&&document.getElementById("carteInteractive")&&(apijs.map=new Map,apijs.map.init())),apijs.config.navigator&&"function"==typeof customInit?customInit():apijs.config.navigator||"function"!=typeof customInitIE||customInitIE()}function openTab(e){e.preventDefault(),window.open(this.href)}function myFuncA(){apijs.i18n.data.en.myFuncA="[pre]Yes, it's myFuncA() in main.js.[/pre]",apijs.i18n.data.fr.myFuncA="[pre]Oui, c'est myFuncA() dans main.js.[/pre]",apijs.dialogue.dialogInformation("myFuncA",apijs.i18n.translate("myFuncA"))}function myFuncB(e){apijs.i18n.data.en.myFuncB="[pre]Yes, it's myFuncB(§) in main.js.[/pre]",apijs.i18n.data.fr.myFuncB="[pre]Oui, c'est myFuncB(§) dans main.js.[/pre]",apijs.dialogue.dialogInformation("myFuncB",apijs.i18n.translate("myFuncB",e))}function myFuncC(){return apijs.i18n.data.en.myFuncC="Yes, it's myFuncC() in main.js, a very important function.\n\nWhat to do next ?\n» Click confirm to return true.\n» Click cancel to return false.",apijs.i18n.data.fr.myFuncC="Oui, c'est myFuncC() dans main.js, une fonction très importante.\n\nQue faire ensuite ?\n» Cliquer sur valider pour renvoyer true\n» Cliquer sur annuler pour renvoyer false",confirm(apijs.i18n.translate("myFuncC"))}function myFuncD(e,t){apijs.i18n.data.en.myFuncD="Image that you sent",apijs.i18n.data.fr.myFuncD="L'image que vous avez envoyée",apijs.config.dialogue.savePhoto=!1,apijs.dialogue.dialogPhoto(400,300,apijs.config.dialogue.fileUpload+"?image="+e,"myFuncD("+t+")","false",apijs.i18n.translate("myFuncD")),apijs.config.dialogue.savePhoto=!0}function myFuncE(e){apijs.i18n.data.en.myFuncA="[pre]Yes, it's myFuncE(§) in main.js.[/pre]",apijs.i18n.data.fr.myFuncA="[pre]Oui, c'est myFuncE(§) dans main.js.[/pre]",apijs.dialogue.dialogInformation("myFuncE",apijs.i18n.translate("myFuncE",e))}function getValue(e){return"true"===e||"false"!==e&&("null"===e?null:/[0-9]+/.test(e)?parseInt(e,10):"specialPrev"===e?{src:"./images/icons/24/gnome-prev.png",width:24,height:24}:"specialNext"===e?{src:"./images/icons/24/gnome-next.png",width:24,height:24}:"specialClose"===e?{src:"./images/dialogue/close.png",width:60,height:22}:e)}function checkAll(){var e=0,t=0,i=[],a=null,o=null,n=null,s=null,a={lang:"string",debug:"boolean",debugkey:"boolean",navigator:"boolean",transition:"boolean",autolang:"boolean",dialogue:{blocks:"object",hiddenPage:"boolean",savingDialog:"boolean",savingTime:"number",autoPlay:"boolean",showLoader:"boolean",showFullsize:"boolean",savePhoto:"boolean",saveVideo:"boolean",videoWidth:"number",videoHeight:"number",imagePrev:{src:"string",width:"number",height:"number"},imageNext:{src:"string",width:"number",height:"number"},imageClose:{src:"string",width:"number",height:"number"},imageUpload:{src:"string",width:"number",height:"number"},filePhoto:"string",fileVideo:"string",fileUpload:"string"},slideshow:{ids:"string",hiddenPage:"boolean",hoverload:"boolean"}};for(o in i.push("Checking modules"),"function"==typeof BBcode&&(i.push(" ➩ BBcode is here"),e++),"function"==typeof Internationalization&&apijs.i18n instanceof Internationalization?(i.push(" ➩ Internationalization is here and loaded"),e++):"function"==typeof Internationalization&&(i.push(" ➩ Internationalization is here"),e++),"function"==typeof Dialogue&&apijs.dialogue instanceof Dialogue?(i.push(" ➩ TheDialogue is here and loaded"),e++):"function"==typeof Dialogue&&(i.push(" ➩ TheDialogue is here"),e++),"function"==typeof Slideshow&&apijs.slideshow instanceof Slideshow?(i.push(" ➩ TheSlideshow is here and loaded"),e++):"function"==typeof Slideshow&&(i.push(" ➩ TheSlideshow is here"),e++),"function"==typeof Upload&&apijs.upload instanceof Upload?(i.push(" ➩ TheUpload is here and loaded"),e++):"function"==typeof Upload&&(i.push(" ➩ TheUpload is here"),e++),"function"==typeof Map&&apijs.map instanceof Map?(i.push(" ➩ TheMap is here and loaded"),e++):"function"==typeof Map&&(i.push(" ➩ TheMap is here"),e++),e<1&&i.push(" ➩ no module present"),i.push("\nChecking configuration"),a)if(a.hasOwnProperty(o)){if(!("dialogue"!==o||"function"==typeof Dialogue&&apijs.dialogue instanceof Dialogue))continue;if(!("slideshow"!==o||"function"==typeof Slideshow&&apijs.slideshow instanceof Slideshow))continue;if(!("upload"!==o||"function"==typeof Upload&&apijs.upload instanceof Upload))continue;if(!("map"!==o||"function"==typeof Map&&apijs.map instanceof Map))continue;if("object"==typeof a[o]){for(n in a[o])if(a[o].hasOwnProperty(n))if("object"==typeof a[o][n]){for(s in a[o][n])if(a[o][n].hasOwnProperty(s)){if(null===apijs.config[o][n]){i.push(" ⚠ apijs.config."+o+"."+n+" is null");break}void 0===apijs.config[o][n][s]?(i.push(" ☠ apijs.config."+o+"."+n+"."+s+" is missing"),t++):null===apijs.config[o][n][s]?i.push(" ⚠ apijs.config."+o+"."+n+"."+s+" is null"):typeof apijs.config[o][n][s]!==a[o][n][s]&&(i.push(" ☠ apijs.config."+o+"."+n+"."+s+" isn't a "+a[o][n][s]),t++)}}else void 0===apijs.config[o][n]?(i.push(" ☠ apijs.config."+o+"."+n+" is missing"),t++):null===apijs.config[o][n]?i.push(" ⚠ apijs.config."+o+"."+n+" is null"):typeof apijs.config[o][n]!==a[o][n]&&(i.push(" ☠ apijs.config."+o+"."+n+" isn't a "+a[o][n]),t++)}else void 0===apijs.config[o]?(i.push(" ☠ apijs.config."+o+" is missing"),t++):null===apijs.config[o]?i.push(" ⚠ apijs.config."+o+" is null"):typeof apijs.config[o]!==a[o]&&(i.push(" ☠ apijs.config."+o+" isn't a "+a[o]),t++)}t<1&&i.push(" ➩ no error found"),alert(i.join("\n"))}function Internationalization(){this.data=[],this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",downloadLink:"Download",operationTooLong:"This operation is too long ? ",warningLostChange:"Warning : all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",savingInProgress:"Saving...",uploadRate:"§% (§ kB/s)",uploadAllType:"All files are accepted.[br]Maximum size : § [abbr title='Megabyte']MB[/abbr].",uploadOneType:"Accepted file format : §.[br]Maximum size : § [abbr title='Megabyte']MB[/abbr].",uploadMultiType:"Accepted file formats : § and §.[br]Maximum size : § [abbr title='Megabyte']MB[/abbr].",uploadBadOneType:"[p]It is impossible to send the file because the file format proposed isn't allowed.[/p][p]➩ Proposed file : [strong]§[/strong][br]➩ Accepted file format : §.[/p]",uploadBadMultiType:"[p]It is impossible to send the file because the file format proposed isn't allowed.[/p][p]➩ Proposed file : [strong]§[/strong][br]➩ Accepted file formats : § and §.[/p]",deleteNotFound:"Unfortunately, it is currently impossible to delete requested file (Error § : §).",browserNoVideo:"[p]Your browser doesn't support the <video> tag.[br]Remember to upgrade your browser.[/p][ul][li][a href='http://www.google.com/chrome?hl=en' class='popup']Chrome 3.0+[/a][/li][li][a href='http://www.mozilla-europe.org/en/firefox/' class='popup']Firefox 3.5+[/a][/li][li][a href='http://windows.microsoft.com/en-US/internet-explorer/products/ie/home' class='popup']Internet Explorer 9.0+[/a][/li][li][a href='http://www.konqueror.org/' class='popup']Konqueror 4.4+[/a][/li][li][a href='http://www.opera.com/' class='popup']Opera 10.50+[/a][/li][li][a href='http://www.apple.com/safari/' class='popup']Safari 3.1+[/a][/li][/ul]",debugInvalidCall:"(debug) Invalid call",debugInvalidUse:"(debug) Invalid use",debugUnknownAction:"(debug) Unknown action",debugKeyDetected:"(debug) Key detected",debugKeyCode:"Code of the seizure key : §",debugInvalidAltAttribute:"(debug) Invalid alt attribute",debugNotRecognizedAltAttribute:"The alt attribute of the image wasn't recognized",debugNotExist:"doesn't exist (unlikely error)"},this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",downloadLink:"Télécharger",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",savingInProgress:"Enregistrement en cours...",uploadRate:"§% (§ ko/s)",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadBadOneType:"[p]Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé.[/p][p]➩ Fichier proposé : [strong]§[/strong][br]➩ Format de fichier accepté : §.[/p]",uploadBadMultiType:"[p]Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé.[/p][p]➩ Fichier proposé : [strong]§[/strong][br]➩ Formats de fichier acceptés : § et §.[/p]",deleteNotFound:"Malheureusement, il est actuellement impossible de supprimer le fichier demandé (Erreur § : [span xml:lang='en']§[/span]).",browserNoVideo:"[p]Votre navigateur ne supporte pas la balise <video>.[br]Pensez à mettre à jour votre navigateur.[/p][ul][li][a href='http://www.google.com/chrome?hl=fr' class='popup']Chrome 3.0+[/a][/li][li][a href='http://www.mozilla-europe.org/fr/firefox/' class='popup']Firefox 3.5+[/a][/li][li][a href='http://windows.microsoft.com/fr-FR/internet-explorer/products/ie/home' class='popup']Internet Explorer 9.0+[/a][/li][li][a href='http://www.konqueror.org/' class='popup']Konqueror 4.4+[/a][/li][li][a href='http://www.opera.com/' class='popup']Opera 10.50+[/a][/li][li][a href='http://www.apple.com/fr/safari/' class='popup']Safari 3.1+[/a][/li][/ul]",debugInvalidCall:"(debug) Appel invalide",debugInvalidUse:"(debug) Utilisation invalide",debugUnknownAction:"(debug) Action inconnue",debugKeyDetected:"(debug) Touche détectée",debugKeyCode:"Code de la touche saisie : §",debugInvalidAltAttribute:"(debug) Attribut alt invalide",debugNotRecognizedAltAttribute:"L'attribut alt de l'image n'a pas été reconnu",debugNotExist:"n'existe pas (erreur improbable)"},this.init=function(){var e;apijs.config.autolang?(e=null,document.getElementsByTagName("html")[0].getAttribute("xml:lang")?e=document.getElementsByTagName("html")[0].getAttribute("xml:lang").slice(0,2):document.getElementsByTagName("html")[0].getAttribute("lang")&&(e=document.getElementsByTagName("html")[0].getAttribute("lang").slice(0,2)),"string"==typeof e&&this.data.hasOwnProperty(e)?apijs.config.lang=e:"string"==typeof apijs.config.lang&&this.data.hasOwnProperty(apijs.config.lang)||(apijs.config.lang="en")):"string"==typeof apijs.config.lang&&this.data.hasOwnProperty(apijs.config.lang)||(apijs.config.lang="en")},this.translate=function(e){if("string"!=typeof this.data[apijs.config.lang][e])return e;if(1<arguments.length){for(var t=0,i=1,a="",o=this.data[apijs.config.lang][e].split("§");t<o.length;t++)a+=i<arguments.length?o[t]+arguments[i++]:o[t];return a}return this.data[apijs.config.lang][e]},this.changeLang=function(e){return!("string"!=typeof e||!this.data.hasOwnProperty(e))&&(apijs.config.lang=e,!0)}}function BBcode(){this.bbcode=null,this.object=null,this.smileys=!1,this.fragment=null,this.init=function(e,t){this.object={tag:"div",content:[]},this.object.class="bbcode",this.bbcode="["!==e[0]?"[p]"+e+"[/p]":e},this.exec=function(){this.readData(this.bbcode,0),this.fragment=document.createDocumentFragment(),this.fragment.appendChild(this.createDomFragment(this.object))},this.get=function(){return this.fragment},this.readData=function(e,t){var i,a,o=null,n=null,s=null,l=0;"["!==e[0]&&-1<(l=e.search(/\[([a-z1-6]+)(?: [a-z:]+=["'][^"']*["'])*\]/))?(a=e.slice(0,l),this.readData(a,t),-1<(l=(s=e.slice(l)).indexOf("[/"+RegExp.$1+"]"))&&(o=s.slice(0,l+RegExp.$1.length+3),s=s.slice(l+RegExp.$1.length+3),this.readData(o,t)),/^(\[(?:area|br|col|hr|iframe|img|input|param)(?: [a-z:]+=["'][^"']*["'])*\])/.test(s)&&(o=s.slice(0,RegExp.$1.length),s=s.slice(RegExp.$1.length),this.readData(o,t)),0<s.length&&this.readData(s,t)):/^\[(area|br|col|hr|iframe|img|input|param)((?: [a-z:]+=["'][^"']*["'])*)\]/.test(e)?(o=RegExp.$1,n=RegExp.$2,s=e.slice(2+o.length+n.length),this.addElement(o,n,t),0<s.length&&this.readData(s,t)):/^\[([a-z1-6]+)((?: [a-z:]+=["'][^"']*["'])*)\]/.test(e)?(o=RegExp.$1,n=RegExp.$2,l=e.indexOf("[/"+o+"]"),i=e.slice(2+o.length+n.length,l),s=e.slice(3+o.length+l),this.addElement(o,n,t),this.readData(i,t+1),0<s.length&&this.readData(s,t)):this.addElement(e,null,t)},this.addElement=function(e,t,i){var a,o,n=null,s=null,n=this.getContentNode(this.object,0,i);if(null!==t){if(n.hasOwnProperty("content")?n.content.push({tag:e}):n.content=[{tag:e}],5<t.length)for(s in t=t.slice(1,-1).split(/["'] /))t.hasOwnProperty(s)&&(a=t[s].slice(0,t[s].indexOf("=")),o=t[s].slice(t[s].indexOf("=")+2),n.hasOwnProperty("content")?n.content[n.content.length-1][a]=o:n[a]=o)}else n.hasOwnProperty("content")?n.content.push({text:e}):n.content=[{text:e}]},this.getContentNode=function(e,t,i){if(e.content.length<1||i<1)return e;var a=e.content.length-1;return 0<=a?e.content[a].hasOwnProperty("content")&&++t<i?this.getContentNode(e.content[a],t,i):e.content[a]:void 0},this.createDomFragment=function(e){var t=null,i=null,a=0;if(!e.hasOwnProperty("tag"))return document.createTextNode(e.text);for(i in t=document.createElement(e.tag),e)e.hasOwnProperty(i)&&("text"===i&&t.appendChild(document.createTextNode(e[i])),"tag"!==i&&"text"!==i&&"content"!==i&&t.setAttribute(i,e[i]),"a"===e.tag&&"class"===i&&-1<e[i].indexOf("popup")&&"function"==typeof openTab&&(apijs.config.navigator?t.addEventListener("click",openTab,!1):t.setAttribute("onclick","window.open(this.href); return false;")));if(e.hasOwnProperty("content"))for(a=0;a<e.content.length;a++)t.appendChild(this.createDomFragment(e.content[a]));return t}}function Dialogue(){this.offset=0,this.hiddenPage=!1,this.dialogType=null,this.image=null,this.timer=null,this.timerbis=null,this.callback=null,this.params=null,this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.dialogInformation=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.setupDialogue("information",i),this.htmlParent(!1),this.htmlTitle(e),this.htmlText(t),this.htmlButtonOk(),this.showDialogue(),document.getElementById("box").lastChild.firstChild.focus()):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogInformation[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (string) icon : "+i+"[/pre]")},this.dialogConfirmation=function(e,t,i,a,o){"string"==typeof e&&"string"==typeof t&&"function"==typeof i&&void 0!==a?(this.setupDialogue("confirmation",o),this.htmlParent(!1),this.htmlTitle(e),this.htmlText(t),this.htmlButtonConfirm("button"),this.callback=i,this.params=a,this.showDialogue(),document.getElementById("box").lastChild.firstChild.focus()):apijs.config.debug&&("function"==typeof i&&"string"==typeof i.name&&0<i.name.length&&(i=i.name),this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogConfirmation[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (function) callback : "+i+"[br]➩ (object) params : "+a+"[br]➩ (string) icon : "+o+"[/pre]"))},this.dialogFormOptions=function(e,t,i,a,o,n){"string"==typeof e&&"string"==typeof t&&"function"==typeof i&&void 0!==a&&"string"==typeof o?(this.setupDialogue("options",n),this.htmlFormParent(o),this.htmlTitle(e),this.htmlText(t),this.htmlButtonConfirm("submit"),this.callback=i,this.params=a,this.showDialogue()):apijs.config.debug&&("function"==typeof i&&"string"==typeof i.name&&0<i.name.length&&(i=i.name),this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogFormOptions[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (function) callback : "+i+"[br]➩ (object) params : "+a+"[br]➩ (string) action : "+o+"[br]➩ (string) icon : "+n+"[/pre]"))},this.dialogFormUpload=function(e,t,i,a,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof a&&"string"==typeof i?(this.setupDialogue("upload",o),this.htmlFormParent(apijs.config.dialogue.fileUpload,"multipart/form-data","iframeUpload."+a),this.htmlTitle(e),this.htmlText(t),this.htmlFormUpload(i,a),this.htmlButtonConfirm("submit"),this.showDialogue(),window.setTimeout(function(){document.getElementById("box").getElementsByTagName("input")[1].focus()},0)):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogFormUpload[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (string) data : "+i+"[br]➩ (string) key : "+a+"[br]➩ (string) icon : "+o+"[/pre]")},this.dialogProgress=function(e,t){"string"==typeof e&&"string"==typeof t?(this.setupDialogue("progress"),this.htmlParent(!1),this.htmlTitle(e),this.htmlText(t),this.htmlProgressBar(),this.showDialogue(),this.timer=window.setTimeout(apijs.dialogue.htmlLinkReload,3e4)):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogProgress[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[/pre]")},this.dialogWaiting=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.setupDialogue("waiting"),this.htmlParent(!1),this.htmlTitle(e),this.htmlText(t),this.showDialogue(),this.timer=window.setTimeout(apijs.dialogue.htmlLinkReload,"number"==typeof i?i:6e3)):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogWaiting[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (number) time : "+i+"[/pre]")},this.dialogPhoto=function(e,t,i,a,o,n,s){"number"==typeof e&&"number"==typeof t&&"string"==typeof i&&"string"==typeof a&&"string"==typeof o&&"string"==typeof n?("boolean"==typeof s&&!0===s?(this.setupDialogue("photo slideshow"),this.htmlParent(!0)):(this.setupDialogue("photo"),this.htmlParent(!1)),this.htmlPhoto(e,t,i,a,o,n),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialogue(),this.loadImage(e,t,i)):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogPhoto[br]➩ (number) width : "+e+"[br]➩ (number) height : "+t+"[br]➩ (string) url : "+i+"[br]➩ (string) name : "+a+"[br]➩ (string) date : "+o+"[br]➩ (string) legend : "+n+"[/pre]")},this.dialogVideo=function(e,t,i,a,o){"string"==typeof e&&"string"==typeof t&&"string"==typeof a&&"string"==typeof a?("boolean"==typeof o&&!0===o?(this.setupDialogue("video slideshow"),this.htmlParent(!0)):(this.setupDialogue("video"),this.htmlParent(!1)),this.htmlVideo(e,t,i,a),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialogue()):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheDialogue » dialogVideo[br]➩ (string) url : "+e+"[br]➩ (string) name : "+t+"[br]➩ (string) date : "+i+"[br]➩ (string) legend : "+a+"[/pre]")},this.actionClose=function(e){e?(apijs.dialogue.deleteDialogue(!0),apijs.dialogue.showPage()):apijs.dialogue.deleteDialogue(!1)},this.actionConfirm=function(){var e=!1;return-1<this.dialogType.indexOf("confirmation")?(this.dialogType+=" lock",apijs.config.dialogue.savingDialog?this.dialogWaiting(document.getElementById("box").firstChild.firstChild.nodeValue,apijs.i18n.translate("operationInProgress")):(this.elemA=document.createElement("p"),this.elemA.setAttribute("class","saving"),this.elemA.appendChild(document.createTextNode(apijs.i18n.translate("operationInProgress"))),document.getElementById("box").removeChild(document.getElementById("box").lastChild),document.getElementById("box").lastChild.setAttribute("class","novisible"),document.getElementById("box").appendChild(this.elemA),this.timer=window.setTimeout(apijs.dialogue.htmlLinkReload,6e3)),500<apijs.config.dialogue.savingTime?this.timerbis=window.setTimeout(function(){"function"==typeof apijs.dialogue.callback&&apijs.dialogue.callback(apijs.dialogue.params)},apijs.config.dialogue.savingTime):apijs.dialogue.callback(apijs.dialogue.params),e=!0):-1<this.dialogType.indexOf("options")?!0===apijs.dialogue.callback(apijs.dialogue.clone(apijs.dialogue.params))&&(this.dialogType+=" lock",this.elemA=document.createElement("p"),this.elemA.setAttribute("class","saving"),this.elemA.appendChild(document.createTextNode(apijs.i18n.translate("operationInProgress"))),document.getElementById("box").removeChild(document.getElementById("box").lastChild),document.getElementById("box").lastChild.setAttribute("class","novisible"),document.getElementById("box").appendChild(this.elemA),this.timer=window.setTimeout(apijs.dialogue.htmlLinkReload,6e3),500<apijs.config.dialogue.savingTime?this.timerbis=window.setTimeout(function(){document.getElementById("box")&&"form"===document.getElementById("box").nodeName.toLowerCase()&&document.getElementById("box").submit()},apijs.config.dialogue.savingTime):e=!0):-1<this.dialogType.indexOf("upload")&&("function"==typeof Upload&&apijs.upload instanceof Upload?!0===apijs.upload.actionConfirm()&&(this.dialogType+=" lock",e=!0):apijs.config.debug&&this.dialogInformation(apijs.i18n.translate("debugInvalidUse"),"[pre]TheDialogue » actionConfirm[br]➩ TheUpload "+apijs.i18n.translate("debugNotExist")+"[/pre]")),e},this.actionKey=function(e){apijs.config.debugkey?(e.preventDefault(),apijs.dialogue.dialogInformation(apijs.i18n.translate("debugKeyDetected"),"[pre]TheDialogue » actionKey[br]"+apijs.i18n.translate("debugKeyCode",e.keyCode)+"[/pre]")):27!==e.keyCode&&35!==e.keyCode&&36!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode||(27===e.keyCode?-1<apijs.dialogue.dialogType.indexOf("waiting")||-1<apijs.dialogue.dialogType.indexOf("progress")||-1<apijs.dialogue.dialogType.indexOf("lock")?e.preventDefault():(e.preventDefault(),apijs.dialogue.actionClose(!0)):-1<apijs.dialogue.dialogType.indexOf("slideshow")&&(35===e.keyCode?(e.preventDefault(),apijs.slideshow.actionLast()):36===e.keyCode?(e.preventDefault(),apijs.slideshow.actionFirst()):37===e.keyCode?(e.preventDefault(),apijs.slideshow.actionPrev()):39===e.keyCode&&(e.preventDefault(),apijs.slideshow.actionNext())))},this.setupDialogue=function(e,t){var i=!1,a=!1,o=null;if(null!==this.dialogType?(this.dialogType.indexOf("slideshow"),!this.hiddenPage&&apijs.config.dialogue.hiddenPage?i=!0:this.hiddenPage&&!apijs.config.dialogue.hiddenPage&&(a=!0)):-1<e.indexOf("slideshow")?!this.hiddenPage&&apijs.config.slideshow.hiddenPage&&(i=!0):!this.hiddenPage&&apijs.config.dialogue.hiddenPage&&(i=!0),null!==this.dialogType&&-1<this.dialogType.indexOf("slideshow")?(this.deleteDialogue(!1),document.getElementById("dialogue").setAttribute("class",document.getElementById("dialogue").getAttribute("class").replace(" slideshow",""))):null!==this.dialogType&&this.deleteDialogue(!1),i)for(o in(0<window.pageYOffset||0<this.offset)&&(this.offset=window.pageYOffset),apijs.config.dialogue.blocks)apijs.config.dialogue.blocks.hasOwnProperty(o)&&document.getElementById(apijs.config.dialogue.blocks[o]).setAttribute("class","nodisplay");else a&&this.showPage();apijs.config.navigator&&document.addEventListener("keydown",apijs.dialogue.actionKey,!1),this.dialogType="string"!=typeof t?e:e+" "+t,this.hiddenPage=!(!i&&!this.hiddenPage),this.fragment=document.createDocumentFragment()},this.showDialogue=function(){document.getElementById("dialogue")?(this.fragment.firstChild.setAttribute("class",this.fragment.firstChild.getAttribute("class").replace("init","actif")),document.getElementById("dialogue").appendChild(this.fragment.firstChild.firstChild)):apijs.config.transition?(document.getElementsByTagName("body")[0].appendChild(this.fragment),window.setTimeout(function(){document.getElementById("dialogue").setAttribute("class",document.getElementById("dialogue").getAttribute("class").replace("init","actif"))},1)):(this.fragment.firstChild.setAttribute("class",this.fragment.firstChild.getAttribute("class").replace("init","actif")),document.getElementsByTagName("body")[0].appendChild(this.fragment))},this.deleteDialogue=function(e){this.timer&&clearTimeout(this.timer),apijs.config.navigator&&document.removeEventListener("keydown",apijs.dialogue.actionKey,!1),apijs.config.navigator&&0<document.getElementById("dialogue").getElementsByTagName("video").length&&"function"==typeof document.getElementById("dialogue").getElementsByTagName("video")[0].pause&&document.getElementById("dialogue").getElementsByTagName("video")[0].pause(),apijs.config.transition&&e?(document.getElementById("dialogue").setAttribute("class",document.getElementById("dialogue").getAttribute("class").replace("actif","deleting lock")),"string"==typeof document.getElementById("dialogue").style.transitionDuration?document.getElementById("dialogue").addEventListener("transitionEnd",function(){document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue"))},!1):"string"==typeof document.getElementById("dialogue").style.OTransitionDuration?document.getElementById("dialogue").addEventListener("OTransitionEnd",function(){document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue"))},!1):"string"==typeof document.getElementById("dialogue").style.MozTransitionDuration?document.getElementById("dialogue").addEventListener("transitionend",function(){document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue"))},!1):"string"==typeof document.getElementById("dialogue").style.webkitTransitionDuration&&document.getElementById("dialogue").addEventListener("webkitTransitionEnd",function(){document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue"))},!1)):e?document.getElementById("dialogue").parentNode.removeChild(document.getElementById("dialogue")):document.getElementById("box").parentNode.removeChild(document.getElementById("box")),this.dialogType=null,this.image=null,this.timer=null,this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null},this.showPage=function(){if(document.getElementById("iframeUpload")&&document.getElementById("iframeUpload").parentNode.removeChild(document.getElementById("iframeUpload")),this.hiddenPage){for(var e in apijs.config.dialogue.blocks)apijs.config.dialogue.blocks.hasOwnProperty(e)&&document.getElementById(apijs.config.dialogue.blocks[e]).removeAttribute("class");window.scrollBy(0,this.offset)}this.offset=0,this.hiddenPage=!1,this.timerbis&&clearTimeout(this.timerbis),this.timerbis=null,this.callback=null,this.params=null},this.checkSize=function(e,t){return e>window.innerWidth-150||t>window.innerHeight-110},this.updateSize=function(e,t,i){var a=null,o=null,a={width:e,height:t,id:i.slice(i.lastIndexOf("/")+1,i.lastIndexOf(".")),mime:null},o={width:window.innerWidth,height:window.innerHeight},n={ogv:"video/ogg",webm:"video/webm",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml"};return a.mime=i.slice(i.lastIndexOf(".")+1),a.mime in n&&(a.mime=n[a.mime]),this.checkSize(e,t)&&(o.width-=150,o.height-=110,a.width>o.width?(a.height=Math.floor(a.height*(o.width/a.width)),a.width=o.width,a.height>o.height&&(a.width=Math.floor(a.width*(o.height/a.height)),a.height=o.height)):a.height>o.height&&(a.width=Math.floor(a.width*(o.height/a.height)),a.height=o.height,a.width>o.width&&(a.height=Math.floor(a.height*(o.width/a.width)),a.width=o.width))),this.fragment.firstChild.firstChild.style.width=a.width+"px",this.fragment.firstChild.firstChild.style.marginLeft=parseInt(-(a.width+20)/2,10)+"px",this.fragment.firstChild.firstChild.style.marginTop=parseInt(-(a.height+65)/2,10)+"px",a},this.loadImage=function(e,t,i){apijs.config.navigator&&apijs.config.dialogue.showLoader?(this.image=new Image(e,t),this.image.src=i,this.image.addEventListener("load",function(){document.getElementById("topho")&&(document.getElementById("topho").removeAttribute("class"),document.getElementById("topho").setAttribute("src",apijs.dialogue.image.src))},!1),this.image.addEventListener("error",function(){var e;document.getElementById("topho")&&(-1<document.getElementById("topho").getAttribute("class").indexOf("resized")&&(e=document.getElementById("topho").cloneNode(!0),document.getElementById("topho").parentNode.parentNode.removeChild(document.getElementById("topho").parentNode),document.getElementById("box").firstChild.firstChild.appendChild(e)),apijs.config.dialogue.savePhoto&&document.getElementById("box").firstChild.lastChild.removeChild(document.getElementById("box").firstChild.lastChild.lastChild),document.getElementById("topho").setAttribute("class","error_"+apijs.config.lang))},!1)):(document.getElementById("topho").removeAttribute("class"),document.getElementById("topho").setAttribute("src",i))},this.clone=function(e){if("object"!=typeof e||null===e)return e;var t=null,i=new e.constructor;for(t in e)i[t]=apijs.dialogue.clone(e[t]);return i},this.htmlParent=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class",e?"init slideshow":"init"),this.elemA.setAttribute("id","dialogue"),this.elemB=document.createElement("div"),this.elemB.setAttribute("class",this.dialogType),this.elemB.setAttribute("id","box"),this.elemA.appendChild(this.elemB),this.fragment.appendChild(this.elemA)},this.htmlFormParent=function(e,t,i){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","init"),this.elemA.setAttribute("id","dialogue"),this.elemB=document.createElement("form"),this.elemB.setAttribute("action",e),this.elemB.setAttribute("method","post"),"string"==typeof t&&this.elemB.setAttribute("enctype",t),"string"==typeof i&&this.elemB.setAttribute("target",i),this.elemB.setAttribute("onsubmit","return apijs.dialogue.actionConfirm();"),this.elemB.setAttribute("class",this.dialogType),this.elemB.setAttribute("id","box"),this.elemA.appendChild(this.elemB),this.fragment.appendChild(this.elemA)},this.htmlTitle=function(e){this.elemA=document.createElement("h1"),this.elemA.appendChild(document.createTextNode(e)),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlText=function(e){var t=new BBcode;t.init(e),t.exec(),this.fragment.firstChild.firstChild.appendChild(t.get())},this.htmlButtonOk=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialogue.actionClose(true);"),this.elemB.setAttribute("class","confirm"),this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonOk"))),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlButtonConfirm=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type",e),this.elemB.setAttribute("class","confirm"),"submit"!==e&&this.elemB.setAttribute("onclick","apijs.dialogue.actionConfirm();"),this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonConfirm"))),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","cancel"),this.elemB.setAttribute("onclick","apijs.dialogue.actionClose(true);"),this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonCancel"))),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlButtonNavigation=function(){var e=null===apijs.config.dialogue.imagePrev||null===apijs.config.dialogue.imageNext;this.elemA=document.createElement("div"),this.elemA.setAttribute("class","navigation "+(e?"txt":"img")),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionPrev();"),this.elemB.setAttribute("id","prev"),e?this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonPrev"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialogue.imagePrev.src),this.elemC.setAttribute("width",apijs.config.dialogue.imagePrev.width),this.elemC.setAttribute("height",apijs.config.dialogue.imagePrev.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonPrev")),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionNext();"),this.elemB.setAttribute("id","next"),e?this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonNext"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialogue.imageNext.src),this.elemC.setAttribute("width",apijs.config.dialogue.imageNext.width),this.elemC.setAttribute("height",apijs.config.dialogue.imageNext.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonNext")),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlButtonClose=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","close"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialogue.actionClose(true);"),this.elemB.setAttribute("class","close"),null!==apijs.config.dialogue.imageClose?(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialogue.imageClose.src),this.elemC.setAttribute("width",apijs.config.dialogue.imageClose.width),this.elemC.setAttribute("height",apijs.config.dialogue.imageClose.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonClose")),this.elemB.appendChild(this.elemC)):this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("buttonClose"))),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlLinkReload=function(){this.elemA=document.createElement("p"),this.elemA.setAttribute("class","reload"),this.elemA.appendChild(document.createTextNode(apijs.i18n.translate("operationTooLong"))),this.elemB=document.createElement("a"),this.elemB.setAttribute("href",location.href),this.elemB.appendChild(document.createTextNode(apijs.i18n.translate("reloadLink"))),this.elemA.appendChild(this.elemB),this.elemA.appendChild(document.createTextNode(".")),this.elemB=document.createElement("br"),this.elemA.appendChild(this.elemB),this.elemA.appendChild(document.createTextNode(apijs.i18n.translate("warningLostChange"))),document.getElementById("box").appendChild(this.elemA)},this.htmlFormUpload=function(e,t){this.elemA=document.createElement("iframe"),apijs.config.navigator&&this.elemA.setAttribute("src",apijs.config.dialogue.imageUpload.src),this.elemA.setAttribute("name","iframeUpload."+t),this.elemA.setAttribute("id","iframeUpload"),document.getElementsByTagName("body")[0].appendChild(this.elemA),this.elemA=document.createElement("div"),this.elemB=document.createElement("input"),this.elemB.setAttribute("type","hidden"),this.elemB.setAttribute("name","APC_UPLOAD_PROGRESS"),this.elemB.setAttribute("value",t),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("input"),this.elemB.setAttribute("type","file"),this.elemB.setAttribute("name",e),this.elemB.setAttribute("onchange","document.getElementById('box').lastChild.firstChild.focus();"),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlProgressBar=function(){apijs.config.navigator?(this.elemA=document.createElement("object"),this.elemA.setAttribute("data",apijs.config.dialogue.imageUpload.src),this.elemA.setAttribute("type","image/svg+xml"),this.elemA.setAttribute("width",apijs.config.dialogue.imageUpload.width),this.elemA.setAttribute("height",apijs.config.dialogue.imageUpload.height),this.elemA.setAttribute("id","progressbar"),this.fragment.firstChild.firstChild.appendChild(this.elemA)):apijs.config.navigator||(this.elemA=document.createElement("embed"),this.elemA.setAttribute("src",apijs.config.dialogue.imageUpload.src),this.elemA.setAttribute("type","image/svg+xml"),this.elemA.setAttribute("wmode","transparent"),this.elemA.setAttribute("width",apijs.config.dialogue.imageUpload.width),this.elemA.setAttribute("height",apijs.config.dialogue.imageUpload.height),this.elemA.setAttribute("id","progressbar"),this.fragment.firstChild.firstChild.appendChild(this.elemA))},this.htmlPhoto=function(e,t,i,a,o,n){var s=this.updateSize(e,t,i);this.elemA=document.createElement("dl"),this.elemB=document.createElement("dt"),apijs.config.dialogue.showFullsize&&this.checkSize(e,t)?(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",i),this.elemC.setAttribute("onclick","window.open(this.href); this.blur(); return false;"),this.elemD=document.createElement("img"),this.elemD.setAttribute("width",s.width),this.elemD.setAttribute("height",s.height),this.elemD.setAttribute("alt",""),this.elemD.setAttribute("class","loading resized"),this.elemD.setAttribute("id","topho"),this.elemC.appendChild(this.elemD),this.elemC.appendChild(document.createElement("span"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("width",s.width),this.elemC.setAttribute("height",s.height),this.elemC.setAttribute("alt",""),this.elemC.setAttribute("class","loading"),this.elemC.setAttribute("id","topho")),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===a&&"false"===o||(this.elemC=document.createElement("span"),"false"!==a&&"auto"!==a&&"false"!==o?this.elemC.appendChild(document.createTextNode(a+" ("+o+")")):"false"!==a&&"auto"!==a?this.elemC.appendChild(document.createTextNode(a)):"auto"===a&&"false"!==o?this.elemC.appendChild(document.createTextNode(s.id+" ("+o+")")):"auto"===a?this.elemC.appendChild(document.createTextNode(s.id)):"false"!==o&&this.elemC.appendChild(document.createTextNode("("+o+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+n+" ")),apijs.config.dialogue.savePhoto&&(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",apijs.config.dialogue.filePhoto+"?id="+s.id),this.elemC.setAttribute("type",s.mime),this.elemC.setAttribute("class","download"),this.elemC.appendChild(document.createTextNode(apijs.i18n.translate("downloadLink"))),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)},this.htmlVideo=function(e,t,i,a){var o=this.updateSize(apijs.config.dialogue.videoWidth,apijs.config.dialogue.videoHeight,e),n=null;this.elemA=document.createElement("dl"),this.elemB=document.createElement("dt"),this.elemC=document.createElement("video"),this.elemC.setAttribute("src",e),this.elemC.setAttribute("width",o.width),this.elemC.setAttribute("height",o.height),this.elemC.setAttribute("controls","controls"),apijs.config.dialogue.autoPlay&&this.elemC.setAttribute("autoplay","autoplay"),"function"!=typeof this.elemC.pause&&((n=new BBcode).init(apijs.i18n.translate("browserNoVideo")),n.exec(),this.elemC.appendChild(n.get()),this.elemC.style.width=o.width,this.elemC.style.height=o.height),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===t&&"false"===i||(this.elemC=document.createElement("span"),"false"!==t&&"auto"!==t&&"false"!==i?this.elemC.appendChild(document.createTextNode(t+" ("+i+")")):"false"!==t&&"auto"!==t?this.elemC.appendChild(document.createTextNode(t)):"auto"===t&&"false"!==i?this.elemC.appendChild(document.createTextNode(o.id+" ("+i+")")):"auto"===t?this.elemC.appendChild(document.createTextNode(o.id)):"false"!==i&&this.elemC.appendChild(document.createTextNode("("+i+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+a+" ")),apijs.config.dialogue.saveVideo&&(this.elemC=document.createElement("a"),this.elemC.setAttribute("href",apijs.config.dialogue.fileVideo+"?id="+o.id),this.elemC.setAttribute("type",o.mime),this.elemC.setAttribute("class","download"),this.elemC.appendChild(document.createTextNode(apijs.i18n.translate("downloadLink"))),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.fragment.firstChild.firstChild.appendChild(this.elemA)}}function Slideshow(){this.media=null,this.totals=null,this.presentation=null,this.init=function(){this.media={album:null,number:null,first:null,prev:null,next:null,last:null},this.totals=[],this.presentation=[];for(var e=0,t=0,i=null;null!==document.getElementById(apijs.config.slideshow.ids+"."+e);e++)for(i=apijs.config.slideshow.ids+"."+e+".999",this.presentation[e]=!!document.getElementById(i)&&0,document.getElementById(i)&&(apijs.config.navigator?document.getElementById(i).addEventListener("click",apijs.slideshow.showMedia,!1):document.getElementById(i).setAttribute("onclick","apijs.slideshow.showMedia(this.getAttribute('id')); return false;")),t=0;null!==document.getElementById(apijs.config.slideshow.ids+"."+e+"."+t);t++)i=apijs.config.slideshow.ids+"."+e+"."+t,apijs.config.navigator?apijs.config.slideshow.hoverload&&!1!==this.presentation[e]?(document.getElementById(i).addEventListener("click",apijs.slideshow.showMedia,!1),document.getElementById(i).addEventListener("mouseover",apijs.slideshow.showMedia,!1)):document.getElementById(i).addEventListener("click",apijs.slideshow.showMedia,!1):apijs.config.slideshow.hoverload&&!1!==this.presentation[e]?(document.getElementById(i).setAttribute("onclick","apijs.slideshow.showMedia(this.getAttribute('id')); return false;"),document.getElementById(i).setAttribute("onmouseover","apijs.slideshow.showMedia(this.getAttribute('id')); return false;")):document.getElementById(i).setAttribute("onclick","apijs.slideshow.showMedia(this.getAttribute('id')); return false;"),this.totals[e]=t},this.showMedia=function(e){var t={id:null,url:null,alt:null,num:0,name:null,date:null,legend:null,width:null,height:null},i=null,i=("string"!=typeof e?(e.preventDefault(),t.id=this.getAttribute("id"),t.url=this.getAttribute("href"),t.alt=this.firstChild.getAttribute("alt").split("|")):(t.id=e,t.url=document.getElementById(t.id).getAttribute("href"),t.alt=document.getElementById(t.id).firstChild.getAttribute("alt").split("|")),t.id.split("."));t.album=parseInt(i[1],10),t.number=parseInt(i[2],10),!1!==apijs.slideshow.presentation[t.album]&&(1<t.alt.length||t.alt.length<7)?"string"!=typeof e&&this.firstChild.hasAttribute("class")&&-1<this.firstChild.getAttribute("class").indexOf("actif")||(null!==apijs.dialogue.dialogType||6!==t.alt.length&&4!==t.alt.length?(null!==apijs.dialogue.dialogType||5!==t.alt.length&&3!==t.alt.length?apijs.slideshow.updatePresentation(t):t.number=apijs.slideshow.presentation[t.album],apijs.slideshow.showDialogue(t)):apijs.slideshow.updatePresentation(t)):5===t.alt.length||3===t.alt.length?apijs.slideshow.showDialogue(t):apijs.config.debug&&apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidUse"),"[pre]TheSlideshow » showMedia[br]"+apijs.i18n.translate("debugNotRecognizedAltAttribute")+"[/pre]")},this.updatePresentation=function(e){var t=null,i=null,a=0;if(6===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length&&0<e.alt[3].length&&0<e.alt[4].length){for(t=apijs.config.slideshow.ids+"."+e.album,document.getElementById(t+".999").setAttribute("href",document.getElementById(e.id).getAttribute("href")),document.getElementById(t+".999").firstChild.setAttribute("src",e.alt.shift()),document.getElementById(t+".999").firstChild.setAttribute("alt",e.alt.join("|")),i=document.getElementById(t).getElementsByTagName("img"),a=0;a<i.length;a++)i[a].hasAttribute("class")&&-1<i[a].getAttribute("class").indexOf("actif")&&i[a].removeAttribute("class");document.getElementById(e.id).firstChild.setAttribute("class","actif"),this.presentation[e.album]=e.number}else if(apijs.config.debug&&6===e.alt.length)apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidAltAttribute"),"[pre]TheSlideshow » changePhoto[br]➩ (string) url : "+e.alt[0]+"[br]➩ (number) width : "+e.alt[1]+"[br]➩ (number) height : "+e.alt[2]+"[br]➩ (string) date : "+e.alt[3]+"[br]➩ (string) legend : "+e.alt[4]+"[/pre]");else if(4===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length){for(t=apijs.config.slideshow.ids+"."+e.album,document.getElementById(t+".999").setAttribute("href",document.getElementById(e.id).getAttribute("href")),document.getElementById(t+".999").firstChild.setAttribute("src",e.alt.shift()),document.getElementById(t+".999").firstChild.setAttribute("alt",e.alt.join("|")),i=document.getElementById(t).getElementsByTagName("img"),a=0;a<i.length;a++)i[a].hasAttribute("class")&&-1<i[a].getAttribute("class").indexOf("actif")&&i[a].removeAttribute("class");document.getElementById(e.id).firstChild.setAttribute("class","actif"),this.presentation[e.album]=e.number}else apijs.config.debug&&4===e.alt.length&&apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidAltAttribute"),"[pre]TheSlideshow » changePhoto[br]➩ (string) url : "+e.alt[0]+"[br]➩ (string) date : "+e.alt[1]+"[br]➩ (string) legend : "+e.alt[2]+"[/pre]")},this.showDialogue=function(e){5===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length&&0<e.alt[2].length&&0<e.alt[3].length?(e.name=e.alt[2],e.date=e.alt[3],e.legend=e.alt[4],e.width=parseInt(e.alt[0],10),e.height=parseInt(e.alt[1],10),null!==apijs.dialogue.dialogType&&apijs.dialogue.actionClose(!1),apijs.dialogue.dialogPhoto(e.width,e.height,e.url,e.name,e.date,e.legend,!0),this.showNavigation(e.album,e.number)):apijs.config.debug&&5===e.alt.length?apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidAltAttribute"),"[pre]TheSlideshow » showMedia[br]➩ (number) width : "+e.alt[0]+"[br]➩ (number) height : "+e.alt[1]+"[br]➩ (string) date : "+e.alt[2]+"[br]➩ (string) legend : "+e.alt[3]+"[/pre]"):3===e.alt.length&&0<e.alt[0].length&&0<e.alt[1].length?(e.name=e.alt[0],e.date=e.alt[1],e.legend=e.alt[2],null!==apijs.dialogue.dialogType&&apijs.dialogue.actionClose(!1),apijs.dialogue.dialogVideo(e.url,e.name,e.date,e.legend,!0),this.showNavigation(e.album,e.number)):apijs.config.debug&&3===e.alt.length&&apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidAltAttribute"),"[pre]TheSlideshow » showMedia[br]➩ (string) date : "+e.alt[0]+"[br]➩ (string) legend : "+e.alt[1]+"[/pre]")},this.showNavigation=function(e,t){(-1<apijs.dialogue.dialogType.indexOf("photo")||-1<apijs.dialogue.dialogType.indexOf("video"))&&(this.media.album=e,this.media.number=t,this.media.first=apijs.config.slideshow.ids+"."+this.media.album+".0",this.media.prev=apijs.config.slideshow.ids+"."+this.media.album+"."+(this.media.number-1),this.media.next=apijs.config.slideshow.ids+"."+this.media.album+"."+(this.media.number+1),this.media.last=apijs.config.slideshow.ids+"."+this.media.album+"."+this.totals[this.media.album],document.getElementById(this.media.prev)?document.getElementById("prev").removeAttribute("disabled"):this.media.prev=null,document.getElementById(this.media.next)?document.getElementById("next").removeAttribute("disabled"):this.media.next=null)},this.actionFirst=function(){null!==this.media&&0<this.media.number&&this.media.number<=this.totals[this.media.album]&&this.showMedia(this.media.first)},this.actionPrev=function(){null!==this.media&&null!==this.media.prev&&0<this.media.number&&this.showMedia(this.media.prev)},this.actionNext=function(){null!==this.media&&null!==this.media.next&&this.media.number<this.totals[this.media.album]&&this.showMedia(this.media.next)},this.actionLast=function(){null!==this.media&&0<=this.media.number&&this.media.number<this.totals[this.media.album]&&this.showMedia(this.media.last)}}function Upload(){this.extensions=null,this.callback=null,this.params=null,this.key=null,this.svgTimer=null,this.svgDirection=0,this.svgWaiting=0,this.apcTimer=null,this.apcWaiting=0,this.sendFile=function(e,t,i,a,o,n,s){"string"==typeof e&&"number"==typeof t&&"object"==typeof i&&"function"==typeof a&&void 0!==o&&"string"==typeof n&&null!==i?(this.extensions=i,this.callback=a,this.params=o,this.key=uniqid(),apijs.dialogue.dialogFormUpload(e,this.prepareText(t),n,this.key,s)):apijs.config.debug&&("function"==typeof a&&"string"==typeof a.name&&0<a.name.length&&(a=a.name),apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheUpload » sendFile[br]➩ (string) title : "+e+"[br]➩ (number) maxsize : "+t+"[br]➩ (array) extensions : "+i+"[br]➩ (funcion) callback : "+a+"[br]➩ (object) params : "+o+"[br]➩ (string) data : "+n+"[br]➩ (string) icon : "+s+"[/pre]"))},this.deleteFile=function(e,t,i,a,o,n){"string"==typeof e&&"string"==typeof t&&"function"==typeof i&&void 0!==a&&"string"==typeof o?(this.callback=i,this.params=a,apijs.dialogue.dialogConfirmation(e,t,apijs.upload.actionDelete,o,n="string"!=typeof n?"delete":n)):apijs.config.debug&&("function"==typeof i&&"string"==typeof i.name&&0<i.name.length&&(i=i.name),apijs.dialogue.dialogInformation(apijs.i18n.translate("debugInvalidCall"),"[pre]TheUpload » deleteFile[br]➩ (string) title : "+e+"[br]➩ (string) text : "+t+"[br]➩ (funcion) callback : "+i+"[br]➩ (object) params : "+a+"[br]➩ (string) key : "+o+"[br]➩ (string) icon : "+n+"[/pre]"))},this.prepareText=function(e){var t=null,i=null;return"*"===(i=(t=apijs.dialogue.clone(this.extensions)).pop())?apijs.i18n.translate("uploadAllType",e):t.length<1?apijs.i18n.translate("uploadOneType",i,e):(t=t.join(", "),apijs.i18n.translate("uploadMultiType",t,i,e))},this.actionConfirm=function(){var e=document.getElementById("box").getElementsByTagName("input")[1].value,t=!1,i=null,a=(i=apijs.dialogue.clone(this.extensions)).pop();return e.length<1?document.getElementById("box").getElementsByTagName("input")[1].focus():"*"===a||in_array(e.slice(e.lastIndexOf(".")+1).toLowerCase(),this.extensions)?(t=!0,document.getElementById("iframeUpload").setAttribute("onload","apijs.upload.endUpload();"),window.setTimeout(apijs.upload.startUpload,1)):i.length<1?apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,apijs.i18n.translate("uploadBadOneType",e,a),"eeupload"):(i=i.join(", "),apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,apijs.i18n.translate("uploadBadMultiType",e,i,a),"eeupload")),t},this.actionDelete=function(e){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status)try{var e=null,t=(e=o.responseXML).getElementsByTagName("status")[0].firstChild.nodeValue,i=e.getElementsByTagName("message")[0].firstChild.nodeValue,a="success"===t?"information":"error";apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,i,a),"success"===t&&apijs.upload.callback(apijs.upload.params)}catch(e){apijs.config.debug&&alert(e)}else 4===o.readyState&&200!==o.status&&apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,apijs.i18n.translate("deleteNotFound",o.status,o.statusText),"error")},o.open("GET",apijs.config.dialogue.fileUpload+"?delete="+e,!0),o.send(null)},this.startUpload=function(){apijs.dialogue.dialogProgress(document.getElementById("box").firstChild.firstChild.nodeValue,apijs.i18n.translate("uploadInProgress")),apijs.upload.svgDirection=0,apijs.upload.svgWaiting=10,apijs.upload.apcWaiting=10,apijs.upload.svgTimer=window.setInterval(apijs.upload.animGeneric,50),apijs.upload.apcTimer=window.setTimeout(apijs.upload.uploadRealTime,1e3)},this.uploadRealTime=function(){var o;apijs.upload.apcWaiting<1||((o=new XMLHttpRequest).onreadystatechange=function(){if(4===o.readyState&&200===o.status)try{var e,t,i=null,a=null;"uploading"===(a=(i=o.responseXML).getElementsByTagName("status")[0].firstChild.nodeValue)?(apijs.upload.svgTimer&&clearInterval(apijs.upload.svgTimer),e=parseInt(i.getElementsByTagName("rate")[0].firstChild.nodeValue,10),0<(t=parseInt(i.getElementsByTagName("percent")[0].firstChild.nodeValue,10))&&t<100&&(apijs.upload.animToValue(t,e),apijs.upload.apcTimer=window.setTimeout(apijs.upload.uploadRealTime,1e3))):"false"===a&&0<apijs.upload.apcWaiting&&(--apijs.upload.apcWaiting,apijs.upload.apcTimer=window.setTimeout(apijs.upload.uploadRealTime,1e3))}catch(e){apijs.config.debug&&alert(e)}},o.open("GET",apijs.config.dialogue.fileUpload+"?realtime="+apijs.upload.key,!0),o.send(null))},this.endUpload=function(){this.apcTimer&&clearTimeout(this.apcTimer),this.svgTimer&&clearInterval(this.svgTimer),this.extensions=null,this.svgTimer=null,this.svgDirection=0,this.svgWaiting=0,this.apcTimer=null,this.apcWaiting=0;try{var e=null,t=null,i=null,i=apijs.config.navigator?(t=(e=window.frames["iframeUpload."+this.key].document).getElementsByTagName("status")[0].firstChild.nodeValue,e.getElementsByTagName("message")[0].firstChild.nodeValue):(e=(e=(e=window.frames["iframeUpload."+this.key].document.documentElement.getElementsByTagName("body")[0].innerHTML).replace(/[\s\r\n\t]|<[^>]+>|&[a-z]+;/g,"")).replace('?xmlversion="1.0"encoding="utf-8"?',""),t=/status(.+)\/status/i.test(e),t=RegExp.$1,i=/message(.+)\/message/i.test(e),RegExp.$1);document.getElementById("progressbar")&&void 0!==document.getElementById("progressbar").getSVGDocument&&(document.getElementById("iframeUpload").removeAttribute("onload"),document.getElementById("iframeUpload").setAttribute("src",apijs.config.dialogue.imageUpload.src)),"success"===t?(this.animToValue(100),window.setTimeout(function(){apijs.upload.callback(apijs.upload.key,apijs.upload.params)},1e3)):apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,i,"eeupload")}catch(e){apijs.dialogue.dialogInformation(document.getElementById("box").firstChild.firstChild.nodeValue,"[pre]"+e+"[/pre]","eeupload")}},this.animGeneric=function(){var e;apijs.upload.svgWaiting<1||!document.getElementById("progressbar")?clearInterval(apijs.upload.svgTimer):document.getElementById("progressbar")&&void 0===document.getElementById("progressbar").getSVGDocument?--apijs.upload.svgWaiting:document.getElementById("progressbar")&&void 0!==document.getElementById("progressbar").getSVGDocument&&(document.getElementById("progressbar").getSVGDocument().getElementsByTagName("rect")[0]||document.getElementById("progressbar").getSVGDocument().rootElement)&&(e=apijs.config.navigator?document.getElementById("progressbar").getSVGDocument().getElementsByTagName("rect")[0]:document.getElementById("progressbar").getSVGDocument().rootElement.getElementsByTagName("rect").item(0),0===apijs.upload.svgDirection?(e.setAttribute("x",parseInt(e.getAttribute("x"),10)+5),250<=parseInt(e.getAttribute("x"),10)&&(apijs.upload.svgDirection=1)):(e.setAttribute("x",parseInt(e.getAttribute("x"),10)-5),parseInt(e.getAttribute("x"),10)<=0&&(apijs.upload.svgDirection=0)))},this.animToValue=function(e,t){var i,a;document.getElementById("progressbar")&&void 0!==document.getElementById("progressbar").getSVGDocument&&(a=i=null,i=apijs.config.navigator?document.getElementById("progressbar").getSVGDocument().getElementsByTagName("rect")[0]:document.getElementById("progressbar").getSVGDocument().rootElement.getElementsByTagName("rect").item(0),a=apijs.config.navigator?document.getElementById("progressbar").getSVGDocument().getElementsByTagName("text")[0]:document.getElementById("progressbar").getSVGDocument().rootElement.getElementsByTagName("text").item(0),"number"==typeof t&&e<100?("0"!==i.getAttribute("x")&&i.setAttribute("x","0"),i.setAttribute("width",3*e),a.firstChild.replaceData(0,a.firstChild.length,apijs.i18n.translate("uploadRate",e,t))):e<100?(i.setAttribute("width",3*e),a.firstChild.replaceData(0,a.firstChild.length,e+"%")):(i.setAttribute("x","0"),i.setAttribute("width","301"),a.firstChild.replaceData(0,a.firstChild.length,"100%")))}}function Map(){this.srvActuel=null,this.srvGeoportailPret=!1,this.srvGeoportailActif=!1,this.srvGooglePret=!1,this.srvGoogleActif=!1,this.width=apijs.config.map.width,this.height=apijs.config.map.height,this.modifiable=!1,this.multipoint=!1,this.coordonnees=!1,this.latitude=0,this.longitude=0,this.geocodeur=null,this.layerGeoportail=null,this.dragGeoportail=null,this.mapGeoportail=null,this.mapGoogle=null,this.markerGeoportail=null,this.markerGoogle=null,this.init=function(){document.getElementById("carteInteractive").style.display="block",document.getElementById("carteConfModifiable")&&(this.modifiable="true"===document.getElementById("carteConfModifiable").getAttribute("value")),document.getElementById("carteConfMultipoint")&&(this.multipoint="true"===document.getElementById("carteConfMultipoint").getAttribute("value")),document.getElementById("carteConfWidth")&&document.getElementById("carteConfHeight")&&(this.width=parseInt(document.getElementById("carteConfWidth").getAttribute("value"),10),this.height=parseInt(document.getElementById("carteConfHeight").getAttribute("value"),10),document.getElementById("carteInteractive").style.width=this.width+"px",document.getElementById("carteInteractive").style.height=this.height+"px"),0!==parseFloat(document.getElementById("carteLatitude").getAttribute("value"),10)?(this.latitude=parseFloat(document.getElementById("carteLatitude").getAttribute("value"),10),this.longitude=parseFloat(document.getElementById("carteLongitude").getAttribute("value"),10),this.coordonnees=!0):document.getElementById("carteConfLatitude")&&document.getElementById("carteConfLongitude")&&(this.latitude=parseFloat(document.getElementById("carteConfLatitude").getAttribute("value"),10),this.longitude=parseFloat(document.getElementById("carteConfLongitude").getAttribute("value"),10)),"function"==typeof geoportalLoadmap||"function"==typeof GMap2?("function"==typeof geoportalLoadmap&&(document.getElementById("mapControlGeoportail").addEventListener("click",function(e){apijs.map.actionGeoportail(e)},!1),document.getElementById("mapControlGeoportail").removeAttribute("disabled"),this.srvGeoportailPret=!0),"function"==typeof GMap2&&GBrowserIsCompatible()&&(document.getElementById("mapControlGoogle").addEventListener("click",function(e){apijs.map.actionGoogle(e)},!1),document.getElementById("mapControlGoogle").removeAttribute("disabled"),this.srvGooglePret=!0),document.getElementById("mapControlRefresh")&&document.getElementById("mapControlRefresh").addEventListener("click",function(e){apijs.map.actionRefresh(e)},!1),document.getElementById("mapControlRecenter").addEventListener("click",function(e){apijs.map.actionRecenter(e)},!1),document.getElementById("mapControlClose").addEventListener("click",function(e){apijs.map.actionClose(e)},!1)):(document.getElementById("carteIntro").style.display="none",document.getElementById("carteFatal").style.display="block"),apijs.config.navigator?window.addEventListener("unload",function(){apijs.map.destroy()},!1):window.onunload=apijs.map.destroy},this.initGeoportail=function(){this.srvGeoportailActif?(this.srvGeoportailActif=!0,this.srvActuel="geoportail"):(this.srvGeoportailActif=!0,this.srvActuel="geoportail",geoportalLoadmap("mapGeoportail","normal","FXX"),this.mapGeoportail=map,this.mapGeoportail.setSize(this.width,this.height),this.mapGeoportail.getMap().getControlsByClass("OpenLayers.Control.KeyboardDefaults")[0].deactivate(),this.mapGeoportail.getMap().setCenterAtLonLat(apijs.config.map.initLatitude,apijs.config.map.initLongitude,apijs.config.map.zoomInitial),this.mapGeoportail.addGeoportalLayer("GEOGRAPHICALGRIDSYSTEMS.MAPS:WMSC",{opacity:1}),this.mapGeoportail.addGeoportalLayer("ORTHOIMAGERY.ORTHOPHOTOS:WMSC",{visibility:!1}),this.mapGeoportail.openLayersPanel(!1),this.mapGeoportail.openToolsPanel(!0),this.mapGeoportail.setInformationPanelVisibility(!1))},this.initGoogle=function(){this.srvGoogleActif?(this.srvGoogleActif=!0,this.srvActuel="google"):(this.srvGoogleActif=!0,this.srvActuel="google",this.mapGoogle=new GMap2(document.getElementById("mapGoogle"),{size:new GSize(this.width,this.height)}),this.mapGoogle.enableScrollWheelZoom(),this.mapGoogle.setCenter(new GLatLng(apijs.config.map.initLatitude,apijs.config.map.initLongitude),apijs.config.map.zoomInitial+1),this.mapGoogle.addControl(new GSmallMapControl),this.mapGoogle.addControl(new google.maps.MenuMapTypeControl))},this.destroy=function(){"function"==typeof GUnload&&GUnload(),this.showIntro(),document.getElementById("mapControlGeoportail").hasAttribute("disabled")||document.getElementById("mapControlGeoportail").setAttribute("disabled","disabled"),document.getElementById("mapControlGoogle").hasAttribute("disabled")||document.getElementById("mapControlGoogle").setAttribute("disabled","disabled"),this.srvActuel=null,this.srvGeoportailPret=!1,this.srvGeoportailActif=!1,this.srvGooglePret=!1,this.srvGoogleActif=!1,this.modifiable=!1,this.multipoint=!1,this.coordonnees=!1,this.latitude=0,this.longitude=0,this.geocodeur=null,this.layerGeoportail=null,this.dragGeoportail=null,this.mapGeoportail=null,this.mapGoogle=null,this.markerGeoportail=null,this.markerGoogle=null},this.actionClose=function(e){e.target.blur(),this.showIntro()},this.actionRecenter=function(e){e.target.blur(),this.centerMap()},this.actionRefresh=function(e){e.target.blur(),this.checkAddress()&&this.getCoordinates()},this.actionGeoportail=function(e){e.target.blur(),this.modifiable?this.checkAddress()&&(this.showGeoportail(),this.initGeoportail(),this.coordonnees&&!this.markerGeoportail?this.setMarker(!0):this.coordonnees?this.synchroMarker(!1):this.coordonnees||this.getCoordinates()):(this.showGeoportail(),this.initGeoportail(),this.coordonnees&&!this.markerGeoportail?this.setMarker(!0):this.coordonnees&&this.synchroMarker(!1))},this.actionGoogle=function(e){e.target.blur(),this.modifiable?this.checkAddress()&&(this.showGoogle(),this.initGoogle(),this.coordonnees&&!this.markerGoogle?this.setMarker(!0):this.coordonnees?this.synchroMarker(!1):this.coordonnees||this.getCoordinates()):(this.showGoogle(),this.initGoogle(),this.coordonnees&&!this.markerGoogle?this.setMarker(!0):this.coordonnees&&this.synchroMarker(!1))},this.showIntro=function(){this.srvGeoportailPret&&document.getElementById("mapControlGeoportail").hasAttribute("class")&&document.getElementById("mapControlGeoportail").removeAttribute("class"),this.srvGeoportailPret&&document.getElementById("mapControlGeoportail").hasAttribute("disabled")&&document.getElementById("mapControlGeoportail").removeAttribute("disabled"),this.srvGooglePret&&document.getElementById("mapControlGoogle").hasAttribute("class")&&document.getElementById("mapControlGoogle").removeAttribute("class"),this.srvGooglePret&&document.getElementById("mapControlGoogle").hasAttribute("disabled")&&document.getElementById("mapControlGoogle").removeAttribute("disabled"),document.getElementById("mapControlRefresh")&&!document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").setAttribute("disabled","disabled"),document.getElementById("mapControlRecenter").hasAttribute("disabled")||document.getElementById("mapControlRecenter").setAttribute("disabled","disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")||document.getElementById("mapControlClose").setAttribute("disabled","disabled"),document.getElementById("mapGeoportail").style.display="none",document.getElementById("mapGoogle").style.display="none",document.getElementById("carteIntro").style.display="block",document.getElementById("carteFatal").style.display="none"},this.showGeoportail=function(){document.getElementById("mapControlGeoportail").setAttribute("class","actif"),document.getElementById("mapControlGeoportail").setAttribute("disabled","disabled"),document.getElementById("mapControlGoogle").hasAttribute("class")&&(document.getElementById("mapControlGoogle").removeAttribute("class"),document.getElementById("mapControlGoogle").removeAttribute("disabled")),this.coordonnees&&document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),this.modifiable&&document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").removeAttribute("disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")&&document.getElementById("mapControlClose").removeAttribute("disabled"),document.getElementById("mapGeoportail").style.display="block",document.getElementById("mapGoogle").style.display="none",document.getElementById("carteIntro").style.display="none"},this.showGoogle=function(){document.getElementById("mapControlGoogle").setAttribute("class","actif"),document.getElementById("mapControlGoogle").setAttribute("disabled","disabled"),document.getElementById("mapControlGeoportail").hasAttribute("class")&&(document.getElementById("mapControlGeoportail").removeAttribute("class"),document.getElementById("mapControlGeoportail").removeAttribute("disabled")),this.coordonnees&&document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),this.modifiable&&document.getElementById("mapControlRefresh").hasAttribute("disabled")&&document.getElementById("mapControlRefresh").removeAttribute("disabled"),document.getElementById("mapControlClose").hasAttribute("disabled")&&document.getElementById("mapControlClose").removeAttribute("disabled"),document.getElementById("mapGeoportail").style.display="none",document.getElementById("mapGoogle").style.display="block",document.getElementById("carteIntro").style.display="none"},this.checkAddress=function(){return!0},this.getCoordinates=function(){this.srvGooglePret?(this.geocodeur||(this.geocodeur=new GClientGeocoder,this.geocodeur.setBaseCountryCode("fr")),this.geocodeur.getLatLng(document.getElementById("txt_voie").value+" "+document.getElementById("txt_code_postal").value+" "+document.getElementById("txt_ville").value+" France",function(e){e?(apijs.map.coordonnees=!0,apijs.map.latitude=e.lat(),apijs.map.longitude=e.lng(),"geoportail"===apijs.map.srvActuel&&!apijs.map.markerGeoportail||"google"===apijs.map.srvActuel&&!apijs.map.markerGoogle?apijs.map.setMarker(!0):apijs.map.synchroMarker(!0)):(("geoportail"===apijs.map.srvActuel&&!apijs.map.markerGeoportail||"google"===apijs.map.srvActuel&&!apijs.map.markerGoogle)&&apijs.map.setMarkerClick(),"function"==typeof Dialogue&&apijs.dialogue instanceof Dialogue?apijs.dialogue.dialogInformation("Attention","Adresse introuvable...","warning"):alert("Adresse introuvable..."))})):this.setMarkerClick()},this.setMarkerClick=function(){"geoportail"===this.srvActuel?this.mapGeoportail.getMap().events.register("click",apijs.map.mapGeoportail,function(e){apijs.map.markerGeoportail||((e=apijs.map.mapGeoportail.getMap().getLonLatFromViewPortPx(e.xy)).transform(apijs.map.mapGeoportail.getMap().getProjection(),OpenLayers.Projection.CRS84),apijs.map.coordonnees=!0,apijs.map.latitude=e.lat,apijs.map.longitude=e.lon,apijs.map.setMarker(!0))}):"google"===this.srvActuel&&GEvent.addListener(this.mapGoogle,"click",function(e,t){apijs.map.markerGoogle||(apijs.map.coordonnees=!0,apijs.map.latitude=t.lat(),apijs.map.longitude=t.lng(),apijs.map.setMarker(!0))})},this.setMarker=function(e){var t;"geoportail"===this.srvActuel?((t=new OpenLayers.Geometry.Point(this.longitude,this.latitude)).transform(OpenLayers.Projection.CRS84,this.mapGeoportail.getMap().getProjection()),this.markerGeoportail=new OpenLayers.Feature.Vector(t,null,{externalGraphic:apijs.config.map.imageMarker,graphicWidth:26,graphicHeight:32,graphicXOffset:-12,graphicYOffset:-32}),this.layerGeoportail||(this.layerGeoportail=new OpenLayers.Layer.Vector("Marqueur")),this.layerGeoportail.addFeatures([this.markerGeoportail]),this.mapGeoportail.getMap().addLayer(this.layerGeoportail),!this.dragGeoportail&&this.modifiable&&(this.dragGeoportail=new OpenLayers.Control.DragFeature(this.layerGeoportail),this.mapGeoportail.getMap().addControl(this.dragGeoportail),this.dragGeoportail.activate(),this.dragGeoportail.onComplete=function(e,t){t=apijs.map.mapGeoportail.getMap().getLonLatFromViewPortPx(t);t.transform(apijs.map.mapGeoportail.getMap().getProjection(),OpenLayers.Projection.CRS84),apijs.map.latitude=t.lat,apijs.map.longitude=t.lon,apijs.map.centerMap(),document.getElementById("carteLatitude").setAttribute("value",apijs.map.latitude),document.getElementById("carteLongitude").setAttribute("value",apijs.map.longitude)})):"google"===this.srvActuel&&((t=new GIcon).image=apijs.config.map.imageMarker,t.iconSize=new GSize(26,32),t.iconAnchor=new GPoint(12,32),this.markerGoogle=new GMarker(new GLatLng(this.latitude,this.longitude),{icon:t,draggable:this.modifiable,clickable:!1}),this.mapGoogle.addOverlay(this.markerGoogle),this.modifiable&&GEvent.addListener(this.markerGoogle,"dragend",function(){var e=apijs.map.markerGoogle.getPoint();apijs.map.latitude=e.lat(),apijs.map.longitude=e.lng(),apijs.map.mapGoogle.panTo(e),document.getElementById("carteLatitude").setAttribute("value",apijs.map.latitude),document.getElementById("carteLongitude").setAttribute("value",apijs.map.longitude)})),e&&this.centerMap(apijs.config.map.zoomSynchro),document.getElementById("mapControlRecenter").hasAttribute("disabled")&&document.getElementById("mapControlRecenter").removeAttribute("disabled"),document.getElementById("carteLatitude").setAttribute("value",this.latitude),document.getElementById("carteLongitude").setAttribute("value",this.longitude)},this.synchroMarker=function(e){"geoportail"===this.srvActuel?(this.modifiable&&this.markerGeoportail&&(this.layerGeoportail.removeFeatures([this.markerGeoportail]),this.setMarker(!1)),this.markerGeoportail||this.setMarker(!0),e&&this.centerMap()):"google"===this.srvActuel&&(this.modifiable&&this.markerGoogle&&this.markerGoogle.setLatLng(new GLatLng(this.latitude,this.longitude)),this.markerGoogle||this.setMarker(!0),e&&this.centerMap())},this.centerMap=function(e){this.coordonnees&&"geoportail"===this.srvActuel?"number"==typeof e?this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude,e):this.mapGeoportail.getMap().getZoom()<apijs.config.map.zoomCenter?this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude,apijs.config.map.zoomCenter):this.mapGeoportail.getMap().setCenterAtLonLat(this.longitude,this.latitude):this.coordonnees&&"google"===this.srvActuel&&("number"==typeof e?this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude),e+1):this.mapGoogle.getZoom()<apijs.config.map.zoomCenter?this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude),apijs.config.map.zoomCenter+1):this.mapGoogle.setCenter(new GLatLng(this.latitude,this.longitude)))}}navigator.userAgent.indexOf("MSIE")<0||-1<navigator.userAgent.indexOf("MSIE 9")?window.addEventListener("load",start,!1):-1<navigator.userAgent.indexOf("MSIE 8")&&(apijs.config.navigator=!1,apijs.config.transition=!1,document.createElement("video"),window.innerWidth=document.documentElement.clientWidth,window.innerHeight=document.documentElement.clientHeight,window.attachEvent("onload",start));