/*!
 * Copyright 2008-2014 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/apijs - 5.0.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
"use strict";Function.prototype.hasOwnProperty("bind")||(Function.prototype.bind=function(e){var t=this,i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,0===i.length?arguments:0===arguments.length?i:i.concat(Array.prototype.slice.call(arguments,0)))}}),String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var apijs={core:{},version:500,config:{lang:"auto",debug:!1,dialog:{closeOnClick:!1,restrictNavigation:!0,emotes:!0,imagePrev:null,imageNext:null,imageClose:null},slideshow:{ids:"slideshow"}},start:function(){this.i18n=new apijs.core.i18n,"function"==typeof setApijsLang&&setApijsLang(),this.i18n.init(),"function"==typeof setApijsConfig&&setApijsConfig(),this.dialog=new apijs.core.dialog,this.upload=new apijs.core.upload,this.slideshow=new apijs.core.slideshow,this.slideshow.init(),"function"==typeof setApijsRewrites&&setApijsRewrites()},openTab:function(e){e.preventDefault(),window.open(this.href)},inArray:function(e,t){if(e instanceof Array){for(var i in e)if(e.hasOwnProperty(i)&&apijs.inArray(e[i],t))return!0}else for(i in t)if(t.hasOwnProperty(i)&&!isNaN(i)&&t[i]===e)return!0;return!1},serialize:function(e){for(var t,i,s,a=[],n=e.elements.length-1;0<=n;n-=1)if(t=e.elements[n].nodeName,i=e.elements[n].type,"INPUT"===t)this.inArray(i,["checkbox","radio"])?e.elements[n].checked&&a.push(e.elements[n].getAttribute("name")+"="+encodeURIComponent(e.elements[n].value)):this.inArray(i,["file","button","reset","submit"])||a.push(e.elements[n].getAttribute("name")+"="+encodeURIComponent(e.elements[n].value));else if("TEXTAREA"===t)a.push(e.elements[n].getAttribute("name")+"="+encodeURIComponent(e.elements[n].value));else if("SELECT"===t)if("select-multiple"===i)for(s=e.elements[n].options.length-1;0<=s;s-=1)e.elements[n].options[s].selected&&a.push(e.elements[n].getAttribute("name")+"="+encodeURIComponent(e.elements[n].options[s].value));else a.push(e.elements[n].getAttribute("name")+"="+encodeURIComponent(e.elements[n].value));return a.join("&")}};"function"!=typeof window.addEventListener||/Presto|Opera.{1}12/.test(navigator.userAgent)||window.addEventListener("load",apijs.start.bind(apijs),!1),apijs.core.error=function(e,t,i){var s,a=[];if("string"==typeof i)a.push(i);else for(s in i)i.hasOwnProperty(s)&&a.push(s+" : "+i[s]);throw apijs.config.debug&&apijs.dialog.dialogInformation(apijs.i18n.translate(t),"[pre]"+e+"[br]➩ "+a.join("[br]➩ "),"debug"),new Error(e+", "+a.join(" / "))},apijs.core.i18n=function(){this.data=[],this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",buttonBrowse:"Choose a file",userLeavePage:"You are about to leave...",operationTooLong:"This operation is too long? ",warningLostChange:"Warning: all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",error404:"Error 404\n The file does not exist.",ctrlSlideshowFirstLast:"start/end",ctrlSlideshowNextPrev:"previous/next",ctrlVideoPause:"play/pause",ctrlVideoTime:"backward/forward",ctrlVideoSound:"decrease/increase the volume",ctrlVideoMute:"mute",ctrlDialogFullscreen:"full screen",ctrlDialogQuit:"quit",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"All files are accepted.[br]Maximum size: § MB.",uploadOneType:"Accepted file format: §.[br]Maximum size: § MB.",uploadMultiType:"Accepted file formats: § and §.[br]Maximum size: § MB.",uploadDecimal:".",upload10:"§% (§ KB/s)",upload11:"§% (§ KB/s - § minutes left)",upload12:"§% (§ KB/s - § minute left)",upload13:"§% (§ KB/s - § seconds left)",upload20:"§% (at § KB/s)",upload21:"§% (at § KB/s in § minutes)",upload22:"§% (at § KB/s in § minute)",upload23:"§% (at § KB/s in § seconds)",uploadBadType:"It's impossible to send the file because the proposed file format isn't allowed. Proposed file format: §.",uploadBadSize:"It's impossible to send the file because the file size is too large. Proposed file size: § MB.",uploadEmpty:"It's impossible to send the file because the file is empty.",uploadError1:"An error occurred while sending the file.[br][em]➩ Erreur §.[/em]",uploadError2:"An error occurred while processing the file.[/p][p]§",debugInvalidCall:"(debug) Invalid call",debugInvalidUse:"(debug) Invalid use",debugUnknownConfig:"Unknown configuration (§).",debugBadUse:"The upload dialog must be called with §."},this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",buttonBrowse:"Choisir un fichier",userLeavePage:"Vous vous apprêtez à partir...",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",error404:"Erreur 404\n Le fichier n'existe pas.",ctrlSlideshowFirstLast:"début/fin",ctrlSlideshowNextPrev:"précédent/suivant",ctrlVideoPause:"lecture/pause",ctrlVideoTime:"reculer/avancer",ctrlVideoSound:"baisser/augmenter le volume",ctrlVideoMute:"couper le son",ctrlDialogFullscreen:"plein écran",ctrlDialogQuit:"quitter",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Échap",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § Mo.",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § Mo.",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § Mo.",uploadDecimal:",",upload10:"§% (§ Ko/s)",upload11:"§% (§ Ko/s - § minutes restantes)",upload12:"§% (§ Ko/s - § minute restante)",upload13:"§% (§ Ko/s - § secondes restantes)",upload20:"§% (à § Ko/s)",upload21:"§% (à § Ko/s en § minutes)",upload22:"§% (à § Ko/s en § minute)",upload23:"§% (à § Ko/s en § secondes)",uploadBadType:"Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé. Format du fichier proposé : §.",uploadBadSize:"Il est impossible d'envoyer le fichier car la taille du fichier proposé est trop importante. Taille du fichier proposé : § Mo.",uploadEmpty:"Il est impossible d'envoyer le fichier car le fichier est vide.",uploadError1:"Une erreur est survenue lors de l'envoi du fichier.[br][em]➩ Erreur §.[/em]",uploadError2:"Une erreur est survenue lors du traitement du fichier.[/p][p]§"},this.init=function(){var e,t=document.querySelector("html");-1<apijs.config.lang.indexOf("auto")&&(t.getAttribute("xml:lang")?e=t.getAttribute("xml:lang").slice(0,2):t.getAttribute("lang")&&(e=t.getAttribute("lang").slice(0,2)),"string"==typeof e&&this.data.hasOwnProperty(e)?apijs.config.lang=e:-1<apijs.config.lang.indexOf("auto-")&&(apijs.config.lang=apijs.config.lang.slice(5))),this.data.hasOwnProperty(apijs.config.lang)||(apijs.config.lang="en")},this.translate=function(e){var t,i=apijs.config.lang,s=0,a=1,n="";if("string"!=typeof this.data[i][e]){if("en"===i||"string"!=typeof this.data.en[e])return e;i="en"}if(1<arguments.length){for(t=this.data[i][e].split("§");s<t.length;s++)n+=a<arguments.length?t[s]+arguments[a++]:t[s];return n}return this.data[i][e]},this.nodeTranslate=function(e){return document.createTextNode(this.translate(e))},this.changeLang=function(e){if("string"==typeof e){if(this.data.hasOwnProperty(e))return apijs.config.lang=e,!0;if(-1<e.indexOf("auto"))return apijs.config.lang=e,this.init(),!0}return!1}},apijs.core.dialog=function(){this.styles=null,this.paused=null,this.image=null,this.timer=null,this.callback=null,this.args=null,this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.tagDialog=null,this.tagMedia=null,this.tagTitle=null,this.tagBox=null,this.dialogInformation=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.initDialog("information",i),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonOk(),this.showDialog(),this.tagBox.querySelector("button.confirm").focus()):apijs.core.error("TheDialog.dialogInformation","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(string) icon":i})},this.dialogConfirmation=function(e,t,i,s,a){"string"==typeof e&&"string"==typeof t&&"function"==typeof i?(this.initDialog("confirmation",a),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonConfirm("button"),this.callback=i,this.args=s,this.showDialog(),this.tagBox.querySelector("button.confirm").focus()):("function"==typeof i&&"string"==typeof i.name&&0<i.name.length&&(i=i.name),apijs.core.error("TheDialog.dialogConfirmation","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(function) *callback":i,"(mixed) args":s,"(string) icon":a}))},this.dialogFormOptions=function(e,t,i,s,a,n){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"function"==typeof s?(this.initDialog("options",n),this.htmlParent(null,i),this.htmlTitle(e),this.htmlContent(t),this.htmlButtonConfirm("submit"),this.callback=s,this.args=a,this.showDialog(),window.setTimeout(function(){apijs.dialog.tagBox.querySelector("input:not([readonly]),textarea:not([readonly]),select:not([disabled])").focus()},12)):("function"==typeof s&&"string"==typeof s.name&&0<s.name.length&&(s=s.name),apijs.core.error("TheDialog.dialogFormOptions","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(string) *action":i,"(function) *callback":s,"(mixed) args":a,"(string) icon":n}))},this.dialogFormUpload=function(e,t,i,s,a){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"string"==typeof s?(this.initDialog("upload",a),this.htmlParent(null,i),this.htmlTitle(e),this.htmlContent(t,!1),this.htmlFormUpload(s),this.htmlButtonConfirm("submit"),this.showDialog(),window.setTimeout(function(){apijs.dialog.tagBox.querySelector("button").focus()},12)):apijs.core.error("TheDialog.dialogFormUpload","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(string) *action":i,"(string) *inputname":s,"(string) icon":a})},this.dialogProgress=function(e,t,i){"string"==typeof e&&"string"==typeof t?(this.initDialog("progress",i),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t,!1),this.htmlProgressBar(),this.showDialog()):apijs.core.error("TheDialog.dialogProgress","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(string) icon":i})},this.dialogWaiting=function(e,t,i,s){"string"==typeof e&&"string"==typeof t?(this.initDialog("waiting",s),this.htmlParent(),this.htmlTitle(e),this.htmlContent(t,!1),this.showDialog(),"number"==typeof i&&5<i&&(this.timer=window.setTimeout(apijs.dialog.htmlLinkReload.bind(this),1e3*i))):apijs.core.error("TheDialog.dialogWaiting","debugInvalidCall",{"(string) *title":e,"(string) *text":t,"(number) time":i,"(string) icon":s})},this.dialogPhoto=function(e,t,i,s,a){"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"string"==typeof s?("string"==typeof a?(this.initDialog("photo","notransition slideshow"),this.htmlParent(a)):(this.initDialog("photo","notransition"),this.htmlParent()),this.htmlMedia(e,t,i,s),this.htmlHelp("string"==typeof a,!1),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialog(),this.loadImage(e)):apijs.core.error("TheDialog.dialogPhoto","debugInvalidCall",{"(string) *url":e,"(string) *name":t,"(string) *date":i,"(string) *legend":s})},this.dialogVideo=function(e,t,i,s,a){"string"==typeof e&&"string"==typeof t&&"string"==typeof s&&"string"==typeof s?("string"==typeof a?(this.initDialog("video","notransition slideshow"),this.htmlParent(a)):(this.initDialog("video","notransition"),this.htmlParent()),this.htmlMedia(e,t,i,s),this.htmlHelp("string"==typeof a,!0),this.htmlButtonClose(),this.htmlButtonNavigation(),this.showDialog(),this.actionResizeMedia()):apijs.core.error("TheDialog.dialogVideo","debugInvalidCall",{"(string) *url":e,"(string) *name":t,"(string) *date":i,"(string) *legend":s})},this.dialogEmpty=function(e,t,i,s){"string"==typeof e?(this.initDialog("empty",s),this.htmlParent(),this.htmlContent(e),("boolean"==typeof t&&t||!0!==i)&&this.htmlButtonClose(),"boolean"==typeof i&&i&&this.htmlButtonOk(),this.showDialog(),"boolean"==typeof i&&i&&this.tagBox.querySelector("button.confirm").focus()):apijs.core.error("TheDialog.dialogEmpty","debugInvalidCall",{"(string) *text":e,"(boolean) closeButton":t,"(boolean) okButton":i,"(string) icon":s})},this.actionClose=function(e){document.getElementById("apijsDialog")&&this.deleteDialog("boolean"!=typeof e||!0===e)},this.actionCloseOnClick=function(e){"apijsDialog"!==e.target.getAttribute("id")||apijs.dialog.styles.has("photo","video","waiting","progress","lock")||apijs.dialog.deleteDialog(!0)},this.actionConfirm=function(){if(this.styles.has("upload")&&apijs.upload.actionConfirm(this.tagBox.getAttribute("action")))return window.setTimeout(apijs.upload.showProgress,12),!0;if(this.styles.has("options","confirmation")){if(this.styles.has("options")&&!0!==this.callback(!1,this.args))return!1;this.styles.add("lock"),this.tagBox.querySelector("div.control").style.visibility="hidden",this.tagBox.querySelector("div.bbcode").style.visibility="hidden",this.elemA=document.createElement("p"),this.elemA.setAttribute("class","saving"),this.elemA.appendChild(apijs.i18n.nodeTranslate("operationInProgress")),this.tagBox.appendChild(this.elemA),this.timer=window.setTimeout(apijs.dialog.htmlLinkReload.bind(this),7e3),window.setTimeout(function(){this.tagBox&&"FORM"===this.tagBox.nodeName?this.callback(this.tagBox.getAttribute("action"),this.args):this.tagBox&&this.callback(this.args)}.bind(this),1e3)}return!1},this.actionKey=function(e){var t,i=apijs.dialog.styles,s=apijs.dialog.tagMedia;i.has("waiting","progress","lock")?(e.ctrlKey&&(81===e.keyCode||87===e.keyCode||82===e.keyCode||115===e.keyCode||116===e.keyCode)||e.altKey&&115===e.keyCode||27===e.keyCode||116===e.keyCode)&&e.preventDefault():i.has("slideshow")?27===e.keyCode?(e.preventDefault(),apijs.dialog.actionClose(!0)):35===e.keyCode?(e.preventDefault(),apijs.slideshow.actionLast()):36===e.keyCode?(e.preventDefault(),apijs.slideshow.actionFirst()):37===e.keyCode?(e.preventDefault(),apijs.slideshow.actionPrev()):39===e.keyCode&&(e.preventDefault(),apijs.slideshow.actionNext()):27===e.keyCode&&(e.preventDefault(),apijs.dialog.actionClose(!0)),i.has("video")&&!isNaN(s.duration)&&(32===e.keyCode||80===e.keyCode?(e.preventDefault(),s.paused?s.play():s.pause()):38===e.keyCode||33===e.keyCode?(e.preventDefault(),s.currentTime<s.duration-15&&(s.currentTime+=10)):40===e.keyCode||34===e.keyCode?(e.preventDefault(),s.currentTime-=10):107===e.keyCode?(e.preventDefault(),s.volume<1&&(s.volume+=.2)):109===e.keyCode?(e.preventDefault(),.2<s.volume&&(s.volume-=.2)):77===e.keyCode&&(e.preventDefault(),s.muted=!s.muted)),32!==e.keyCode&&33!==e.keyCode&&34!==e.keyCode&&35!==e.keyCode&&36!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(t="INPUT"===e.target.nodeName,i="TEXTAREA"===e.target.nodeName,s="SELECT"===e.target.nodeName,(t||i||s)&&33!==e.keyCode&&34!==e.keyCode||apijs.dialog.actionScrollBrowser(e))},this.actionCloseBrowser=function(e){if(apijs.dialog.styles.has("waiting","progress","lock"))return e.preventDefault(),e.stopPropagation(),apijs.i18n.translate("userLeavePage")+"\n"+apijs.i18n.translate("warningLostChange")},this.actionScrollBrowser=function(e){e.preventDefault(),e.stopPropagation()},this.actionResizeMedia=function(){var e=apijs.dialog.image,t=!1;null!==e?(e.width>Math.round(apijs.dialog.tagMedia.offsetWidth)||e.height>Math.round(apijs.dialog.tagMedia.offsetHeight))&&(t=!0):(apijs.dialog.tagMedia.setAttribute("class",apijs.dialog.tagMedia.getAttribute("class").replace("bis","default")),Math.round(apijs.dialog.tagMedia.offsetWidth)>window.innerWidth-12*window.innerWidth/100&&(t=!0),apijs.dialog.tagMedia.setAttribute("class",apijs.dialog.tagMedia.getAttribute("class").replace("default","bis"))),apijs.dialog.tagMedia.setAttribute("class",apijs.dialog.tagMedia.getAttribute("class").replace(t?"default":"bis",t?"bis":"default"))},this.actionPauseVideo=function(){var e;"boolean"==typeof document.hidden?e=document.hidden:"boolean"==typeof document.mozHidden?e=document.mozHidden:"boolean"==typeof document.msHidden?e=document.msHidden:"boolean"==typeof document.webkitHidden&&(e=document.webkitHidden),e?(apijs.dialog.paused=apijs.dialog.tagMedia.paused,apijs.dialog.tagMedia.pause()):apijs.dialog.paused||apijs.dialog.tagMedia.play()},this.loadImage=function(e){this.image=new Image,this.image.src=e,this.image.addEventListener("load",function(){this.tagMedia.setAttribute("class",this.tagMedia.getAttribute("class").replace("loading","default")),this.tagMedia.setAttribute("style",'background-image:url("'+this.image.src+'");'),this.actionResizeMedia()}.bind(this),!1),this.image.addEventListener("error",function(){this.tagMedia.setAttribute("class",this.tagMedia.getAttribute("class").replace(/loading|default/,"error")),this.tagMedia.firstChild.appendChild(apijs.i18n.nodeTranslate("error404"))}.bind(this),!1)},this.initDialog=function(e,t){if(null!==this.styles&&this.deleteDialog(!1),this.styles=new apijs.core.styles,this.styles.init(e,t),this.fragment=document.createDocumentFragment(),document.addEventListener("keydown",apijs.dialog.actionKey,!1),window.addEventListener("beforeunload",apijs.dialog.actionCloseBrowser,!1),window.addEventListener("DOMMouseScroll",apijs.dialog.actionScrollBrowser,!1),window.addEventListener("mousewheel",apijs.dialog.actionScrollBrowser,!1),window.addEventListener("touchmove",apijs.dialog.actionScrollBrowser,!1),apijs.config.dialog.restrictNavigation)for(var i=document.querySelectorAll("a,area,button,input,object,select,textarea,iframe"),s=0;s<i.length;s++)"object"==typeof i[s]&&i[s].setAttribute("tabindex","-1")},this.showDialog=function(){document.getElementById("apijsDialog")||this.styles.has("notransition")?(this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("start","ready")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("start","ready")),document.getElementById("apijsDialog")?(document.getElementById("apijsDialog").appendChild(this.tagBox),this.tagDialog=document.getElementById("apijsDialog")):document.body.appendChild(this.fragment)):(document.body.appendChild(this.fragment),window.setTimeout(function(){this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("start","ready")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("start","ready"))}.bind(this),12)),apijs.config.dialog.closeOnClick&&!this.styles.has("waiting","progress","lock")&&document.addEventListener("click",apijs.dialog.actionCloseOnClick,!1),this.styles.has("photo","video")&&window.addEventListener("resize",apijs.dialog.actionResizeMedia,!1),this.styles.has("video")&&("boolean"==typeof document.hidden?document.addEventListener("visibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.mozHidden?document.addEventListener("mozvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.msHidden?document.addEventListener("msvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.webkitHidden&&document.addEventListener("webkitvisibilitychange",apijs.dialog.actionPauseVideo,!1))},this.deleteDialog=function(e){if(this.timer&&clearTimeout(this.timer),document.removeEventListener("keydown",apijs.dialog.actionKey,!1),window.removeEventListener("beforeunload",apijs.dialog.actionCloseBrowser,!1),window.removeEventListener("DOMMouseScroll",apijs.dialog.actionScrollBrowser,!1),window.removeEventListener("mousewheel",apijs.dialog.actionScrollBrowser,!1),window.removeEventListener("touchmove",apijs.dialog.actionScrollBrowser,!1),apijs.config.dialog.restrictNavigation)for(var t=document.querySelectorAll("a,area,button,input,object,select,textarea,iframe"),i=0;i<t.length;i++)"object"==typeof t[i]&&t[i].removeAttribute("tabindex");var s,a;apijs.config.dialog.closeOnClick&&document.removeEventListener("click",apijs.dialog.actionCloseOnClick,!1),this.styles.has("photo","video")&&window.removeEventListener("resize",apijs.dialog.actionResizeMedia,!1),this.styles.has("video")&&("function"==typeof this.tagMedia.pause&&(this.tagMedia.pause(),this.tagMedia.setAttribute("src","")),"boolean"==typeof document.hidden?document.removeEventListener("visibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.mozHidden?document.removeEventListener("mozvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.msHidden?document.removeEventListener("msvisibilitychange",apijs.dialog.actionPauseVideo,!1):"boolean"==typeof document.webkitHidden&&document.removeEventListener("webkitvisibilitychange",apijs.dialog.actionPauseVideo,!1)),this.tagDialog=document.getElementById("apijsDialog"),this.tagBox=document.getElementById("apijsBox"),e?(s=window.getComputedStyle(this.tagBox,null),a="string"==typeof this.tagBox.style.webkitTransition?"webkitTransitionEnd":"transitionend",this.styles.has("notransition")||"0s"===s.transitionDuration||void 0===s.transitionDuration?document.body.removeChild(document.getElementById("apijsDialog")):(this.tagDialog.setAttribute("class",this.tagDialog.getAttribute("class").replace("ready","end")),this.tagBox.setAttribute("class",this.tagBox.getAttribute("class").replace("ready","end")),this.tagDialog.addEventListener(a,function(){document.getElementById("apijsDialog")&&document.body.removeChild(document.getElementById("apijsDialog"))},!1))):this.tagBox&&this.tagBox.parentNode.removeChild(this.tagBox),this.styles=null,this.paused=null,this.image=null,this.timer=null,e&&(this.callback=null,this.args=null),this.fragment=null,this.elemA=null,this.elemB=null,this.elemC=null,this.elemD=null,this.tagDialog=null,this.tagMedia=null,this.tagTitle=null,this.tagBox=null},this.searchTypes=function(e){for(var t=[],i={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",svg:"image/svg+xml",ogv:"video/ogg",webm:"video/webm",mp4:"video/mp4",m4v:"video/mp4"},s=(e=e.slice(e.lastIndexOf(".")+1)).replace("#",".").replace(",",".").split("."),a=0;a<s.length;a++)t.push(i.hasOwnProperty(s[a])?[s[a],i[s[a]]]:[s[a],s[a]]);return t},this.htmlParent=function(e,t){this.tagDialog=document.createElement("div"),this.tagDialog.setAttribute("class","string"==typeof e?"start "+e:"start"),this.tagDialog.setAttribute("id","apijsDialog"),"string"!=typeof t?this.tagBox=document.createElement("div"):(this.tagBox=document.createElement("form"),this.tagBox.setAttribute("action",t),this.tagBox.setAttribute("method","post"),this.tagBox.setAttribute("enctype","multipart/form-data"),this.tagBox.setAttribute("onsubmit","return apijs.dialog.actionConfirm();")),this.tagBox.setAttribute("class","start "+this.styles.toString()),this.tagBox.setAttribute("id","apijsBox"),this.tagDialog.appendChild(this.tagBox),this.fragment.appendChild(this.tagDialog)},this.htmlTitle=function(e){this.tagTitle=document.createElement("h1"),this.tagTitle.appendChild(document.createTextNode(e)),this.tagBox.appendChild(this.tagTitle)},this.htmlContent=function(e,t){t="boolean"!=typeof t||t,this.elemA=document.createElement("div"),this.elemA.setAttribute("class",apijs.config.dialog.emotes?"bbcode emotes":"bbcode"),"["!==e[0]&&(e="[p]"+e+"[/p]"),apijs.config.dialog.emotes&&t&&(e=e.replace(/ (\(L\))/g,"`$1`00¤").replace(/ (\(u\))/gi,"`$1`01¤").replace(/ (\(y\))/gi,"`$1`02¤").replace(/ (\(n\))/gi,"`$1`03¤").replace(/ (:D)/gi,"`$1`04¤").replace(/ (:\))/g,"`$1`05¤").replace(/ (:p)/gi,"`$1`06¤").replace(/ (:\()/g,"`$1`07¤").replace(/ (;\))/g,"`$1`08¤").replace(/ (:lol)/gi,"`$1`09¤").replace(/ (8\))/g,"`$1`0a¤").replace(/ (:@)/g,"`$1`0b¤").replace(/ (\(6\))/g,"`$1`0c¤").replace(/ (:o)/gi,"`$1`0d¤").replace(/ (\(\!\))/g,"`$1`0e¤").replace(/ (\(\?\))/g,"`$1`0f¤").replace(/ (:s)/gi,"`$1`10¤").replace(/ (:\|)/g,"`$1`11¤").replace(/ (:\/)/g,"`$1`12¤").replace(/ (\(i\))/gi,"`$1`13¤").replace(/`(.{2,4})`([0-9a-f]{2})¤/g,' [span title="$1" class="ico"]&#xe6$2;[/span]')),this.elemA.innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\[/g,"<").replace(/\]/g,">");for(var i=this.elemA.querySelectorAll("a.popup"),s=0;s<i.length;s++)i[s].addEventListener("click",apijs.openTab,!1);this.tagBox.appendChild(this.elemA)},this.htmlButtonOk=function(){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose(true);"),this.elemB.setAttribute("class","confirm"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonOk")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonConfirm=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type",e),this.elemB.setAttribute("class","confirm"),"submit"!==e&&this.elemB.setAttribute("onclick","apijs.dialog.actionConfirm();"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonConfirm")),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","cancel"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose(true);"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonCancel")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonNavigation=function(){var e=null===apijs.config.dialog.imagePrev||null===apijs.config.dialog.imageNext;this.elemA=document.createElement("div"),this.elemA.setAttribute("class",e?"navigation txt":"navigation img"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionPrev();"),this.elemB.setAttribute("class","prev"),this.elemB.setAttribute("id","apijsPrev"),e?(this.elemC=document.createElement("span"),this.elemC.appendChild(apijs.i18n.nodeTranslate("buttonPrev"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imagePrev.src),this.elemC.setAttribute("width",apijs.config.dialog.imagePrev.width),this.elemC.setAttribute("height",apijs.config.dialog.imagePrev.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonPrev"))),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("disabled","disabled"),this.elemB.setAttribute("onclick","apijs.slideshow.actionNext();"),this.elemB.setAttribute("class","next"),this.elemB.setAttribute("id","apijsNext"),e?(this.elemC=document.createElement("span"),this.elemC.appendChild(apijs.i18n.nodeTranslate("buttonNext"))):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imageNext.src),this.elemC.setAttribute("width",apijs.config.dialog.imageNext.width),this.elemC.setAttribute("height",apijs.config.dialog.imageNext.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonNext"))),this.elemB.appendChild(this.elemC),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlButtonClose=function(){var e=null===apijs.config.dialog.imageClose;this.elemA=document.createElement("div"),this.elemA.setAttribute("class",e?"close txt":"close img"),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("onclick","apijs.dialog.actionClose(true);"),this.elemB.setAttribute("class","close"),e?this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonClose")):(this.elemC=document.createElement("img"),this.elemC.setAttribute("src",apijs.config.dialog.imageClose.src),this.elemC.setAttribute("width",apijs.config.dialog.imageClose.width),this.elemC.setAttribute("height",apijs.config.dialog.imageClose.height),this.elemC.setAttribute("alt",apijs.i18n.translate("buttonClose")),this.elemB.appendChild(this.elemC)),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlLinkReload=function(){this.elemA=document.createElement("p"),this.elemA.setAttribute("class","reload"),this.elemA.appendChild(apijs.i18n.nodeTranslate("operationTooLong")),this.elemB=document.createElement("a"),this.elemB.setAttribute("href","javascript:location.reload();"),this.elemB.appendChild(apijs.i18n.nodeTranslate("reloadLink")),this.elemA.appendChild(this.elemB),this.elemA.appendChild(document.createTextNode(".")),this.elemB=document.createElement("br"),this.elemA.appendChild(this.elemB),this.elemA.appendChild(apijs.i18n.nodeTranslate("warningLostChange")),this.tagBox.appendChild(this.elemA)},this.htmlFormUpload=function(e){this.elemA=document.createElement("div"),this.elemA.setAttribute("class","control online"),this.elemB=document.createElement("input"),this.elemB.setAttribute("type","file"),this.elemB.setAttribute("name",e),this.elemB.setAttribute("onchange","apijs.dialog.tagBox.querySelector('button.confirm').focus(); apijs.dialog.tagBox.querySelector('span').innerHTML = (this.files) ? this.files[0].name : this.value.slice(12);"),0<navigator.userAgent.indexOf("MSIE")&&this.elemB.setAttribute("style","width:auto; visibility:visible;"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("button"),this.elemB.setAttribute("type","button"),this.elemB.setAttribute("class","browse"),this.elemB.setAttribute("onclick","apijs.dialog.tagBox.querySelector('input').click();"),this.elemB.appendChild(apijs.i18n.nodeTranslate("buttonBrowse")),0<navigator.userAgent.indexOf("MSIE")&&this.elemB.setAttribute("style","display:none;"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("span"),this.elemB.setAttribute("class","filename"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("div"),this.elemB.setAttribute("class","status"),this.elemB.appendChild(document.createTextNode("")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlProgressBar=function(){this.elemA=document.createElement("svg"),this.elemA.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.elemA.setAttribute("version","1.1"),this.elemA.setAttribute("id","apijsProgress"),this.elemB=document.createElement("rect"),this.elemB.setAttribute("class","auto"),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("text"),this.elemB.appendChild(document.createTextNode(" ")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlMedia=function(e,t,i,s){var a,n=this.searchTypes(e),o=e.slice(e.lastIndexOf("/")+1,e.lastIndexOf("."));if(this.elemA=document.createElement("dl"),this.elemA.setAttribute("class","media"),this.elemB=document.createElement("dt"),-1<n[0][1].indexOf("image"))this.tagMedia=document.createElement("div"),this.tagMedia.setAttribute("class","img loading"),this.tagMedia.setAttribute("id","apijsMedia"),this.elemD=document.createElement("span"),this.tagMedia.appendChild(this.elemD);else for(this.tagMedia=document.createElement("video"),this.tagMedia.setAttribute("controls","controls"),this.tagMedia.setAttribute("class","default"),this.tagMedia.setAttribute("id","apijsMedia"),a=0;a<n.length;a++)this.elemD=document.createElement("source"),this.elemD.setAttribute("src",e.slice(0,e.lastIndexOf("."))+"."+n[a][0]),this.elemD.setAttribute("type",n[a][1]),this.tagMedia.appendChild(this.elemD);this.elemB.appendChild(this.tagMedia),this.elemA.appendChild(this.elemB),this.elemB=document.createElement("dd"),"false"===t&&"false"===i||(this.elemC=document.createElement("span"),"false"!==t&&"auto"!==t&&"false"!==i?this.elemC.appendChild(document.createTextNode(t+" ("+i+")")):"false"!==t&&"auto"!==t?this.elemC.appendChild(document.createTextNode(t)):"auto"===t&&"false"!==i?this.elemC.appendChild(document.createTextNode(o+" ("+i+")")):"auto"===t?this.elemC.appendChild(document.createTextNode(o)):"false"!==i&&this.elemC.appendChild(document.createTextNode("("+i+")")),this.elemB.appendChild(this.elemC)),this.elemB.appendChild(document.createTextNode(" "+s+" ")),this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)},this.htmlHelp=function(e,t){var i,s,a,n,o=[];for(e&&(o.push(["start;↖","ctrlKeyEnd","ctrlSlideshowFirstLast"]),o.push(["left;←","right;→","ctrlSlideshowNextPrev"])),t&&(o.push(["p","ctrlVideoPause"]),o.push(["top;↑","bot;↓","ctrlVideoTime"]),o.push(["more;+","less;-","ctrlVideoSound"]),o.push(["m","ctrlVideoMute"])),o.push(["F11","ctrlDialogFullscreen"]),o.push(["ctrlKeyEsc","ctrlDialogQuit"]),this.elemA=document.createElement("div"),this.elemA.setAttribute("class","kbd"),this.elemB=document.createElement("ul"),i=0;i<o.length;i++){for(n=o[i].length-1,this.elemC=document.createElement("li"),s=0;s<n;s++)this.elemD=document.createElement("kbd"),0<o[i][s].indexOf(";")?(a=o[i][s].split(";"),this.elemD.setAttribute("class",a[0]),this.elemD.setAttribute("title",a[1])):this.elemD.appendChild(apijs.i18n.nodeTranslate(o[i][s])),this.elemC.appendChild(this.elemD);this.elemC.appendChild(apijs.i18n.nodeTranslate(o[i][n])),this.elemB.appendChild(this.elemC)}this.elemA.appendChild(this.elemB),this.tagBox.appendChild(this.elemA)}},apijs.core.styles=function(){this.data=[],this.init=function(e,t){this.data.push(e),"string"==typeof t&&(this.data=this.data.concat(t.split(" ")))},this.add=function(e){return this.data.hasOwnProperty(e)||this.data.push(e),this.data},this.toggle=function(e,t){this.has(e)&&this.remove(e),this.has(t)||this.add(t)},this.has=function(){return null!==this.data&&apijs.inArray(this.data,Array.prototype.slice.call(arguments,0))},this.remove=function(){var e,t=Array.prototype.slice.call(arguments,0);for(e in t)t.hasOwnProperty(e)&&this.data.splice(this.data.indexOf(t[e]),1);return this.data},this.toString=function(){return this.data.join(" ")}},apijs.core.slideshow=function(){this.current=null,this.init=function(){for(var e,t,i=apijs.config.slideshow.ids,s=0;null!==document.getElementById(i+"."+s);s++){for(t=-1<document.getElementById(i+"."+s).getAttribute("class").indexOf("hoverload"),e=0;null!==document.getElementById(i+"."+s+"."+e);e++)document.getElementById(i+"."+s+"."+e).addEventListener("click",apijs.slideshow.showMedia.bind(this),!1),t&&document.getElementById(i+"."+s+"."+e).addEventListener("mouseover",apijs.slideshow.showMedia.bind(this),!1);document.getElementById(i+"."+s+".999")&&document.getElementById(i+"."+s+".999").addEventListener("click",apijs.slideshow.showMedia.bind(this),!1)}},this.showMedia=function(e){var t,i,s={};if("string"!=typeof e){if(e.preventDefault(),t="A"===e.target.nodeName?e.target:e.target.parentNode,s.id=t.getAttribute("id"),t.hasAttribute("class")&&-1<t.getAttribute("class").indexOf("current"))return}else t=document.getElementById(e),s.id=e;if(s.prefix=apijs.config.slideshow.ids+"."+s.id.split(".")[1],s.url=t.getAttribute("href"),s.config=t.querySelector("input").getAttribute("value").split("|"),s.number=parseInt(s.id.split(".")[2],10),s.styles=document.getElementById(s.prefix).getAttribute("class"),s.styles=s.styles.replace(/gallery|album/g,"slideshow"),s.presentation=document.getElementById(s.prefix+".999"),4===s.config.length&&s.presentation||3===s.config.length){var a,n=document.getElementById(s.id),e=n.querySelector("img"),o=document.getElementById(s.prefix).querySelectorAll("img");if(4===s.config.length&&"null"!==s.config[0]&&(s.presentation.setAttribute("href",n.getAttribute("href")),s.presentation.querySelector("img").setAttribute("src",s.config.shift()),s.presentation.querySelector("img").setAttribute("alt",e.getAttribute("alt")),s.presentation.querySelector("input").setAttribute("value",s.config.join("|")),s.presentation.setAttribute("class",n.getAttribute("id"))),"null"===s.config[0]&&s.config.shift(),e&&999!==s.number){for(a=0;a<o.length;a++)o[a].hasAttribute("class")&&o[a].removeAttribute("class");e.setAttribute("class","current")}s.presentation?999===s.number?(i=(e=document.getElementById(t.hasAttribute("class")?t.getAttribute("class"):s.prefix+".0")).getAttribute("type"),s.number=parseInt(e.getAttribute("id").split(".")[2],10)):null!==apijs.dialog.styles&&apijs.dialog.styles.has("slideshow")&&(i=document.getElementById(s.id).getAttribute("type")):i=t.getAttribute("type"),"string"==typeof i&&(s.type=i.substr(0,5).replace("image","dialogPhoto").replace("video","dialogVideo"),this.showDialog(s))}else apijs.core.error("TheSlideshow.showMedia","debugInvalidUse",apijs.i18n.translate("debugUnknownConfig",s.config.join(" | ")))},this.showDialog=function(e){apijs.dialog[e.type](e.url,e.config[0],e.config[1],e.config[2],e.styles),null!==apijs.dialog.styles&&apijs.dialog.styles.has("slideshow")?(this.current={number:e.number,first:null,prev:null,next:null,last:null,total:null},this.current.total=document.getElementById(e.prefix).querySelectorAll("a[id][type]").length-1,this.current.total=e.presentation?this.current.total-1:this.current.total,this.current.first=e.prefix+".0",this.current.prev=0<e.number?e.prefix+"."+(this.current.number-1):null,this.current.next=e.number<this.current.total?e.prefix+"."+(this.current.number+1):null,this.current.last=e.prefix+"."+this.current.total,null!==this.current.prev&&document.getElementById("apijsPrev").removeAttribute("disabled"),null!==this.current.next&&document.getElementById("apijsNext").removeAttribute("disabled")):this.current=null},this.actionFirst=function(){null!==this.current&&0<this.current.number&&this.current.number<=this.current.total&&this.showMedia(this.current.first)},this.actionPrev=function(){null!==this.current&&null!==this.current.prev&&0<this.current.number&&this.showMedia(this.current.prev)},this.actionNext=function(){null!==this.current&&null!==this.current.next&&this.current.number<this.current.total&&this.showMedia(this.current.next)},this.actionLast=function(){null!==this.current&&0<=this.current.number&&this.current.number<this.current.total&&this.showMedia(this.current.last)}},apijs.core.upload=function(){this.maxsize=0,this.extensions=null,this.callback=null,this.args=null,this.icon=null,this.startTime=0,this.updatedTime=0,this.fileId=null,this.sendFile=function(e,t,i,s,a,n,o,l){var r;"string"==typeof e&&"string"==typeof t&&"string"==typeof i&&"number"==typeof s&&"string"==typeof a&&"function"==typeof n?(this.maxsize=s,this.extensions=a.split(","),this.callback=n,this.args=o,this.icon=l,s=s.toFixed(2).replace(".00","").replace(".",apijs.i18n.translate("uploadDecimal")),r="*"===this.extensions[0]?apijs.i18n.translate("uploadAllType",s):1===this.extensions.length?apijs.i18n.translate("uploadOneType",a,s):apijs.i18n.translate("uploadMultiType",this.extensions.slice(0,-1).join(", "),this.extensions.slice(-1),s),apijs.dialog.dialogFormUpload(e,r,t,i,l)):("function"==typeof n&&"string"==typeof n.name&&0<n.name.length&&(n=n.name),apijs.core.error("TheUpload.sendFile","debugInvalidCall",{"(string) *title":e,"(string) *action":t,"(string) *inputname":i,"(number) *maxsize":s,"(string) *extensions":a,"(function) *callback":n,"(mixed) args":o,"(string) icon":l}))},this.actionConfirm=function(e){if(null===this.extensions)return window.setTimeout(apijs.upload.showDebug,12),!1;var t=apijs.dialog.tagBox.querySelector("input"),i=apijs.dialog.tagBox.querySelector("div.status").firstChild,s={filePresent:!1,fileFormat:!1,fileSize:!1,format:"",size:this.maxsize};if(0<t.value.length&&(s.filePresent=!0,"object"==typeof t.files?(s.format=t.files[0].name,s.format=s.format.slice(s.format.lastIndexOf(".")+1).toLowerCase(),s.size=t.files[0].size):(s.format=t.value.slice(12),s.format=s.format.slice(s.format.lastIndexOf(".")+1).toLowerCase()),"*"!==this.extensions[0]&&!apijs.inArray(s.format,this.extensions)||(s.fileFormat=!0),0<s.size&&s.size<=1048576*this.maxsize&&(s.fileSize=!0)),s.filePresent&&s.fileFormat&&s.fileSize){if(!(("function"==typeof FormData||"object"==typeof FormData)&&"object"==typeof t.files&&e.indexOf("forceNoAjax")<0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Trident")<0))return!0;this.startTime=this.updatedTime=Math.round((new Date).getTime()/1e3),this.startAsynchronousUpload(e),this.showProgress()}else s.filePresent&&!s.fileFormat?i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadBadType",s.format)):s.filePresent&&!s.fileSize&&(0<s.size?(s.size=(s.size/1048576).toFixed(2).replace(".00","").replace(".",apijs.i18n.translate("uploadDecimal")),i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadBadSize",s.size))):i.replaceData(0,i.nodeValue.length,apijs.i18n.translate("uploadEmpty"))),apijs.dialog.tagBox.querySelector("button.browse").focus();return!1},this.showProgress=function(){apijs.dialog.dialogProgress(apijs.dialog.tagTitle.firstChild.nodeValue,apijs.i18n.translate("uploadInProgress"),apijs.upload.icon),0<navigator.userAgent.indexOf("Safari")&&0<navigator.userAgent.indexOf("AppleWebkit")&&apijs.dialog.styles.remove("lock")},this.showError=function(){apijs.dialog.dialogInformation(apijs.dialog.tagTitle.firstChild.nodeValue,apijs.i18n.translate(this.fileId[0],this.fileId[1]),"upload error"),this.setPageTitle(null)},this.showDebug=function(){apijs.core.error("TheUpload.actionConfirm","debugInvalidUse",apijs.i18n.translate("debugBadUse","apijs.upload.sendFile()"))},this.startAsynchronousUpload=function(e){var t=new FormData,i=new XMLHttpRequest;t.append(apijs.dialog.tagBox.querySelector("input").getAttribute("name"),apijs.dialog.tagBox.querySelector("input").files[0]),i.open("POST",e+(0<e.indexOf("?")?"&isAjax=true":"?isAjax=true"),!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?0===i.responseText.indexOf("success-")?(apijs.upload.fileId=["success",i.responseText.slice(8)],window.setTimeout(apijs.upload.uploadOnSuccess.bind(apijs.upload),3e3)):(apijs.upload.fileId=["uploadError2",i.responseText],window.setTimeout(apijs.upload.showError.bind(apijs.upload),1500)):(apijs.upload.fileId=["uploadError1",i.status],window.setTimeout(apijs.upload.showError.bind(apijs.upload),1500)))},i.upload.addEventListener("progress",apijs.upload.uploadOnProgress,!1),i.upload.addEventListener("load",apijs.upload.uploadOnLoad,!1),i.send(t)},this.uploadOnProgress=function(e){var t,i,s=null,a=null,n=null,o=Math.round((new Date).getTime()/1e3);e.lengthComputable&&o>apijs.upload.updatedTime+1&&(apijs.upload.updatedTime=o,(t=Math.round(100*e.loaded/e.total))<1||99<t||(apijs.upload.setPageTitle(t),o=100*(i=o-apijs.upload.startTime)/t,4<i&&(a=Math.round(e.loaded/i/1024),n=Math.round(o-i),n=i<10?(s=10,null):119<n?(s=11,Math.round(n/60)):89<n?(s=11,2):57<n?(s=12,1):45<n?(s=13,50):35<n?(s=13,40):25<n?(s=13,30):15<n?(s=13,20):(s=13,10)),apijs.upload.animToValue(t,s,a,n)))},this.uploadOnLoad=function(e){var t=Math.round((new Date).getTime()/1e3)-apijs.upload.startTime,i=Math.round(e.loaded/t/1024),e=null;i<1?t=i=null:90<t?(e=21,t=Math.round(t/60)):59<t?(e=22,t=1):9<t?e=23:t=0<i&&i!==1/0?(e=20,null):i=null,apijs.upload.setPageTitle(100),apijs.upload.animToValue(100,e,i,t)},this.uploadOnSuccess=function(){this.setPageTitle(null),this.callback(this.fileId[1],this.args),this.maxsize=0,this.extensions=null,this.callback=null,this.args=null,this.icon=null,this.startTime=0,this.updatedTime=0,this.fileid=null},this.setPageTitle=function(e){null!==e?document.title=/^[0-9]{1,3}% - /.test(document.title)?e+"% - "+document.title.slice(document.title.indexOf(" - ")+3):e+"% - "+document.title:/^[0-9]{1,3}% - /.test(document.title)&&(document.title=document.title.slice(document.title.indexOf(" - ")+3))},this.animToValue=function(e,t,i,s){var a,n=document.getElementById("apijsProgress").querySelector("rect"),o=document.getElementById("apijsProgress").querySelector("text").firstChild;99<e?(n.setAttribute("class","end"),n.style.width="",a="100%"):(n.style.width=a=e+"%",n.hasAttribute("class")&&n.removeAttribute("class")),"number"==typeof t&&"number"==typeof i&&"number"==typeof s?a=apijs.i18n.translate("upload"+t,e,i,s):"number"==typeof t&&"number"==typeof i&&(a=apijs.i18n.translate("upload"+t,e,i)),o.replaceData(0,o.length,a)}};